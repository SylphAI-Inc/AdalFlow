<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Text Splitter" href="text_splitter.html" /><link rel="prev" title="Embedder" href="embedder.html" />

    <link rel="shortcut icon" href="../_static/LightRAG-logo-circle.png"/><!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>Retriever - Build and Optimize LM Workflows</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=f0068426" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/rtd_sphinx_search.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #FF6F00;
  --color-brand-content: #1E2A38;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #FF8F00;
  --color-brand-content: #CFD8DC;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #FF8F00;
  --color-brand-content: #CFD8DC;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Build and Optimize LM Workflows</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/images/AdalFlow.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/images/AdalFlow_black_bg.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Build and Optimize LM Workflows</span>
  
</a><div class="sidebar-github-section">
    <a href="https://github.com/SylphAI-Inc/AdalFlow" class="sidebar-github-link">
        <i class="fa-brands fa-github"></i>
        <span class="github-text">GitHub</span>
    </a>
</div><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../new_tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/core_concepts.html">Core Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/prompt.html">Prompt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/parser.html">Parser and Structured Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/generator.html">Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/embedder.html">Embedder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/tool.html">Tool Use</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../integrations/index.html">Integrations</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Integrations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../integrations/integrations.html">All Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/anthropic.html">Anthropic Integration</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../use_cases/index.html">Use Cases</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Use Cases</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/question_answering.html">Question Answering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/qa_computation_graph.html">Q&amp;A Computation Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/qa_text_grad_trace_graph.html">Q&amp;A Text Grad Trace Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/qa_demo_trace_graph.html">Q&amp;A Few Shot Demo Trace Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/classification.html">Classification Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/rag_opt.html">RAG optimization</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../contributor/index.html">Contributor Guide</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Contributor Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../contributor/contribution.html">Contributing Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributor/contribute_to_code.html">Development Essentials</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Developer Notes</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Developer Notes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="lightrag_design_philosophy.html">Design Philosophy</a></li>
<li class="toctree-l2"><a class="reference internal" href="class_hierarchy.html">Class Hierarchy</a></li>
<li class="toctree-l2"><a class="reference internal" href="trace_graph.html">AdalFlow Trace Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="component.html">Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="base_data_class.html">DataClass</a></li>
<li class="toctree-l2"><a class="reference internal" href="prompt.html">Prompt</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_client.html">ModelClient</a></li>
<li class="toctree-l2"><a class="reference internal" href="generator.html">Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="generator.html#basic-generator-tutorial">Basic Generator Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="output_parsers.html">Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="embedder.html">Embedder</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Retriever</a></li>
<li class="toctree-l2"><a class="reference internal" href="text_splitter.html">Text Splitter</a></li>
<li class="toctree-l2"><a class="reference internal" href="db.html">Data (Database/Pipeline)</a></li>
<li class="toctree-l2"><a class="reference internal" href="rag_playbook.html">RAG Playbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="rag_with_memory.html">RAG with Memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="tool_helper.html">Function calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="agent.html">Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="evaluation.html">LLM Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="datasets.html">Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logger Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html#design">Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html#use-logger-in-projects">Use Logger in Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging_tracing.html">Tracing</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../apis/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/core/index.html">Core</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Core</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.base_data_class.html">base_data_class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.component.html">component</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.container.html">container</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.default_prompt_template.html">default_prompt_template</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.embedder.html">embedder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.generator.html">generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.model_client.html">model_client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.prompt_builder.html">prompt_builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.retriever.html">retriever</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.string_parser.html">string_parser</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.func_tool.html">func_tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.tool_manager.html">tool_manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.types.html">types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.db.html">db</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.functional.html">functional</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.tokenizer.html">tokenizer</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/components/index.html">Components</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Components</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.model_client.html">model_client</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of model_client</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.anthropic_client.html">anthropic_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.azureai_client.html">azureai_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.bedrock_client.html">bedrock_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.cohere_client.html">cohere_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.deepseek_client.html">deepseek_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.fireworks_client.html">fireworks_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.google_client.html">google_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.groq_client.html">groq_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.mistral_client.html">mistral_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.ollama_client.html">ollama_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.openai_client.html">openai_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.sambanova_client.html">sambanova_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.together_client.html">together_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.transformers_client.html">transformers_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.utils.html">utils</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.xai_client.html">xai_client</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.retriever.html">retriever</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of retriever</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.bm25_retriever.html">bm25_retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.faiss_retriever.html">faiss_retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.lancedb_retriver.html">lancedb_retriver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.llm_retriever.html">llm_retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.postgres_retriever.html">postgres_retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.qdrant_retriever.html">qdrant_retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.reranker_retriever.html">reranker_retriever</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.output_parsers.html">output_parsers</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of output_parsers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.output_parsers.dataclass_parser.html">dataclass_parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.output_parsers.outputs.html">outputs</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.agent.html">agent</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of agent</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.agent.react.html">react</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.data_process.html">data_process</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of data_process</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.data_process.data_components.html">data_components</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.data_process.text_splitter.html">text_splitter</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.memory.html">memory</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of memory</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.memory.memory.html">memory</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/datasets/index.html">Datasets</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of Datasets</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/datasets/datasets.big_bench_hard.html">big_bench_hard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/datasets/datasets.trec.html">trec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/datasets/datasets.hotpot_qa.html">hotpot_qa</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/datasets/datasets.types.html">types</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/eval/index.html">Evaluation</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Evaluation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/eval/eval.base.html">base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/eval/eval.answer_match_acc.html">answer_match_acc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/eval/eval.retriever_recall.html">retriever_recall</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/eval/eval.llm_as_judge.html">llm_as_judge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/eval/eval.g_eval.html">g_eval</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/optim/index.html">Optimization</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of Optimization</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/optim/optim.parameter.html">parameter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/optim/optim.optimizer.html">optimizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/optim/optim.grad_component.html">grad_component</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/optim/optim.loss_component.html">loss_component</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/optim/optim.types.html">types</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/optim/optim.few_shot.html">few_shot</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of few_shot</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.few_shot.bootstrap_optimizer.html">bootstrap_optimizer</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/optim/optim.text_grad.html">text_grad</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of text_grad</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.text_grad.backend_engine_prompt.html">backend_engine_prompt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.text_grad.llm_text_loss.html">llm_text_loss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.text_grad.ops.html">ops</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.text_grad.text_loss_with_eval_fn.html">text_loss_with_eval_fn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.text_grad.tgd_optimizer.html">tgd_optimizer</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/optim/optim.trainer.html">trainer</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of trainer</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.trainer.adal.html">adal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.trainer.trainer.html">trainer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/tracing/index.html">Tracing</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of Tracing</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/tracing/tracing.decorators.html">decorators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/tracing/tracing.generator_state_logger.html">generator_state_logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/tracing/tracing.generator_call_logger.html">generator_call_logger</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/utils/index.html">Utils</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of Utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.data.html">data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.setup_env.html">setup_env</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.logger.html">logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.file_io.html">file_io</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.config.html">config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.lazy_import.html">lazy_import</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.registry.html">registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.serialization.html">serialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.cache.html">cache</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="retriever">
<span id="tutorials-retriever"></span><h1>Retriever<a class="headerlink" href="#retriever" title="Link to this heading">¶</a></h1>
<p>LLMs halluciate and also have a knowledge cut-off.
External and relevant context is needed to increase the factuality, relevancy, and freshness of the LLM answers.
Due to the LLM’s context window limit (it can only take so many tokens at a time), the <code class="docutils literal notranslate"><span class="pre">lost-in-the-middle</span></code> problem <a class="footnote-reference brackets" href="#id14" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>, and the high cost in speed and resources using large context,
it is practical to use a retriever to retrieve the most relevant information for the best performance. Retrieval Augemented Generation (RAG) <a class="footnote-reference brackets" href="#id15" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a> applications have become one of main applications in LLMs.</p>
<p><strong>What is a retriever?</strong></p>
<p>Though the definition is simple-“Retrieve relevant information for a given query from a given database”-the scope of a retriever can extend as wide as the entire search and information retrieval field.
Numerous search techniques existed long before vector/semantic search and reranking models, such as keyword search, fuzzy search, proximity search, phrase search, boolean search, facet search, full-text search.
These techniques can be applied to various data types, including text, time-sensitive data, locations, sensor data, images, videos, and audio.
Additionally, they can be stored in various types of databases, such as relational databases, NoSQL databases, vector databases, and graph databases.</p>
<p><strong>Retrieval in Production</strong></p>
<p>In real production, retrieval is often a multiple-stage process, progressing from the cheapest to the most expensive and accurate methods, narrowing down from millions of candidates to a few hundred or even less.
For example, when you want to search for candidates from a pool of profiles stored in a realtional database like Postgres, you can start with a simple keyword search or check if the  name equals the query.
You may also want to search by profession, which has already been categorized either by a model or human labeling, making it a filter search.
If the search query requires more semantic understanding, we will leverage semantic search using embedding models.
If we want it to be even more accurate, we can move up to more expensive and accurate methods such as reranking models and LLM-based retrieval methods.</p>
<section id="design">
<h2>Design<a class="headerlink" href="#design" title="Link to this heading">¶</a></h2>
<figure class="align-center" id="id20">
<a class="reference internal image-reference" href="../_images/retriever.png"><img alt="Retriever design" src="../_images/retriever.png" style="width: 620px;" />
</a>
<figcaption>
<p><span class="caption-text">AdalFlow retriever covers (1) high-precision retrieval methods and enables them to work locally and in-memory, and (2) how to work with cloud databases for large-scale data, utilizing their built-in search and filter methods.</span><a class="headerlink" href="#id20" title="Link to this image">¶</a></p>
<div class="legend">
</div>
</figcaption>
</figure>
<section id="scope-and-design-goals">
<h3>Scope and Design Goals<a class="headerlink" href="#scope-and-design-goals" title="Link to this heading">¶</a></h3>
<p>AdalFlow library does not prioritize the coverage of integration for the following reasons:</p>
<ol class="arabic simple">
<li><p>It is literally too-wide to cover them all.</p></li>
<li><p>The challenges with RAG application lies more in evaluation and optimization due to many different moving parts and many hyperparmeters, and less in implementing or integrating a 3rd party retriever.</p></li>
</ol>
<p>Instead, our design goals are:</p>
<ol class="arabic simple">
<li><p>Cover representative and valuable retriever methods:</p>
<ol class="loweralpha simple">
<li><p>High-precision retrieval methods and enabling them to work locally and in-memory so that researchers and developers can build and test more efficiently.</p></li>
<li><p>Showcase how to work with cloud databases for large-scale data, utilizing their built-in search and filter methods.</p></li>
</ol>
</li>
<li><p>Provide a clear design pattern so that users can:</p>
<ol class="loweralpha simple">
<li><p>Easily integrate their own retriever and make it work seamlessly with the remaining part of the LLM task pipeline.</p></li>
<li><p>Easily combine different retriever methods to form a multiple-stage retrieval pipeline.</p></li>
</ol>
</li>
</ol>
<p>Here are current coverage on retriever methods:</p>
<ol class="arabic simple">
<li><p>LLMAsRetriever</p></li>
<li><p>Reranker (Cross-encoder)</p></li>
<li><p>Semantic Search (Bi-encoder)</p></li>
<li><p>BM25</p></li>
<li><p>Database’s built-in search such as full-text search/SQL-based search using Postgres and semantic search using <code class="docutils literal notranslate"><span class="pre">PgVector</span></code>.</p></li>
</ol>
</section>
<section id="with-database">
<h3>With Database<a class="headerlink" href="#with-database" title="Link to this heading">¶</a></h3>
<p>A retriever will work hand in hand with <code class="docutils literal notranslate"><span class="pre">database</span></code>.
We will provide a <a class="reference internal" href="../apis/core/core.db.html#core.db.LocalDB" title="core.db.LocalDB"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocalDB</span></code></a> and a cloud SQL-based database (using <code class="docutils literal notranslate"><span class="pre">SQLAlchemy</span></code>) that can work with any data class/model, espeically with the <a class="reference internal" href="../apis/core/core.types.html#core.types.Document" title="core.types.Document"><code class="xref py py-class docutils literal notranslate"><span class="pre">Document</span></code></a> for data processing and <a class="reference internal" href="../apis/core/core.types.html#core.types.DialogTurn" title="core.types.DialogTurn"><code class="xref py py-class docutils literal notranslate"><span class="pre">DialogTurn</span></code></a> for conversational data.
<code class="docutils literal notranslate"><span class="pre">Document</span></code> combined with text splitter and embedding models will provide the <code class="docutils literal notranslate"><span class="pre">context</span></code> in RAG.
Working with <code class="docutils literal notranslate"><span class="pre">DialogTurn</span></code> can help manage <code class="docutils literal notranslate"><span class="pre">conversation_history</span></code>, especiall for the lifelong memeory of a chatbot.</p>
</section>
<section id="retriever-data-types">
<h3>Retriever Data Types<a class="headerlink" href="#retriever-data-types" title="Link to this heading">¶</a></h3>
<p><strong>Query</strong></p>
<p>In most cases, the query is string. But there are cases where we might need both text and images as a query, such as “find me a cloth that looks like this”.
We defined the query type <cite>RetrieverQueriesType</cite> so that all of our retrievers should handle both single query and multiple queries at once.
For text-based retrievers, we defined <cite>RetrieverStrQueriesType</cite> as a string or a sequence of strings.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RetrieverQueryType</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;RetrieverQueryType&quot;</span><span class="p">,</span> <span class="n">contravariant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">RetrieverStrQueryType</span> <span class="o">=</span> <span class="nb">str</span>
<span class="n">RetrieverQueriesType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">RetrieverQueryType</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">RetrieverQueryType</span><span class="p">]]</span>
<span class="n">RetrieverStrQueriesType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">RetrieverStrQueryType</span><span class="p">]]</span>
</pre></div>
</div>
<p><strong>Documents</strong></p>
<p>The documents are a sequence of documents of any type, which will be later specified by the subclass:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RetrieverDocumentType</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;RetrieverDocumentType&quot;</span><span class="p">,</span> <span class="n">contravariant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># a single document</span>
<span class="n">RetrieverDocumentsType</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">RetrieverDocumentType</span><span class="p">]</span> <span class="c1"># The final documents types retriever can use</span>
</pre></div>
</div>
<p><strong>Output</strong></p>
<p>We further definied the unified output data structure <a class="reference internal" href="../apis/core/core.types.html#core.types.RetrieverOutput" title="core.types.RetrieverOutput"><code class="xref py py-class docutils literal notranslate"><span class="pre">RetrieverOutput</span></code></a> so that we can easily switch between different retrievers in our task pipeline.
A retriever should return a list of <cite>RetrieverOutput</cite> to support multiple queries at once. This is helpful for:</p>
<ol class="arabic simple">
<li><p>Batch-processing: Especially for semantic search, where multiple queries can be represented as numpy array and computed all at once, providing faster speeds than processing each query one by one.</p></li>
<li><p>Query expansion: To increase recall, users often generate multiple queries from the original query.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RetrieverOutput</span><span class="p">(</span><span class="n">DataClass</span><span class="p">):</span>
    <span class="n">doc_indices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;List of document indices&quot;</span><span class="p">})</span>
    <span class="n">doc_scores</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;List of document scores&quot;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">query</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RetrieverQueryType</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;The query used to retrieve the documents&quot;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">documents</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">RetrieverDocumentType</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;List of retrieved documents&quot;</span><span class="p">}</span>
    <span class="p">)</span>


<span class="n">RetrieverOutputType</span> <span class="o">=</span> <span class="n">List</span><span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">]</span>  <span class="c1"># so to support multiple queries at once</span>
</pre></div>
</div>
<p><strong>Document and TextSplitter</strong></p>
<p>If your documents (in text format) are too large, it is common practise to first use <a class="reference internal" href="../apis/components/components.data_process.text_splitter.html#components.data_process.text_splitter.TextSplitter" title="components.data_process.text_splitter.TextSplitter"><code class="xref py py-class docutils literal notranslate"><span class="pre">TextSplitter</span></code></a> to split the text into smaller chunks.
Please refer to the <a class="reference internal" href="text_splitter.html"><span class="doc">Text Splitter</span></a> tutorial on how to use it.</p>
</section>
<section id="retriever-base-class">
<h3>Retriever Base Class<a class="headerlink" href="#retriever-base-class" title="Link to this heading">¶</a></h3>
<p>Functionally, the base retriever <a class="reference internal" href="../apis/core/core.retriever.html#core.retriever.Retriever" title="core.retriever.Retriever"><code class="xref py py-class docutils literal notranslate"><span class="pre">Retriever</span></code></a> defines another required method <code class="docutils literal notranslate"><span class="pre">build_index_from_documents</span></code> where the subclass will prepare the retriever for the actual retrieval calls.
Optionally, the subclass can implement <code class="docutils literal notranslate"><span class="pre">save_to_file</span></code> and <code class="docutils literal notranslate"><span class="pre">load_from_file</span></code> to save and load the retriever to/from disk.
As the retriever is a subclass of component, you already inherited powerful serialization and deserialization methods such as <code class="docutils literal notranslate"><span class="pre">to_dict</span></code>, <code class="docutils literal notranslate"><span class="pre">from_dict</span></code>, and <code class="docutils literal notranslate"><span class="pre">from_config</span></code> to help
with the saving and loading process. As for helper attributes, we have <code class="docutils literal notranslate"><span class="pre">indexed</span></code> and <code class="docutils literal notranslate"><span class="pre">index_keys</span></code> to differentiate if the retriever is ready for retrieval and the attributes that are key to restore the functionality/states of the retriever.
It is up the subclass to decide how to decide the storage of the index, it can be in-memory, local disk, or cloud storage, or save as json or pickle file or even a db table.
As an example, <a class="reference internal" href="../apis/components/components.retriever.bm25_retriever.html#components.retriever.bm25_retriever.BM25Retriever" title="components.retriever.bm25_retriever.BM25Retriever"><code class="xref py py-class docutils literal notranslate"><span class="pre">BM25Retriever</span></code></a> has the following key attributes to index.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Retriever</span><span class="p">(</span><span class="n">Component</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">RetrieverDocumentType</span><span class="p">,</span> <span class="n">RetrieverQueryType</span><span class="p">]):</span>

    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">input</span><span class="p">:</span> <span class="n">RetrieverQueriesType</span><span class="p">,</span>
        <span class="n">top_k</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RetrieverOutputType</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;retrieve is not implemented&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">acall</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">input</span><span class="p">:</span> <span class="n">RetrieverQueriesType</span><span class="p">,</span>
        <span class="n">top_k</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RetrieverOutputType</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Async retrieve is not implemented&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">index_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nd&quot;</span><span class="p">,</span> <span class="s2">&quot;t2d&quot;</span><span class="p">,</span> <span class="s2">&quot;idf&quot;</span><span class="p">,</span><span class="s2">&quot;doc_len&quot;</span><span class="p">,</span><span class="s2">&quot;avgdl&quot;</span><span class="p">,</span><span class="s2">&quot;total_documents&quot;</span><span class="p">,</span><span class="s2">&quot;top_k&quot;</span><span class="p">,</span><span class="s2">&quot;k1&quot;</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="s2">&quot;epsilon&quot;</span><span class="p">,</span><span class="s2">&quot;indexed&quot;</span><span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="experiment-data">
<h2>Experiment data<a class="headerlink" href="#experiment-data" title="Link to this heading">¶</a></h2>
<p>In this note, we will use the following documents and queries for demonstration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query_1</span> <span class="o">=</span> <span class="s2">&quot;What are the benefits of renewable energy?&quot;</span> <span class="c1"># gt is [0, 3]</span>
<span class="n">query_2</span> <span class="o">=</span> <span class="s2">&quot;How do solar panels impact the environment?&quot;</span> <span class="c1"># gt is [1, 2]</span>

<span class="n">documents</span> <span class="o">=</span><span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;The Impact of Renewable Energy on the Economy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Renewable energy technologies not only help in reducing greenhouse gas emissions but also contribute significantly to the economy by creating jobs in the manufacturing and installation sectors. The growth in renewable energy usage boosts local economies through increased investment in technology and infrastructure.&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Understanding Solar Panels&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Solar panels convert sunlight into electricity by allowing photons, or light particles, to knock electrons free from atoms, generating a flow of electricity. Solar panels are a type of renewable energy technology that has been found to have a significant positive effect on the environment by reducing the reliance on fossil fuels.&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Pros and Cons of Solar Energy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;While solar energy offers substantial environmental benefits, such as reducing carbon footprints and pollution, it also has downsides. The production of solar panels can lead to hazardous waste, and large solar farms require significant land, which can disrupt local ecosystems.&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span>  <span class="s2">&quot;Renewable Energy and Its Effects&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Renewable energy sources like wind, solar, and hydro power play a crucial role in combating climate change. They do not produce greenhouse gases during operation, making them essential for sustainable development. However, the initial setup and material sourcing for these technologies can still have environmental impacts.&quot;</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The first query should retrieve the first and the last document, and the second query should retrieve the second and the third document.</p>
</section>
<section id="documents-filtering">
<h2>Documents filtering<a class="headerlink" href="#documents-filtering" title="Link to this heading">¶</a></h2>
<p>Before using more advanced retrieval methods, it is common to filter the documents first.
Document filtering is dependent on your data storage, whether it is in memory, local disk, or cloud database.
For the cloud database, it is highly dependent on the database’s search and filter methods. And SQL-based search is common, scalable, and efficient.</p>
<p>If you are using <cite>LocalDB</cite> and <cite>Document</cite> as the data item, you can use the <cite>filter</cite> method to filter the documents.</p>
<p>Before you pass the documents or processed document chunks and embeddings to the retriever, you can filter the documents first.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.core.db</span> <span class="kn">import</span> <span class="n">LocalDB</span>
<span class="kn">from</span> <span class="nn">adalflow.core.types</span> <span class="kn">import</span> <span class="n">Document</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">LocalDB</span><span class="p">()</span>
<span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="c1"># Add the documents to the database</span>
<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">:</span>
    <span class="n">db</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="o">**</span><span class="n">doc</span><span class="p">))</span>

<span class="c1"># Filter the documents</span>
<span class="n">filtered_documents</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Document</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Solar Panels&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">filtered_documents</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="retriever-in-action">
<h2>Retriever in Action<a class="headerlink" href="#retriever-in-action" title="Link to this heading">¶</a></h2>
<p>All of our retrievers are  subclassed from the base retriever, and they are located in the <code class="docutils literal notranslate"><span class="pre">components.retriever</span></code> module.
You can skim through their implementations here: <a class="reference internal" href="../apis/components/components.retriever.html#components-retriever"><span class="std std-ref">retriever</span></a>.
Currently only <code class="xref py py-class docutils literal notranslate"><span class="pre">BM25Retriever</span></code> needs to have its own <code class="docutils literal notranslate"><span class="pre">save_to_file</span></code> and <code class="docutils literal notranslate"><span class="pre">load_from_file</span></code> to avoid recomputation again.
The <code class="docutils literal notranslate"><span class="pre">FAISSRetriever</span></code> will work with a database instead to store the embeddings and it alleviates the need for the retriever to deal with states saving.</p>
<section id="faissretriever">
<h3>FAISSRetriever<a class="headerlink" href="#faissretriever" title="Link to this heading">¶</a></h3>
<p>First, let’s do semantic search, here we will use in-memory <a class="reference internal" href="../apis/components/components.retriever.faiss_retriever.html#components.retriever.faiss_retriever.FAISSRetriever" title="components.retriever.faiss_retriever.FAISSRetriever"><code class="xref py py-class docutils literal notranslate"><span class="pre">FAISSRetriever</span></code></a>.
FAISS retriever takes embeddings which can be <code class="docutils literal notranslate"><span class="pre">List[float]</span></code> or <code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code> and build an index using FAISS library.
The query can take both embeddings and str formats.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">faiss</span></code> package is optional in our library. When you want to use it, ensure you have it installed in your env.</p>
</div>
<p>We will quickly prepare the embeddings of the above documents using <cite>content</cite> field.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.core.embedder</span> <span class="kn">import</span> <span class="n">Embedder</span>
<span class="kn">from</span> <span class="nn">adalflow.core.types</span> <span class="kn">import</span> <span class="n">ModelClientType</span>


<span class="n">model_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;text-embedding-3-small&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
    <span class="s2">&quot;encoding_format&quot;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">embedder</span> <span class="o">=</span> <span class="n">Embedder</span><span class="p">(</span><span class="n">model_client</span> <span class="o">=</span><span class="n">ModelClientType</span><span class="o">.</span><span class="n">OPENAI</span><span class="p">(),</span> <span class="n">model_kwargs</span><span class="o">=</span><span class="n">model_kwargs</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">embedder</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="p">[</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">])</span>
<span class="n">documents_embeddings</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">embedding</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
</pre></div>
</div>
<p>For the initialization, a retriever can take both its required documents along with hyperparmeters including <code class="docutils literal notranslate"><span class="pre">top_k</span></code>.
The <code class="docutils literal notranslate"><span class="pre">documents</span></code> field is optional. Let’s pass it all from <code class="docutils literal notranslate"><span class="pre">__init__</span></code> first:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.components.retriever</span> <span class="kn">import</span> <span class="n">FAISSRetriever</span>
<span class="n">retriever</span> <span class="o">=</span> <span class="n">FAISSRetriever</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">embedder</span><span class="o">=</span><span class="n">embedder</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="n">documents_embeddings</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">retriever</span><span class="p">)</span>
</pre></div>
</div>
<p>The printout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FAISSRetriever</span><span class="p">(</span>
 <span class="n">top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">prob</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">total_documents</span><span class="o">=</span><span class="mi">4</span>
 <span class="p">(</span><span class="n">embedder</span><span class="p">):</span> <span class="n">Embedder</span><span class="p">(</span>
    <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;text-embedding-3-small&#39;</span><span class="p">,</span> <span class="s1">&#39;dimensions&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span> <span class="s1">&#39;encoding_format&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">},</span>
    <span class="p">(</span><span class="n">model_client</span><span class="p">):</span> <span class="n">OpenAIClient</span><span class="p">()</span>
 <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We can also pass the documents using <a class="reference internal" href="../apis/components/components.retriever.faiss_retriever.html#components.retriever.faiss_retriever.FAISSRetriever.build_index_from_documents" title="components.retriever.faiss_retriever.FAISSRetriever.build_index_from_documents"><code class="xref py py-meth docutils literal notranslate"><span class="pre">build_index_from_documents</span></code></a> method after the initialization.
This is helpful when your retriever would need to work with different pool of documents each time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">retriever_1</span> <span class="o">=</span> <span class="n">FAISSRetriever</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">embedder</span><span class="o">=</span><span class="n">embedder</span><span class="p">)</span>
<span class="n">retriever_1</span><span class="o">.</span><span class="n">build_index_from_documents</span><span class="p">(</span><span class="n">documents</span><span class="o">=</span><span class="n">documents_embeddings</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we will do the retriever, the input can either be a single query or a list of queries:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">output_1</span> <span class="o">=</span> <span class="n">retriever</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">query_1</span><span class="p">)</span>
<span class="n">output_2</span> <span class="o">=</span> <span class="n">retriever</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">query_2</span><span class="p">)</span>
<span class="n">output_3</span> <span class="o">=</span> <span class="n">retriever</span><span class="p">(</span><span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="n">query_1</span><span class="p">,</span> <span class="n">query_2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output_1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output_2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output_3</span><span class="p">)</span>
</pre></div>
</div>
<p>The printout is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8119999766349792</span><span class="p">,</span> <span class="mf">0.7749999761581421</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;What are the benefits of renewable energy?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
<span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8169999718666077</span><span class="p">,</span> <span class="mf">0.8109999895095825</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;How do solar panels impact the environment?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
<span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8119999766349792</span><span class="p">,</span> <span class="mf">0.7749999761581421</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;What are the benefits of renewable energy?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8169999718666077</span><span class="p">,</span> <span class="mf">0.8109999895095825</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;How do solar panels impact the environment?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
</pre></div>
</div>
<p>In default, the score is a simulated probabity in range <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code> using consine similarity. The higher the score, the more relevant the document is to the query.
You can check the retriever for more type of scores.</p>
</section>
<section id="bm25retriever">
<h3>BM25Retriever<a class="headerlink" href="#bm25retriever" title="Link to this heading">¶</a></h3>
<p>So the semantic search works pretty well. We will see how <a class="reference internal" href="../apis/components/components.retriever.bm25_retriever.html#components.retriever.bm25_retriever.BM25Retriever" title="components.retriever.bm25_retriever.BM25Retriever"><code class="xref py py-class docutils literal notranslate"><span class="pre">BM25Retriever</span></code></a> works in comparison.
We reimplemented the code in <a class="footnote-reference brackets" href="#id17" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a> with one improvement: instead of using <code class="docutils literal notranslate"><span class="pre">text.split(&quot;</span> <span class="pre">&quot;)</span></code>, we use tokenizer to split the text. Here is a comparison of how they different:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.components.retriever.bm25_retriever</span> <span class="kn">import</span> <span class="n">split_text_by_word_fn_then_lower_tokenized</span><span class="p">,</span> <span class="n">split_text_by_word_fn</span>

<span class="n">query_1_words</span> <span class="o">=</span> <span class="n">split_text_by_word_fn</span><span class="p">(</span><span class="n">query_1</span><span class="p">)</span>
<span class="n">query_1_tokens</span> <span class="o">=</span> <span class="n">split_text_by_word_fn_then_lower_tokenized</span><span class="p">(</span><span class="n">query_1</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;what&#39;</span><span class="p">,</span> <span class="s1">&#39;are&#39;</span><span class="p">,</span> <span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;benefits&#39;</span><span class="p">,</span> <span class="s1">&#39;of&#39;</span><span class="p">,</span> <span class="s1">&#39;renewable&#39;</span><span class="p">,</span> <span class="s1">&#39;energy?&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;what&#39;</span><span class="p">,</span> <span class="s1">&#39;are&#39;</span><span class="p">,</span> <span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;benef&#39;</span><span class="p">,</span> <span class="s1">&#39;its&#39;</span><span class="p">,</span> <span class="s1">&#39;of&#39;</span><span class="p">,</span> <span class="s1">&#39;re&#39;</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span><span class="p">,</span> <span class="s1">&#39;able&#39;</span><span class="p">,</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>We prepare the retriever:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.components.retriever</span> <span class="kn">import</span> <span class="n">BM25Retriever</span>

<span class="n">document_map_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>

<span class="n">bm25_retriever</span> <span class="o">=</span> <span class="n">BM25Retriever</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span> <span class="n">document_map_func</span><span class="o">=</span><span class="n">document_map_func</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bm25_retriever</span><span class="p">)</span>
</pre></div>
</div>
<p>It takes <code class="docutils literal notranslate"><span class="pre">document_map_func</span></code> to map the documents to the text format the retriever can work with.
The output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BM25Retriever</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">k1</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">use_tokenizer</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">total_documents</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we call the retriever exactly the same way as we did with the FAISS retriever:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">output_1</span> <span class="o">=</span> <span class="n">bm25_retriever</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">query_1</span><span class="p">)</span>
<span class="n">output_2</span> <span class="o">=</span> <span class="n">bm25_retriever</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">query_2</span><span class="p">)</span>
<span class="n">output_3</span> <span class="o">=</span> <span class="n">bm25_retriever</span><span class="p">(</span><span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="n">query_1</span><span class="p">,</span> <span class="n">query_2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output_1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output_2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output_3</span><span class="p">)</span>
</pre></div>
</div>
<p>The printout is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="p">[</span><span class="mf">2.151683837681807</span><span class="p">,</span> <span class="mf">1.6294762236217233</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;What are the benefits of renewable energy?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
<span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5166601493236314</span><span class="p">,</span> <span class="mf">0.7790170272403408</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;How do solar panels impact the environment?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
<span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="p">[</span><span class="mf">2.151683837681807</span><span class="p">,</span> <span class="mf">1.6294762236217233</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;What are the benefits of renewable energy?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5166601493236314</span><span class="p">,</span> <span class="mf">0.7790170272403408</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;How do solar panels impact the environment?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
</pre></div>
</div>
<p>Here we see the first query returns <code class="docutils literal notranslate"><span class="pre">[2,</span> <span class="pre">1]</span></code> while the ground truth is <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">3]</span></code>. The second query returns <code class="docutils literal notranslate"><span class="pre">[3,</span> <span class="pre">2]</span></code> while the ground truth is <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2]</span></code>.
The performance is quite disappointing. BM25 is known for lack of semantic understanding and does not consider context.
We tested on the shorter and almost key-word like version of our queries and use both the <cite>title</cite> and <cite>content</cite>, and it gives the right response using the tokenized split.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query_1_short</span> <span class="o">=</span> <span class="s2">&quot;renewable energy?&quot;</span>  <span class="c1"># gt is [0, 3]</span>
<span class="n">query_2_short</span> <span class="o">=</span> <span class="s2">&quot;solar panels?&quot;</span>  <span class="c1"># gt is [1, 2]</span>
<span class="n">document_map_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
<span class="n">bm25_retriever</span><span class="o">.</span><span class="n">build_index_from_documents</span><span class="p">(</span><span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span> <span class="n">document_map_func</span><span class="o">=</span><span class="n">document_map_func</span><span class="p">)</span>
</pre></div>
</div>
<p>This time the retrieval gives us the right answer.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="p">[</span><span class="mf">0.9498793313012154</span><span class="p">,</span> <span class="mf">0.8031794089550072</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;renewable energy?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
<span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5343238380789569</span><span class="p">,</span> <span class="mf">0.4568096570283078</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;solar panels?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
</pre></div>
</div>
</section>
<section id="reranker-as-retriever">
<h3>Reranker as Retriever<a class="headerlink" href="#reranker-as-retriever" title="Link to this heading">¶</a></h3>
<p>Semantic search works well, and reranker basd on mostly <cite>cross-encoder</cite> model is supposed to work even better.
We have integrated two rerankers: <code class="docutils literal notranslate"><span class="pre">BAAI/bge-reranker-base</span></code> <a class="footnote-reference brackets" href="#id18" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>10<span class="fn-bracket">]</span></a> hosted on <code class="docutils literal notranslate"><span class="pre">transformers</span></code> and rerankers provided by <code class="docutils literal notranslate"><span class="pre">Cohere</span></code> <a class="footnote-reference brackets" href="#id19" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>11<span class="fn-bracket">]</span></a>.
These models follow the <code class="docutils literal notranslate"><span class="pre">ModelClient</span></code> protocol and are directly accessible as retriever from <a class="reference internal" href="../apis/components/components.retriever.reranker_retriever.html#components.retriever.reranker_retriever.RerankerRetriever" title="components.retriever.reranker_retriever.RerankerRetriever"><code class="xref py py-class docutils literal notranslate"><span class="pre">RerankerRetriever</span></code></a>.</p>
<p><strong>Reranker ModelClient Integration</strong></p>
<p>A reranker will take <code class="docutils literal notranslate"><span class="pre">ModelType.RERANKER</span></code> and the standard AdalFlow library requires it to have four arguments in the <code class="docutils literal notranslate"><span class="pre">model_kwargs</span></code>:
<code class="docutils literal notranslate"><span class="pre">['model',</span> <span class="pre">'top_k',</span> <span class="pre">'documents',</span> <span class="pre">'query']</span></code>. It is in the ModelClient which converts AdalFlow’s standard arguments to the model’s specific arguments.
If you want to intergrate your reranker, either locally or using APIs, check out <a class="reference internal" href="../apis/components/components.model_client.transformers_client.html#components.model_client.transformers_client.TransformersClient" title="components.model_client.transformers_client.TransformersClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransformersClient</span></code></a> and
<a class="reference internal" href="../apis/components/components.model_client.cohere_client.html#components.model_client.cohere_client.CohereAPIClient" title="components.model_client.cohere_client.CohereAPIClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">CohereAPIClient</span></code></a> for how to do it.</p>
<p>To use it from the <code class="docutils literal notranslate"><span class="pre">RerankerRetriever</span></code>, we only need to pass the <code class="docutils literal notranslate"><span class="pre">model</span></code> along with other arguments who does not
require conversion in the <code class="docutils literal notranslate"><span class="pre">model_kwargs</span></code>. Here is how we use model  <cite>rerank-english-v3.0</cite> from Cohere(Make sure you have the cohere sdk installed and prepared your api key):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.components.retriever</span> <span class="kn">import</span> <span class="n">RerankerRetriever</span>

<span class="n">model_client</span> <span class="o">=</span> <span class="n">ModelClientType</span><span class="o">.</span><span class="n">COHERE</span><span class="p">()</span>
<span class="n">model_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;rerank-english-v3.0&quot;</span><span class="p">}</span>


<span class="n">reranker</span> <span class="o">=</span> <span class="n">RerankerRetriever</span><span class="p">(</span>
    <span class="n">top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span> <span class="n">model_kwargs</span><span class="o">=</span><span class="n">model_kwargs</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reranker</span><span class="p">)</span>
</pre></div>
</div>
<p>The printout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RerankerRetriever</span><span class="p">(</span>
    <span class="n">top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;rerank-english-v3.0&#39;</span><span class="p">},</span> <span class="n">model_client</span><span class="o">=</span><span class="n">CohereAPIClient</span><span class="p">(),</span> <span class="n">total_documents</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">(</span><span class="n">model_client</span><span class="p">):</span> <span class="n">CohereAPIClient</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now we build the index and do the retrieval:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">document_map_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
<span class="n">reranker</span><span class="o">.</span><span class="n">build_index_from_documents</span><span class="p">(</span><span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span> <span class="n">document_map_func</span><span class="o">=</span><span class="n">document_map_func</span><span class="p">)</span>

<span class="n">output_1</span> <span class="o">=</span> <span class="n">reranker</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">query_1</span><span class="p">)</span>
<span class="n">output_2</span> <span class="o">=</span> <span class="n">reranker</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">query_2</span><span class="p">)</span>
<span class="n">output_3</span> <span class="o">=</span> <span class="n">reranker</span><span class="p">(</span><span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="n">query_1</span><span class="p">,</span> <span class="n">query_2</span><span class="p">])</span>
</pre></div>
</div>
<p>From the structure after adding documents we see the reranker has passed the documents to the <code class="docutils literal notranslate"><span class="pre">model_kwargs</span></code> so that it can send it all to the <code class="docutils literal notranslate"><span class="pre">ModelClient</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RerankerRetriever</span><span class="p">(</span>
    <span class="n">top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;rerank-english-v3.0&#39;</span><span class="p">,</span> <span class="s1">&#39;documents&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Renewable energy technologies not only help in reducing greenhouse gas emissions but also contribute significantly to the economy by creating jobs in the manufacturing and installation sectors. The growth in renewable energy usage boosts local economies through increased investment in technology and infrastructure.&#39;</span><span class="p">,</span> <span class="s1">&#39;Solar panels convert sunlight into electricity by allowing photons, or light particles, to knock electrons free from atoms, generating a flow of electricity. Solar panels are a type of renewable energy technology that has been found to have a significant positive effect on the environment by reducing the reliance on fossil fuels.&#39;</span><span class="p">,</span> <span class="s1">&#39;While solar energy offers substantial environmental benefits, such as reducing carbon footprints and pollution, it also has downsides. The production of solar panels can lead to hazardous waste, and large solar farms require significant land, which can disrupt local ecosystems.&#39;</span><span class="p">,</span> <span class="s1">&#39;Renewable energy sources like wind, solar, and hydro power play a crucial role in combating climate change. They do not produce greenhouse gases during operation, making them essential for sustainable development. However, the initial setup and material sourcing for these technologies can still have environmental impacts.&#39;</span><span class="p">]},</span> <span class="n">model_client</span><span class="o">=</span><span class="n">CohereAPIClient</span><span class="p">(),</span> <span class="n">total_documents</span><span class="o">=</span><span class="mi">4</span>
    <span class="p">(</span><span class="n">model_client</span><span class="p">):</span> <span class="n">CohereAPIClient</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
<p>From the results we see it gets the right answer and has a close to 1 score.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="p">[</span><span class="mf">0.99520767</span><span class="p">,</span> <span class="mf">0.9696708</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;What are the benefits of renewable energy?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
<span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="p">[</span><span class="mf">0.98742366</span><span class="p">,</span> <span class="mf">0.9701269</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;How do solar panels impact the environment?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
<span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="p">[</span><span class="mf">0.99520767</span><span class="p">,</span> <span class="mf">0.9696708</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;What are the benefits of renewable energy?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="p">[</span><span class="mf">0.98742366</span><span class="p">,</span> <span class="mf">0.9701269</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;How do solar panels impact the environment?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
</pre></div>
</div>
<p>Now let us see how the <a href="#id6"><span class="problematic" id="id7">``</span></a>BAAI/bge-reranker-base` from local transformers model works:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model_client</span> <span class="o">=</span> <span class="n">ModelClientType</span><span class="o">.</span><span class="n">TRANSFORMERS</span><span class="p">()</span>
<span class="n">model_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;BAAI/bge-reranker-base&quot;</span><span class="p">}</span>

<span class="n">reranker</span> <span class="o">=</span> <span class="n">RerankerRetriever</span><span class="p">(</span>
    <span class="n">top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
    <span class="n">model_kwargs</span><span class="o">=</span><span class="n">model_kwargs</span><span class="p">,</span>
    <span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span>
    <span class="n">document_map_func</span><span class="o">=</span><span class="n">document_map_func</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reranker</span><span class="p">)</span>
</pre></div>
</div>
<p>The printout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RerankerRetriever</span><span class="p">(</span>
    <span class="n">top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;BAAI/bge-reranker-base&#39;</span><span class="p">,</span> <span class="s1">&#39;documents&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Renewable energy technologies not only help in reducing greenhouse gas emissions but also contribute significantly to the economy by creating jobs in the manufacturing and installation sectors. The growth in renewable energy usage boosts local economies through increased investment in technology and infrastructure.&#39;</span><span class="p">,</span> <span class="s1">&#39;Solar panels convert sunlight into electricity by allowing photons, or light particles, to knock electrons free from atoms, generating a flow of electricity. Solar panels are a type of renewable energy technology that has been found to have a significant positive effect on the environment by reducing the reliance on fossil fuels.&#39;</span><span class="p">,</span> <span class="s1">&#39;While solar energy offers substantial environmental benefits, such as reducing carbon footprints and pollution, it also has downsides. The production of solar panels can lead to hazardous waste, and large solar farms require significant land, which can disrupt local ecosystems.&#39;</span><span class="p">,</span> <span class="s1">&#39;Renewable energy sources like wind, solar, and hydro power play a crucial role in combating climate change. They do not produce greenhouse gases during operation, making them essential for sustainable development. However, the initial setup and material sourcing for these technologies can still have environmental impacts.&#39;</span><span class="p">]},</span> <span class="n">model_client</span><span class="o">=</span><span class="n">TransformersClient</span><span class="p">(),</span> <span class="n">total_documents</span><span class="o">=</span><span class="mi">4</span>
    <span class="p">(</span><span class="n">model_client</span><span class="p">):</span> <span class="n">TransformersClient</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Here is the retrieval result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="p">[</span><span class="mf">0.9996004700660706</span><span class="p">,</span> <span class="mf">0.9950029253959656</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;What are the benefits of renewable energy?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
<span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="p">[</span><span class="mf">0.9994490742683411</span><span class="p">,</span> <span class="mf">0.9994476437568665</span><span class="p">],</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;How do solar panels impact the environment?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
</pre></div>
</div>
<p>It missed one at the second query, but it is at the top 3.
Semantically,  these documents might be close.
If we use top_k = 3, the genearator might be able to filter out the irrelevant one and eventually give out the right final response.
Also, if we use both the <cite>title</cite> and <cite>content</cite>, it will also got the right response.</p>
</section>
<section id="llm-as-retriever">
<h3>LLM as Retriever<a class="headerlink" href="#llm-as-retriever" title="Link to this heading">¶</a></h3>
<p>There are differen ways to use LLM as a retriever:</p>
<ol class="arabic simple">
<li><p>Directly show it of all documents and query and ask it to return the indices of the top_k as a list.</p></li>
<li><p>Put the query and document a pair and ask it to do a <cite>yes</cite> and <cite>no</cite>. Additionally, we can use its <cite>logprobs</cite> of the <cite>yes</cite> token to get a probability-like score. We will implement this in the near future, for now, you can refer <a class="footnote-reference brackets" href="#id16" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a> to implement it yourself.</p></li>
</ol>
<p>For the first case, with out prompt and zero-shot, <cite>gpt-3.5-turbo</cite> is not working as well as <cite>gpt-4o</cite> which got both answers right.
Here is our code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.components.retriever</span> <span class="kn">import</span> <span class="n">LLMRetriever</span>

<span class="n">model_client</span> <span class="o">=</span> <span class="n">ModelClientType</span><span class="o">.</span><span class="n">OPENAI</span><span class="p">()</span>
<span class="n">model_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">document_map_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
<span class="n">llm_retriever</span> <span class="o">=</span> <span class="n">LLMRetriever</span><span class="p">(</span>
        <span class="n">top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
        <span class="n">model_kwargs</span><span class="o">=</span><span class="n">model_kwargs</span><span class="p">,</span>
        <span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span>
        <span class="n">document_map_func</span><span class="o">=</span><span class="n">document_map_func</span>
    <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">llm_retriever</span><span class="p">)</span>
</pre></div>
</div>
<p>The printout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>LLMRetriever(
    top_k=2, total_documents=4,
    (generator): Generator(
        model_kwargs={&#39;model&#39;: &#39;gpt-4o&#39;},
        (prompt): Prompt(
        template: &lt;SYS&gt;
        You are a retriever. Given a list of documents, you will retrieve the top_k {{top_k}} most relevant documents and output the indices (int) as a list:
        [&lt;index of the most relevant with top_k options&gt;]
        &lt;Documents&gt;
        {% for doc in documents %}
        ```Index {{ loop.index - 1 }}. {{ doc }}```
        {% endfor %}
        &lt;/Documents&gt;
        &lt;/SYS&gt;
        Query: {{ input_str }}
        You:
        , preset_prompt_kwargs: {&#39;top_k&#39;: 2, &#39;documents&#39;: [&#39;Renewable energy technologies not only help in reducing greenhouse gas emissions but also contribute significantly to the economy by creating jobs in the manufacturing and installation sectors. The growth in renewable energy usage boosts local economies through increased investment in technology and infrastructure.&#39;, &#39;Solar panels convert sunlight into electricity by allowing photons, or light particles, to knock electrons free from atoms, generating a flow of electricity. Solar panels are a type of renewable energy technology that has been found to have a significant positive effect on the environment by reducing the reliance on fossil fuels.&#39;, &#39;While solar energy offers substantial environmental benefits, such as reducing carbon footprints and pollution, it also has downsides. The production of solar panels can lead to hazardous waste, and large solar farms require significant land, which can disrupt local ecosystems.&#39;, &#39;Renewable energy sources like wind, solar, and hydro power play a crucial role in combating climate change. They do not produce greenhouse gases during operation, making them essential for sustainable development. However, the initial setup and material sourcing for these technologies can still have environmental impacts.&#39;]}, prompt_variables: [&#39;documents&#39;, &#39;top_k&#39;, &#39;input_str&#39;]
        )
        (model_client): OpenAIClient()
        (output_processors): ListParser()
    )
)
</pre></div>
</div>
<p>Here is the response:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;What are the benefits of renewable energy?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
<span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;How do solar panels impact the environment?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
</pre></div>
</div>
<p>We can call the retriever with different model without reinitializing the retriever. Here is how we do it with <cite>gpt-3.5-turbo</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">output_1</span> <span class="o">=</span> <span class="n">llm_retriever</span><span class="p">(</span><span class="n">model_kwargs</span><span class="o">=</span><span class="n">model_kwargs</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">query_1</span><span class="p">)</span>
<span class="n">output_2</span> <span class="o">=</span> <span class="n">llm_retriever</span><span class="p">(</span><span class="n">model_kwargs</span><span class="o">=</span><span class="n">model_kwargs</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">query_2</span><span class="p">)</span>
</pre></div>
</div>
<p>The response is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;What are the benefits of renewable energy?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
<span class="p">[</span><span class="n">RetrieverOutput</span><span class="p">(</span><span class="n">doc_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">doc_scores</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;How do solar panels impact the environment?&#39;</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
</pre></div>
</div>
</section>
<section id="qdrant-retriever">
<h3>Qdrant Retriever<a class="headerlink" href="#qdrant-retriever" title="Link to this heading">¶</a></h3>
<p>You can retrieve documents loaded into your <a class="reference external" href="https://qdrant.tech/">Qdrant</a> collections using the <a class="reference internal" href="../apis/components/components.retriever.qdrant_retriever.html#components.retriever.qdrant_retriever.QdrantRetriever" title="components.retriever.qdrant_retriever.QdrantRetriever"><code class="xref py py-class docutils literal notranslate"><span class="pre">QdrantRetriever</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Install the <code class="docutils literal notranslate"><span class="pre">qdrant-client</span></code> package in your project to use this retriever.</p>
</div>
<p>The retriever supports any embeddings provider. The field to be returned from the Qdrant payload can be configured along with other parameters like filters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.components.retriever</span> <span class="kn">import</span> <span class="n">QdrantRetriever</span>
<span class="kn">from</span> <span class="nn">qdrant_client</span> <span class="kn">import</span> <span class="n">QdrantClient</span>


<span class="n">client</span> <span class="o">=</span> <span class="n">QdrantClient</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://localhost:6333&quot;</span><span class="p">)</span>
<span class="n">qdrant_retriever</span> <span class="o">=</span> <span class="n">QdrantRetriever</span><span class="p">(</span>
    <span class="n">collection_name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{collection_name}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
    <span class="n">embedder</span><span class="o">=</span><span class="n">embedder</span><span class="p">,</span>
    <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">text_key</span><span class="o">=</span><span class="s2">&quot;content&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qdrant_retriever</span><span class="p">)</span>
</pre></div>
</div>
<p>The output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">QdrantRetriever</span><span class="p">(</span>
    <span class="p">(</span><span class="n">_embedder</span><span class="p">):</span> <span class="n">Embedder</span><span class="p">(</span>
        <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;text-embedding-3-small&#39;</span><span class="p">,</span> <span class="s1">&#39;dimensions&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span> <span class="s1">&#39;encoding_format&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">},</span>
        <span class="p">(</span><span class="n">model_client</span><span class="p">):</span> <span class="n">OpenAIClient</span><span class="p">()</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We can invoke the Qdrant retriever like the others:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">output_1</span> <span class="o">=</span> <span class="n">qdrant_retriever</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">query_1</span><span class="p">)</span>
<span class="n">output_2</span> <span class="o">=</span> <span class="n">qdrant_retriever</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">query_2</span><span class="p">)</span>
<span class="n">output_3</span> <span class="o">=</span> <span class="n">qdrant_retriever</span><span class="p">(</span><span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="n">query_1</span><span class="p">,</span> <span class="n">query_2</span><span class="p">])</span>
</pre></div>
</div>
<p>You can use <a class="reference external" href="https://qdrant.tech/documentation/concepts/filtering/">filters</a> to further refine the search results as per requirements when setting up the retriever.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qdrant_client</span> <span class="kn">import</span> <span class="n">models</span>

<span class="n">qdrant_retriever</span> <span class="o">=</span> <span class="n">QdrantRetriever</span><span class="p">(</span>
    <span class="n">collection_name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{collection_name}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
    <span class="n">embedder</span><span class="o">=</span><span class="n">embedder</span><span class="p">,</span>
    <span class="n">text_key</span><span class="o">=</span><span class="s2">&quot;content&quot;</span><span class="p">,</span>
    <span class="nb">filter</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span>
        <span class="n">must</span><span class="o">=</span><span class="p">[</span>
            <span class="n">models</span><span class="o">.</span><span class="n">FieldCondition</span><span class="p">(</span>
                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">,</span>
                <span class="n">match</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">MatchValue</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;facts&quot;</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">models</span><span class="o">.</span><span class="n">FieldCondition</span><span class="p">(</span>
                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span>
                <span class="nb">range</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">gte</span><span class="o">=</span><span class="mf">0.98</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="lancedbretriever">
<h3>LanceDBRetriever<a class="headerlink" href="#lancedbretriever" title="Link to this heading">¶</a></h3>
<p>To perform semantic search using LanceDB, we will use <code class="xref py py-class docutils literal notranslate"><span class="pre">LanceDBRetriever</span></code>.
The <cite>LanceDBRetriever</cite> is designed for efficient vector-based retrieval with LanceDB, leveraging embeddings that can be either <code class="docutils literal notranslate"><span class="pre">List[float]</span></code> or <code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code>.
LanceDB supports in-memory and disk-based configurations and can handle large-scale data with high retrieval speed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lancedb</span></code> package is optional. Ensure you have it installed in your environment to use LanceDBRetriever.</p>
</div>
<p>We will prepare the document embeddings using the <cite>content</cite> field.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.core.embedder</span> <span class="kn">import</span> <span class="n">Embedder</span>
<span class="kn">from</span> <span class="nn">adalflow.core.types</span> <span class="kn">import</span> <span class="n">ModelClientType</span>

<span class="n">model_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;text-embedding-3-small&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
    <span class="s2">&quot;encoding_format&quot;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">embedder</span> <span class="o">=</span> <span class="n">Embedder</span><span class="p">(</span><span class="n">model_client</span><span class="o">=</span><span class="n">ModelClientType</span><span class="o">.</span><span class="n">OPENAI</span><span class="p">(),</span> <span class="n">model_kwargs</span><span class="o">=</span><span class="n">model_kwargs</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">embedder</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="p">[</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">])</span>
</pre></div>
</div>
<p>After initializing the LanceDB retriever, we can add documents and perform retrievals. The retriever can be set with its top-k hyperparameter during initialization.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.components.retriever</span> <span class="kn">import</span> <span class="n">LanceDBRetriever</span>
<span class="n">retriever</span> <span class="o">=</span> <span class="n">LanceDBRetriever</span><span class="p">(</span><span class="n">embedder</span><span class="o">=</span><span class="n">embedder</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">db_uri</span><span class="o">=</span><span class="s2">&quot;/tmp/lancedb&quot;</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">retriever</span><span class="p">)</span>
</pre></div>
</div>
<p>The printout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LanceDBRetriever</span><span class="p">(</span>
 <span class="n">top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">total_documents</span><span class="o">=</span><span class="mi">0</span>
 <span class="p">(</span><span class="n">embedder</span><span class="p">):</span> <span class="n">Embedder</span><span class="p">(</span>
    <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;text-embedding-3-small&#39;</span><span class="p">,</span> <span class="s1">&#39;dimensions&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span> <span class="s1">&#39;encoding_format&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">},</span>
    <span class="p">(</span><span class="n">model_client</span><span class="p">):</span> <span class="n">OpenAIClient</span><span class="p">()</span>
 <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We can add documents to LanceDB and use the retriever for query-based searches.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">retriever</span><span class="o">.</span><span class="n">add_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

<span class="c1"># Perform retrieval queries</span>
<span class="n">output_1</span> <span class="o">=</span> <span class="n">retriever</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">&quot;What are the benefits of renewable energy?&quot;</span><span class="p">)</span>
<span class="n">output_2</span> <span class="o">=</span> <span class="n">retriever</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">&quot;How do solar panels impact the environment?&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Query 1 Results:&quot;</span><span class="p">,</span> <span class="n">output_1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Query 2 Results:&quot;</span><span class="p">,</span> <span class="n">output_2</span><span class="p">)</span>
</pre></div>
</div>
<p>This setup allows the <cite>LanceDBRetriever</cite> to function as an efficient tool for large-scale, embedding-based document retrieval within LanceDB.</p>
</section>
<section id="postgresretriever">
<h3>PostgresRetriever<a class="headerlink" href="#postgresretriever" title="Link to this heading">¶</a></h3>
<p>Coming soon.</p>
</section>
<section id="use-score-threshold-instead-of-top-k">
<h3>Use Score Threshold instead of top_k<a class="headerlink" href="#use-score-threshold-instead-of-top-k" title="Link to this heading">¶</a></h3>
<p>In some cases, when the retriever has a computed score and you might prefer to use the score instead of <code class="docutils literal notranslate"><span class="pre">top_k</span></code> to filter out the relevant documents.
To do so, you can simplify set the <code class="docutils literal notranslate"><span class="pre">top_k</span></code> to the full size of the documents and use a post-processing step or a component(to chain with the retriever) to filter out the documents with the score below the threshold.</p>
</section>
</section>
<section id="use-together-with-database">
<h2>Use together with Database<a class="headerlink" href="#use-together-with-database" title="Link to this heading">¶</a></h2>
<p>When the scale of data is large, we will use a database to store the computed embeddings and indexes from the documents.</p>
<section id="with-localdb">
<h3>With LocalDB<a class="headerlink" href="#with-localdb" title="Link to this heading">¶</a></h3>
<p>We have previously computed embeddings, now let us <a class="reference internal" href="../apis/core/core.db.html#core.db.LocalDB" title="core.db.LocalDB"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocalDB</span></code></a> to help with the persistence.
(Although you can totally persist them yourself such as using pickle).
Additionally, <code class="docutils literal notranslate"><span class="pre">LocalDB</span></code> help us keep track of our initial documents and its transformed documents.</p>
<div class="highlight admonition">
<p class="admonition-title">References</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id9" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<p>Full-text search on PostgreSQL: <a class="reference external" href="https://www.postgresql.org/docs/current/textsearch.html">https://www.postgresql.org/docs/current/textsearch.html</a></p>
</aside>
<aside class="footnote brackets" id="id10" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></span>
<p>BM25: <a class="reference external" href="https://en.wikipedia.org/wiki/Okapi_BM25">https://en.wikipedia.org/wiki/Okapi_BM25</a></p>
</aside>
<aside class="footnote brackets" id="id11" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></span>
<p>Representative learning models: <a class="reference external" href="https://arxiv.org/abs/2310.07554">https://arxiv.org/abs/2310.07554</a></p>
</aside>
<aside class="footnote brackets" id="id12" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></span>
<p>Reranking models: <a class="reference external" href="https://github.com/FlagOpen/FlagEmbedding/tree/master/FlagEmbedding/llm_reranker">https://github.com/FlagOpen/FlagEmbedding/tree/master/FlagEmbedding/llm_reranker</a></p>
</aside>
<aside class="footnote brackets" id="id13" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></span>
<p>FAISS: <a class="reference external" href="https://github.com/facebookresearch/faiss">https://github.com/facebookresearch/faiss</a></p>
</aside>
<aside class="footnote brackets" id="id14" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">6</a><span class="fn-bracket">]</span></span>
<p>Lost-in-the-middle: <a class="reference external" href="https://arxiv.org/abs/2307.03172">https://arxiv.org/abs/2307.03172</a></p>
</aside>
<aside class="footnote brackets" id="id15" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">7</a><span class="fn-bracket">]</span></span>
<p>Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks(RAG): <a class="reference external" href="https://arxiv.org/abs/2005.11401">https://arxiv.org/abs/2005.11401</a></p>
</aside>
<aside class="footnote brackets" id="id16" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">8</a><span class="fn-bracket">]</span></span>
<p>Use LLM as Reranker along with logprobs: <a class="reference external" href="https://cookbook.openai.com/examples/search_reranking_with_cross-encoders/">https://cookbook.openai.com/examples/search_reranking_with_cross-encoders/</a></p>
</aside>
<aside class="footnote brackets" id="id17" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">9</a><span class="fn-bracket">]</span></span>
<p>Rank_bm25: <a class="reference external" href="https://github.com/dorianbrown/rank_bm25">https://github.com/dorianbrown/rank_bm25</a></p>
</aside>
<aside class="footnote brackets" id="id18" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">10</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://huggingface.co/BAAI/bge-reranker-base">https://huggingface.co/BAAI/bge-reranker-base</a></p>
</aside>
<aside class="footnote brackets" id="id19" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">11</a><span class="fn-bracket">]</span></span>
<p>Cohere reranker: <a class="reference external" href="https://docs.cohere.com/reference/rerank">https://docs.cohere.com/reference/rerank</a></p>
</aside>
</aside>
</div>
<div class="highlight admonition">
<p class="admonition-title">API References</p>
<ul class="simple">
<li><p><a class="reference internal" href="../apis/core/core.retriever.html#core.retriever.Retriever" title="core.retriever.Retriever"><code class="xref py py-class docutils literal notranslate"><span class="pre">core.retriever.Retriever</span></code></a></p></li>
<li><p><a class="reference internal" href="../apis/core/core.types.html#core-types"><span class="std std-ref">core.types</span></a></p></li>
<li><p><a class="reference internal" href="../apis/components/components.retriever.faiss_retriever.html#components.retriever.faiss_retriever.FAISSRetriever" title="components.retriever.faiss_retriever.FAISSRetriever"><code class="xref py py-class docutils literal notranslate"><span class="pre">components.retriever.faiss_retriever.FAISSRetriever</span></code></a></p></li>
<li><p><a class="reference internal" href="../apis/components/components.retriever.bm25_retriever.html#components.retriever.bm25_retriever.BM25Retriever" title="components.retriever.bm25_retriever.BM25Retriever"><code class="xref py py-class docutils literal notranslate"><span class="pre">components.retriever.bm25_retriever.BM25Retriever</span></code></a></p></li>
<li><p><a class="reference internal" href="../apis/components/components.retriever.reranker_retriever.html#components.retriever.reranker_retriever.RerankerRetriever" title="components.retriever.reranker_retriever.RerankerRetriever"><code class="xref py py-class docutils literal notranslate"><span class="pre">components.retriever.reranker_retriever.RerankerRetriever</span></code></a></p></li>
<li><p><a class="reference internal" href="../apis/components/components.retriever.llm_retriever.html#components.retriever.llm_retriever.LLMRetriever" title="components.retriever.llm_retriever.LLMRetriever"><code class="xref py py-class docutils literal notranslate"><span class="pre">components.retriever.llm_retriever.LLMRetriever</span></code></a></p></li>
<li><p><a class="reference internal" href="../apis/components/components.retriever.qdrant_retriever.html#components.retriever.qdrant_retriever.QdrantRetriever" title="components.retriever.qdrant_retriever.QdrantRetriever"><code class="xref py py-class docutils literal notranslate"><span class="pre">components.retriever.qdrant_retriever.QdrantRetriever</span></code></a></p></li>
</ul>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="text_splitter.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Text Splitter</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="embedder.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Embedder</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, SylphAI, Inc
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Retriever</a><ul>
<li><a class="reference internal" href="#design">Design</a><ul>
<li><a class="reference internal" href="#scope-and-design-goals">Scope and Design Goals</a></li>
<li><a class="reference internal" href="#with-database">With Database</a></li>
<li><a class="reference internal" href="#retriever-data-types">Retriever Data Types</a></li>
<li><a class="reference internal" href="#retriever-base-class">Retriever Base Class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#experiment-data">Experiment data</a></li>
<li><a class="reference internal" href="#documents-filtering">Documents filtering</a></li>
<li><a class="reference internal" href="#retriever-in-action">Retriever in Action</a><ul>
<li><a class="reference internal" href="#faissretriever">FAISSRetriever</a></li>
<li><a class="reference internal" href="#bm25retriever">BM25Retriever</a></li>
<li><a class="reference internal" href="#reranker-as-retriever">Reranker as Retriever</a></li>
<li><a class="reference internal" href="#llm-as-retriever">LLM as Retriever</a></li>
<li><a class="reference internal" href="#qdrant-retriever">Qdrant Retriever</a></li>
<li><a class="reference internal" href="#lancedbretriever">LanceDBRetriever</a></li>
<li><a class="reference internal" href="#postgresretriever">PostgresRetriever</a></li>
<li><a class="reference internal" href="#use-score-threshold-instead-of-top-k">Use Score Threshold instead of top_k</a></li>
</ul>
</li>
<li><a class="reference internal" href="#use-together-with-database">Use together with Database</a><ul>
<li><a class="reference internal" href="#with-localdb">With LocalDB</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/js/rtd_search_config.js"></script>
    <script src="../_static/js/rtd_sphinx_search.min.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>