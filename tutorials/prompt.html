
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Prompt &#8212; AdalFlow: The Library to Build and Auto-Optimize LLM Task Pipelines</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=5422b685" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/rtd_sphinx_search.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/js/rtd_search_config.js"></script>
    <script src="../_static/js/rtd_sphinx_search.min.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/prompt';</script>
    <link rel="icon" href="../_static/LightRAG-logo-circle.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ModelClient" href="model_client.html" />
    <link rel="prev" title="DataClass" href="base_data_class.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/adalflow-logo.png" class="logo__image only-light" alt="AdalFlow: The Library to Build and Auto-Optimize LLM Task Pipelines - Home"/>
    <script>document.write(`<img src="../_static/adalflow-logo.png" class="logo__image only-dark" alt="AdalFlow: The Library to Build and Auto-Optimize LLM Task Pipelines - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../get_started/index.html">
    Get Started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Developer Notes
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../use_cases/index.html">
    Use Cases
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../apis/index.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/SylphAI-Inc/LightRAG" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discord.gg/ezzszrRZvT" title="Discord" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discord fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discord</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../get_started/index.html">
    Get Started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Developer Notes
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../use_cases/index.html">
    Use Cases
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../apis/index.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/SylphAI-Inc/LightRAG" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://discord.gg/ezzszrRZvT" title="Discord" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discord fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discord</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lightrag_design_philosophy.html">Design Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_hierarchy.html">Class Hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="trace_graph.html">AdalFlow Trace Graph</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Base Classes</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="component.html">Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="base_data_class.html">DataClass</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">RAG Essentials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Prompt</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_client.html">ModelClient</a></li>
<li class="toctree-l1"><a class="reference internal" href="generator.html">Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_parsers.html">Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="embedder.html">Embedder</a></li>
<li class="toctree-l1"><a class="reference internal" href="retriever.html">Retriever</a></li>
<li class="toctree-l1"><a class="reference internal" href="text_splitter.html">Text Splitter</a></li>
<li class="toctree-l1"><a class="reference internal" href="db.html">Data (Database/Pipeline) &amp; RAG</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Agent Essentials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tool_helper.html">Function calls</a></li>
<li class="toctree-l1"><a class="reference internal" href="agent.html">Agent</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Evaluating</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="evaluation.html">LLM Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="datasets.html">Datasets</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Logging &amp; Tracing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging_tracing.html">Tracing</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Developer Notes</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Prompt</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div style="display: flex; justify-content: flex-start; align-items: center; margin-bottom: 20px;">
   <a href="https://colab.research.google.com/drive/1_sGeHaKrwpI9RiL01g3cKyI2_5PJqZtr?usp=sharing" target="_blank" style="margin-right: 10px;">
      <img alt="Try Quickstart in Colab" src="https://colab.research.google.com/assets/colab-badge.svg" style="vertical-align: middle;">
   </a>
   <a href="https://github.com/SylphAI-Inc/LightRAG/blob/main/tutorials/prompt_note.py" target="_blank" style="display: flex; align-items: center;">
      <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" style="height: 20px; width: 20px; margin-right: 5px;">
      <span style="vertical-align: middle;"> Open Source Code</span>
   </a>
</div><section id="prompt">
<h1>Prompt<a class="headerlink" href="#prompt" title="Link to this heading">#</a></h1>
<p>The prompt refers to the text input to the LLM models.
When sent to an LLM, the model uses the prompt to auto-regressively generate the next tokens, continuing the process until it reaches a specified stopping criterion.
The prompt itself plays a crucial role in the performance of the desired tasks.
Researchers often use <cite>special tokens</cite> <a class="footnote-reference brackets" href="#id3" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> to separate different sections of the prompt, such as the system message, user message, and assistant message.
Ideally, developers should format this prompt with special tokens specific to the model’s at training time.
However, many proprietary APIs did not disclose their special tokens, and requires users to send them in the forms of messages of different roles.</p>
<section id="design">
<h2>Design<a class="headerlink" href="#design" title="Link to this heading">#</a></h2>
<p><cite>AdalFlow</cite> seeks to maximize developers’ control over the prompt.
Thus, in most cases, we help developers gather different sections and form them into one prompt.
This prompt will then be sent to the LLM as a single message.
The default role of the message we use is <cite>system</cite>.
Though it is not a special token, we use <code class="docutils literal notranslate"><span class="pre">&lt;SYS&gt;&lt;/SYS&gt;</span></code> to represent the system message in the prompt, which works quite well.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">simple_prompt</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;&lt;SYS&gt; You are a helpful assistant. &lt;/SYS&gt; User: What can you help me with?&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>If it is <cite>Llama3</cite> model, the final text sent to the model for tokenization will be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">final_prompt</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;&lt;|begin_of_text|&gt;&lt;|start_header_id|&gt;system&lt;|end_header_id|&gt;</span>
<span class="s2">{{simple_prompt}} &lt;|eot_id|&gt;&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>And the LLM will return the following text:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prediction</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;&lt;|start_header_id|&gt;assistant&lt;|end_header_id|&gt; You can ask me anything you want. &lt;|eot_id|&gt;&lt;|end_of_text|&gt;&quot;&quot;&quot;</span>
</pre></div>
</div>
<section id="data-flow-in-llm-applications">
<h3>Data Flow in LLM applications<a class="headerlink" href="#data-flow-in-llm-applications" title="Link to this heading">#</a></h3>
<figure class="align-center" id="id5">
<a class="reference internal image-reference" href="../_images/LightRAG_dataflow.png"><img alt="Data Flow in LLM applications" src="../_images/LightRAG_dataflow.png" style="width: 620px;" />
</a>
<figcaption>
<p><span class="caption-text">Data flow in LLM applications</span><a class="headerlink" href="#id5" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Look at the most complicated case: We will have user query, retrieved context, task description, definition of tools, few-shot examples, past conversation history, step history from the agent, and the output format specification.
All these different parts need to be formatted into a single prompt.
We have to do all this with flexibility and also make it easy for developers to read.</p>
</section>
<section id="why-jinja2">
<h3>Why Jinja2?<a class="headerlink" href="#why-jinja2" title="Link to this heading">#</a></h3>
<p>To format the prompt, you can use any of Python’s native string formatting.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span> <span class="c1"># percent(%) formatting</span>
<span class="linenos"> 2</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&lt;SYS&gt;</span><span class="si">%s</span><span class="s2">&lt;/SYS&gt; User: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">task_desc_str</span><span class="p">,</span> <span class="n">input_str</span><span class="p">))</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span> <span class="c1"># format() method with kwargs</span>
<span class="linenos"> 5</span> <span class="nb">print</span><span class="p">(</span>
<span class="linenos"> 6</span>     <span class="s2">&quot;&lt;SYS&gt;</span><span class="si">{task_desc_str}</span><span class="s2">&lt;/SYS&gt; User: </span><span class="si">{input_str}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos"> 7</span>         <span class="n">task_desc_str</span><span class="o">=</span><span class="n">task_desc_str</span><span class="p">,</span> <span class="n">input_str</span><span class="o">=</span><span class="n">input_str</span>
<span class="linenos"> 8</span>     <span class="p">)</span>
<span class="linenos"> 9</span> <span class="p">)</span>
<span class="linenos">10</span>
<span class="linenos">11</span> <span class="c1"># f-string</span>
<span class="linenos">12</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;SYS&gt;</span><span class="si">{</span><span class="n">task_desc_str</span><span class="si">}</span><span class="s2">&lt;/SYS&gt; User: </span><span class="si">{</span><span class="n">input_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">13</span>
<span class="linenos">14</span> <span class="c1"># Templates</span>
<span class="linenos">15</span> <span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">Template</span>
<span class="linenos">16</span>
<span class="linenos">17</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s2">&quot;&lt;SYS&gt;$task_desc_str&lt;/SYS&gt; User: $input_str&quot;</span><span class="p">)</span>
<span class="linenos">18</span> <span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="n">task_desc_str</span><span class="o">=</span><span class="n">task_desc_str</span><span class="p">,</span> <span class="n">input_str</span><span class="o">=</span><span class="n">input_str</span><span class="p">))</span>
</pre></div>
</div>
<p>We opted for <cite>Jinja2</cite> <a class="footnote-reference brackets" href="#id3" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> as the templating engine for the prompt.
Besides the placeholders using <code class="docutils literal notranslate"><span class="pre">{{}}</span></code> for keyword arguments, Jinja2 also allow users to write code similar to Python syntax.
This includes conditionals, loops, filters, and even comments, which are lacking in Python’s native string formatting.
Here is one example of using <cite>Jinja2</cite> to format the prompt:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">jinja2_template_example</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
   <span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Template</span>

   <span class="n">template</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;&lt;SYS&gt;{{ task_desc_str }}&lt;/SYS&gt;</span>
<span class="s2">{# tools #}</span>
<span class="s2">{</span><span class="si">% i</span><span class="s2">f tools %}</span>
<span class="s2">&lt;TOOLS&gt;</span>
<span class="s2">{</span><span class="si">% f</span><span class="s2">or tool in tools %}</span>
<span class="s2">{{loop.index}}. {{ tool }}</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="s2">&lt;/TOOLS&gt;</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndif %}</span>
<span class="s2">User: {{ input_str }}&quot;&quot;&quot;</span>
   <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">trim_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lstrip_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
</pre></div>
</div>
<p>Let’s call it with and without tools:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">jinja2_template_example</span><span class="p">(</span><span class="n">task_desc_str</span><span class="o">=</span><span class="n">task_desc_str</span><span class="p">,</span> <span class="n">input_str</span><span class="o">=</span><span class="n">input_str</span><span class="p">)</span>
<span class="n">jinja2_template_example</span><span class="p">(</span>
     <span class="n">task_desc_str</span><span class="o">=</span><span class="n">task_desc_str</span><span class="p">,</span> <span class="n">input_str</span><span class="o">=</span><span class="n">input_str</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="n">tools</span>
 <span class="p">)</span>
</pre></div>
</div>
<p>The printout would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;SYS&gt;You are a helpful assitant&lt;/SYS&gt;
User: What is the capital of France?
</pre></div>
</div>
<p>And with tools:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;SYS&gt;You are a helpful assitant&lt;/SYS&gt;
&lt;TOOLS&gt;
1. google
2. wikipedia
3. wikidata
&lt;/TOOLS&gt;
User: What is the capital of France?
</pre></div>
</div>
<p>We can see how easy and flexible to programmatically format the prompt with <cite>Jinja2</cite>.</p>
</section>
</section>
<section id="prompt-class">
<h2>Prompt class<a class="headerlink" href="#prompt-class" title="Link to this heading">#</a></h2>
<p>We created our <a class="reference internal" href="../apis/core/core.prompt_builder.html#core.prompt_builder.Prompt" title="core.prompt_builder.Prompt"><code class="xref py py-class docutils literal notranslate"><span class="pre">Prompt</span> <span class="pre">Component</span></code></a> to render the prompt with the string <code class="docutils literal notranslate"><span class="pre">template</span></code> and <code class="docutils literal notranslate"><span class="pre">prompt_kwargs</span></code>.
It is a simple component, but it is quite handy.
Let’s use the same template as above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.core.prompt_builder</span> <span class="kn">import</span> <span class="n">Prompt</span>

<span class="n">prompt</span> <span class="o">=</span> <span class="n">Prompt</span><span class="p">(</span>
   <span class="n">template</span><span class="o">=</span><span class="n">template</span><span class="p">,</span>
   <span class="n">prompt_kwargs</span><span class="o">=</span><span class="p">{</span>
      <span class="s2">&quot;task_desc_str&quot;</span><span class="p">:</span> <span class="n">task_desc_str</span><span class="p">,</span>
      <span class="s2">&quot;tools&quot;</span><span class="p">:</span> <span class="n">tools</span><span class="p">,</span>
   <span class="p">},</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="p">(</span><span class="n">input_str</span><span class="o">=</span><span class="n">input_str</span><span class="p">))</span> <span class="c1"># takes the rest arguments in keyword arguments</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Prompt</span></code> class allow us to preset some of the prompt arguments at initialization, and then we can call the prompt with the rest of the arguments.
Also, by subclassing <code class="docutils literal notranslate"><span class="pre">Component</span></code>, we can easily visualize this component with <code class="docutils literal notranslate"><span class="pre">print</span></code>.
Here is the output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Prompt</span><span class="p">(</span>
   <span class="n">template</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">SYS</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">task_desc_str</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">SYS</span><span class="o">&gt;</span>
   <span class="p">{</span><span class="c1"># tools #}</span>
   <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">tools</span> <span class="o">%</span><span class="p">}</span>
   <span class="o">&lt;</span><span class="n">TOOLS</span><span class="o">&gt;</span>
   <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span> <span class="o">%</span><span class="p">}</span>
   <span class="p">{{</span><span class="n">loop</span><span class="o">.</span><span class="n">index</span><span class="p">}}</span><span class="o">.</span> <span class="p">{{</span> <span class="n">tool</span> <span class="p">}}</span>
   <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
   <span class="o">&lt;/</span><span class="n">TOOLS</span><span class="o">&gt;</span>
   <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
   <span class="n">User</span><span class="p">:</span> <span class="p">{{</span> <span class="n">input_str</span> <span class="p">}},</span> <span class="n">prompt_kwargs</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;task_desc_str&#39;</span><span class="p">:</span> <span class="s1">&#39;You are a helpful assitant&#39;</span><span class="p">,</span> <span class="s1">&#39;tools&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;google&#39;</span><span class="p">,</span> <span class="s1">&#39;wikipedia&#39;</span><span class="p">,</span> <span class="s1">&#39;wikidata&#39;</span><span class="p">]},</span> <span class="n">prompt_variables</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;input_str&#39;</span><span class="p">,</span> <span class="s1">&#39;tools&#39;</span><span class="p">,</span> <span class="s1">&#39;task_desc_str&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>As with all components, you can use <code class="docutils literal notranslate"><span class="pre">to_dict</span></code> and <code class="docutils literal notranslate"><span class="pre">from_dict</span></code> to serialize and deserialize the component.</p>
</section>
<section id="default-prompt-template">
<h2>Default Prompt Template<a class="headerlink" href="#default-prompt-template" title="Link to this heading">#</a></h2>
<p>In default, the <code class="docutils literal notranslate"><span class="pre">Prompt</span></code> class uses the <a class="reference internal" href="../apis/core/core.default_prompt_template.html#id0" title="core.default_prompt_template.DEFAULT_LIGHTRAG_SYSTEM_PROMPT"><code class="xref py py-const docutils literal notranslate"><span class="pre">DEFAULT_LIGHTRAG_SYSTEM_PROMPT</span></code></a> as its string template if no template is provided.
This default template allows you to conditionally passing seven important variables designed from the data flow diagram above.
These varaibles are:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">LIGHTRAG_DEFAULT_PROMPT_ARGS</span> <span class="o">=</span> <span class="p">[</span>
   <span class="s2">&quot;task_desc_str&quot;</span><span class="p">,</span>  <span class="c1"># task description</span>
   <span class="s2">&quot;output_format_str&quot;</span><span class="p">,</span>  <span class="c1"># output format of the task</span>
   <span class="s2">&quot;tools_str&quot;</span><span class="p">,</span>  <span class="c1"># tools used in the task</span>
   <span class="s2">&quot;examples_str&quot;</span><span class="p">,</span>  <span class="c1"># examples of the task</span>
   <span class="s2">&quot;chat_history_str&quot;</span><span class="p">,</span>  <span class="c1"># chat history of the user</span>
   <span class="s2">&quot;context_str&quot;</span><span class="p">,</span>  <span class="c1"># context of the user query</span>
   <span class="s2">&quot;steps_str&quot;</span><span class="p">,</span>  <span class="c1"># used in agent steps</span>
   <span class="s2">&quot;input_str&quot;</span><span class="p">,</span>  <span class="c1"># user query or input</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Now, let’s see the minimum case where we only have the user query:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prompt</span> <span class="o">=</span> <span class="n">Prompt</span><span class="p">()</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">prompt</span><span class="p">(</span><span class="n">input_str</span><span class="o">=</span><span class="n">input_str</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>The output will be the bare minimum with only the user query and a prefix for assistant to respond:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;User&gt;
What is the capital of France?
&lt;/User&gt;
You:
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In reality, we barely need to use the raw <code class="docutils literal notranslate"><span class="pre">Prompt</span></code> class directly as it is orchestrated by the <code class="docutils literal notranslate"><span class="pre">Generator</span></code> component together with the <code class="docutils literal notranslate"><span class="pre">ModelClient</span></code> that we will introduce next.</p>
</div>
<div class="highlight admonition">
<p class="admonition-title">References</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id3" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id2">2</a>)</span>
<p>Jinja2: <a class="reference external" href="https://jinja.palletsprojects.com/en/3.1.x/">https://jinja.palletsprojects.com/en/3.1.x/</a></p>
</aside>
<aside class="footnote brackets" id="id4" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></span>
<p>Llama3 special tokens: <a class="reference external" href="https://llama.meta.com/docs/model-cards-and-prompt-formats/meta-llama-3/">https://llama.meta.com/docs/model-cards-and-prompt-formats/meta-llama-3/</a></p>
</aside>
</aside>
</div>
<div class="highlight admonition">
<p class="admonition-title">API References</p>
<ul class="simple">
<li><p><a class="reference internal" href="../apis/core/core.prompt_builder.html#core.prompt_builder.Prompt" title="core.prompt_builder.Prompt"><code class="xref py py-class docutils literal notranslate"><span class="pre">core.prompt_builder.Prompt</span></code></a></p></li>
<li><p><a class="reference internal" href="../apis/core/core.default_prompt_template.html#id0" title="core.default_prompt_template.DEFAULT_LIGHTRAG_SYSTEM_PROMPT"><code class="xref py py-const docutils literal notranslate"><span class="pre">core.default_prompt_template.DEFAULT_LIGHTRAG_SYSTEM_PROMPT</span></code></a></p></li>
</ul>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="base_data_class.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">DataClass</p>
      </div>
    </a>
    <a class="right-next"
       href="model_client.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">ModelClient</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design">Design</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-flow-in-llm-applications">Data Flow in LLM applications</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-jinja2">Why Jinja2?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prompt-class">Prompt class</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#default-prompt-template">Default Prompt Template</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, SylphAI, Inc.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>