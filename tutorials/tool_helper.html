<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Agent" href="agent.html" /><link rel="prev" title="RAG with Memory" href="rag_with_memory.html" />

    <link rel="shortcut icon" href="../_static/LightRAG-logo-circle.png"/><!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>Function calls - Build and Optimize LM Workflows</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=f0068426" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/rtd_sphinx_search.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #FF6F00;
  --color-brand-content: #1E2A38;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #FF8F00;
  --color-brand-content: #CFD8DC;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #FF8F00;
  --color-brand-content: #CFD8DC;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Build and Optimize LM Workflows</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/images/AdalFlow.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/images/AdalFlow_black_bg.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Build and Optimize LM Workflows</span>
  
</a><div class="sidebar-github-section">
    <a href="https://github.com/SylphAI-Inc/AdalFlow" class="sidebar-github-link">
        <i class="fa-brands fa-github"></i>
        <span class="github-text">GitHub</span>
    </a>
</div><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../new_tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/core_concepts.html">Core Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/prompt.html">Prompt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/parser.html">Parser and Structured Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/generator.html">Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/embedder.html">Embedder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/tool.html">Tool Use</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../integrations/index.html">Integrations</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Integrations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../integrations/integrations.html">All Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/anthropic.html">Anthropic Integration</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../use_cases/index.html">Use Cases</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Use Cases</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/question_answering.html">Question Answering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/qa_computation_graph.html">Q&amp;A Computation Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/qa_text_grad_trace_graph.html">Q&amp;A Text Grad Trace Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/qa_demo_trace_graph.html">Q&amp;A Few Shot Demo Trace Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/classification.html">Classification Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/rag_opt.html">RAG optimization</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../contributor/index.html">Contributor Guide</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Contributor Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../contributor/contribution.html">Contributing Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributor/contribute_to_code.html">Development Essentials</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Developer Notes</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Developer Notes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="lightrag_design_philosophy.html">Design Philosophy</a></li>
<li class="toctree-l2"><a class="reference internal" href="class_hierarchy.html">Class Hierarchy</a></li>
<li class="toctree-l2"><a class="reference internal" href="trace_graph.html">AdalFlow Trace Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="component.html">Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="base_data_class.html">DataClass</a></li>
<li class="toctree-l2"><a class="reference internal" href="prompt.html">Prompt</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_client.html">ModelClient</a></li>
<li class="toctree-l2"><a class="reference internal" href="generator.html">Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="generator.html#basic-generator-tutorial">Basic Generator Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="output_parsers.html">Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="embedder.html">Embedder</a></li>
<li class="toctree-l2"><a class="reference internal" href="retriever.html">Retriever</a></li>
<li class="toctree-l2"><a class="reference internal" href="text_splitter.html">Text Splitter</a></li>
<li class="toctree-l2"><a class="reference internal" href="db.html">Data (Database/Pipeline)</a></li>
<li class="toctree-l2"><a class="reference internal" href="rag_playbook.html">RAG Playbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="rag_with_memory.html">RAG with Memory</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Function calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="agent.html">Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="evaluation.html">LLM Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="datasets.html">Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logger Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html#design">Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html#use-logger-in-projects">Use Logger in Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging_tracing.html">Tracing</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../design/index.html">Blog</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Blog</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../design/ComponentTool.html">Use Class method as a better function tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/FunctionTool.html">Designing of AdalFlow FunctionTool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/agent-streaming.html">Agent Streaming Architecture in OpenAI Agents SDK</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../apis/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/core/index.html">Core</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Core</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.base_data_class.html">base_data_class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.component.html">component</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.container.html">container</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.default_prompt_template.html">default_prompt_template</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.embedder.html">embedder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.generator.html">generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.model_client.html">model_client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.prompt_builder.html">prompt_builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.retriever.html">retriever</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.string_parser.html">string_parser</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.func_tool.html">func_tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.tool_manager.html">tool_manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.types.html">types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.db.html">db</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.functional.html">functional</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.tokenizer.html">tokenizer</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/components/index.html">Components</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Components</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.model_client.html">model_client</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of model_client</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.anthropic_client.html">anthropic_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.azureai_client.html">azureai_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.bedrock_client.html">bedrock_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.cohere_client.html">cohere_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.deepseek_client.html">deepseek_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.fireworks_client.html">fireworks_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.google_client.html">google_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.groq_client.html">groq_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.mistral_client.html">mistral_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.ollama_client.html">ollama_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.openai_client.html">openai_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.sambanova_client.html">sambanova_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.together_client.html">together_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.transformers_client.html">transformers_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.utils.html">utils</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.xai_client.html">xai_client</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.retriever.html">retriever</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of retriever</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.bm25_retriever.html">bm25_retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.faiss_retriever.html">faiss_retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.lancedb_retriver.html">lancedb_retriver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.llm_retriever.html">llm_retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.postgres_retriever.html">postgres_retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.qdrant_retriever.html">qdrant_retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.reranker_retriever.html">reranker_retriever</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.output_parsers.html">output_parsers</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of output_parsers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.output_parsers.dataclass_parser.html">dataclass_parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.output_parsers.outputs.html">outputs</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.agent.html">agent</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of agent</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.agent.react.html">react</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.data_process.html">data_process</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of data_process</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.data_process.data_components.html">data_components</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.data_process.text_splitter.html">text_splitter</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.memory.html">memory</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of memory</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.memory.memory.html">memory</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/datasets/index.html">Datasets</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Datasets</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/datasets/datasets.big_bench_hard.html">big_bench_hard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/datasets/datasets.trec.html">trec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/datasets/datasets.hotpot_qa.html">hotpot_qa</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/datasets/datasets.types.html">types</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/eval/index.html">Evaluation</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of Evaluation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/eval/eval.base.html">base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/eval/eval.answer_match_acc.html">answer_match_acc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/eval/eval.retriever_recall.html">retriever_recall</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/eval/eval.llm_as_judge.html">llm_as_judge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/eval/eval.g_eval.html">g_eval</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/optim/index.html">Optimization</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Optimization</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/optim/optim.parameter.html">parameter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/optim/optim.optimizer.html">optimizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/optim/optim.grad_component.html">grad_component</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/optim/optim.loss_component.html">loss_component</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/optim/optim.types.html">types</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/optim/optim.few_shot.html">few_shot</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of few_shot</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.few_shot.bootstrap_optimizer.html">bootstrap_optimizer</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/optim/optim.text_grad.html">text_grad</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of text_grad</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.text_grad.backend_engine_prompt.html">backend_engine_prompt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.text_grad.llm_text_loss.html">llm_text_loss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.text_grad.ops.html">ops</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.text_grad.text_loss_with_eval_fn.html">text_loss_with_eval_fn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.text_grad.tgd_optimizer.html">tgd_optimizer</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/optim/optim.trainer.html">trainer</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of trainer</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.trainer.adal.html">adal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.trainer.trainer.html">trainer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/tracing/index.html">Tracing</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of Tracing</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/tracing/tracing.decorators.html">decorators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/tracing/tracing.generator_state_logger.html">generator_state_logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/tracing/tracing.generator_call_logger.html">generator_call_logger</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/utils/index.html">Utils</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of Utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.data.html">data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.setup_env.html">setup_env</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.logger.html">logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.file_io.html">file_io</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.config.html">config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.lazy_import.html">lazy_import</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.registry.html">registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.serialization.html">serialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.cache.html">cache</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <div style="display: flex; justify-content: flex-start; align-items: center; gap: 15px; margin-bottom: 20px;">
<a target="_blank" href="https://colab.research.google.com/github/SylphAI-Inc/AdalFlow/blob/main/notebooks/tutorials/adalflow_function_calls.ipynb">
    <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/>
</a>
<a href="https://github.com/SylphAI-Inc/AdalFlow/blob/main/tutorials/adalflow_function_calls.py" target="_blank" style="display: flex; align-items: center;">
    <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" style="height: 20px; width: 20px; margin-right: 5px;">
    <span style="vertical-align: middle;"> Open Source Code</span>
</a>
</div><section id="function-calls">
<span id="tool-helper"></span><h1>Function calls<a class="headerlink" href="#function-calls" title="Link to this heading">¶</a></h1>
<p>Tools are means LLM can use to interact with the world beyond of its internal knowledge <a class="footnote-reference brackets" href="#id4" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. Technically speaking, retrievers are tools to help LLM to get more relevant context, and memory is a tool for LLM to carry out a conversation.
Deciding when, which, and how to use a tool, and even to creating a tool is an agentic behavior:
Function calls is a process of showing LLM a list of funciton definitions and prompt it to choose one or few of them.
Many places use tools and function calls interchangably.</p>
<p>In this note we will covert function calls, including</p>
<ol class="arabic simple">
<li><p>Function call walkthrough</p></li>
<li><p>Overall design</p></li>
<li><p>Function call in action</p></li>
<li><p>MCP (Model Context Protocol) tools <a class="footnote-reference brackets" href="#id5" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> as function calls.</p></li>
</ol>
<section id="quick-walkthrough">
<h2>Quick Walkthrough<a class="headerlink" href="#quick-walkthrough" title="Link to this heading">¶</a></h2>
<p>Users might already know of OpenAI’s function call feature via its API (<a class="reference external" href="https://platform.openai.com/docs/guides/function-calling">https://platform.openai.com/docs/guides/function-calling</a>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_current_weather</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;fahrenheit&quot;</span><span class="p">):</span>
<span class="w"> </span><span class="sd">&quot;&quot;&quot;Get the current weather in a given location&quot;&quot;&quot;</span>
 <span class="kn">import</span> <span class="nn">json</span>

 <span class="k">if</span> <span class="s2">&quot;tokyo&quot;</span> <span class="ow">in</span> <span class="n">location</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
     <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;Tokyo&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="n">unit</span><span class="p">})</span>
 <span class="k">elif</span> <span class="s2">&quot;san francisco&quot;</span> <span class="ow">in</span> <span class="n">location</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
     <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
         <span class="p">{</span><span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;San Francisco&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="s2">&quot;72&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="n">unit</span><span class="p">}</span>
     <span class="p">)</span>
 <span class="k">elif</span> <span class="s2">&quot;paris&quot;</span> <span class="ow">in</span> <span class="n">location</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
     <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;Paris&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="s2">&quot;22&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="n">unit</span><span class="p">})</span>
 <span class="k">else</span><span class="p">:</span>
     <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>For the above function, it is shown to LLM in the following format:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">function_definition</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
    <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;get_current_weather&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Get the current weather in a given location&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The city and state, e.g. San Francisco, CA&quot;</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;enum&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;celsius&quot;</span><span class="p">,</span> <span class="s2">&quot;fahrenheit&quot;</span><span class="p">]},</span>
            <span class="p">},</span>
            <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then the API will respond with a list of function names and parameters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Function</span><span class="p">(</span><span class="n">arguments</span><span class="o">=</span><span class="s1">&#39;{&quot;location&quot;: &quot;San Francisco, CA&quot;}&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;get_current_weather&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then the output will need to be parsed into arguments which are then passed to the function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">function_name</span> <span class="o">=</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">name</span>
<span class="n">function_to_call</span> <span class="o">=</span> <span class="n">available_functions</span><span class="p">[</span><span class="n">function_name</span><span class="p">]</span>
<span class="n">function_args</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span>
<span class="n">function_response</span> <span class="o">=</span> <span class="n">function_to_call</span><span class="p">(</span>
    <span class="n">location</span><span class="o">=</span><span class="n">function_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">),</span>
    <span class="n">unit</span><span class="o">=</span><span class="n">function_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="scope-and-design">
<h2>Scope and Design<a class="headerlink" href="#scope-and-design" title="Link to this heading">¶</a></h2>
<p>Even with API, users have to (1) create the function definition, (2) Parse the response, (3) Execute the function.
What is missing in using API is: (1) How the function definitions are shown to LLM, (2) How the output format is instructured.</p>
<p>AdalFlow will provide built-in capabilities to do function calls simplily via prompt without relying on the tools API.</p>
<p><strong>Design Goals</strong></p>
<p>Asking LLM to call a function with keyword arguments is the simplest way of achieving the function call.
But it is limiting:</p>
<ol class="arabic simple">
<li><p>What if the argument value is a more complicated data structure?</p></li>
<li><p>What if you want to use a variable as an argument?</p></li>
</ol>
<p>AdalFlow will also provide <code class="docutils literal notranslate"><span class="pre">FunctionExpression</span></code> where calling a function is asking LLM to write the code snippet of the function call directly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;get_current_weather(&quot;San Francisco, CA&quot;, unit=&quot;celsius&quot;)&#39;</span>
</pre></div>
</div>
<p>This is not only more flexible, but also it is also a more efficient/compact way to call a function.</p>
<p><strong>Data Models</strong></p>
<p>We have four <code class="docutils literal notranslate"><span class="pre">DataClass</span></code> models: <a class="reference internal" href="../apis/core/core.types.html#core.types.FunctionDefinition" title="core.types.FunctionDefinition"><code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionDefinition</span></code></a>, <a class="reference internal" href="../apis/core/core.types.html#core.types.Function" title="core.types.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">Function</span></code></a>, <a class="reference internal" href="../apis/core/core.types.html#core.types.FunctionExpression" title="core.types.FunctionExpression"><code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionExpression</span></code></a>, and <a class="reference internal" href="../apis/core/core.types.html#core.types.FunctionOutput" title="core.types.FunctionOutput"><code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionOutput</span></code></a> to handle function calls.</p>
<p>These classes not only help with data structuring but also by being a subclass of <code class="docutils literal notranslate"><span class="pre">DataClass</span></code>, it can be easily used in the prompt.
<code class="docutils literal notranslate"><span class="pre">Function</span></code> has three important attributes: <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">args</span></code>, and <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> for the function name, positional arguments and keyword arguments.
<code class="docutils literal notranslate"><span class="pre">FunctionExpression</span></code> only has one action for the function call expression.
Both can be used to format the output in the prompt. We will demonstrate how to use it later.</p>
<p><strong>Components</strong></p>
<p>We have two components: <a class="reference internal" href="../apis/core/core.func_tool.html#core.func_tool.FunctionTool" title="core.func_tool.FunctionTool"><code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionTool</span></code></a> and <a class="reference internal" href="../apis/core/core.tool_manager.html#core.tool_manager.ToolManager" title="core.tool_manager.ToolManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">ToolManager</span></code></a> to streamline the lifecyle of (1)
creating the function definition (2) formatting the prompt with the definitions and output format (3) parsing the response (4) executing the function.</p>
<p><code class="docutils literal notranslate"><span class="pre">FunctionTool</span></code> is a container of a single function. It handles the function definition and executing of the function. It supports both sync and async functions.
<code class="docutils literal notranslate"><span class="pre">ToolManager</span></code> manages all tools. And it handles the execution and context_map that is used to parse the functions sercurely.</p>
<p><code class="docutils literal notranslate"><span class="pre">ToolManager</span></code> is simplified way to do function calls.</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Attribute/Method</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Attributes</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">tools</span></code></p></td>
<td><p>A list of tools managed by ToolManager. Each tool is an instance or a derivative of <code class="docutils literal notranslate"><span class="pre">FunctionTool</span></code>.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">context</span></code></p></td>
<td><p>A dictionary combining tool definitions and additional context, used for executing function expressions.</p></td>
</tr>
<tr class="row-even"><td><p>Methods</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">__init__</span></code></p></td>
<td><p>Initializes a new ToolManager instance with tools and additional context. Tool can be <code class="docutils literal notranslate"><span class="pre">FunctionTool</span></code> or any function.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">yaml_definitions</span></code></p></td>
<td><p>Returns the YAML definitions of all tools managed by ToolManager.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">json_definitions</span></code></p></td>
<td><p>Returns the JSON definitions of all tools managed by ToolManager.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">function_definitions</span></code></p></td>
<td><p>Returns a list of function definitions for all tools.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">parse_func_expr</span></code></p></td>
<td><p>Parses a <code class="docutils literal notranslate"><span class="pre">FunctionExpression</span></code> and returns a <code class="docutils literal notranslate"><span class="pre">Function</span></code> object ready for execution.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">execute_func</span></code></p></td>
<td><p>Executes a given <code class="docutils literal notranslate"><span class="pre">Function</span></code> object and returns its output wrapped in <code class="docutils literal notranslate"><span class="pre">FunctionOutput</span></code>. Support both sync and async functions.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">execute_func_expr</span></code></p></td>
<td><p>Parses and executes a <code class="docutils literal notranslate"><span class="pre">FunctionExpression</span></code> directly, returning the execution result as <code class="docutils literal notranslate"><span class="pre">FunctionOutput</span></code>. Support both sync and async functions.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">execute_func_expr_via_sandbox</span></code></p></td>
<td><p>Execute the function expression via sandbox. Only support sync functions.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">execute_func_expr_via_eval</span></code></p></td>
<td><p>Execute the function expression via eval. Only support sync functions.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="function-call-in-action">
<h2>Function Call in Action<a class="headerlink" href="#function-call-in-action" title="Link to this heading">¶</a></h2>
<p>We will use the following functions as examples across this note:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">asyncio</span>


<span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiply two numbers.&quot;&quot;&quot;</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>


<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add two numbers.&quot;&quot;&quot;</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">divide</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Divide two numbers.&quot;&quot;&quot;</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search for query and return a list of results.&quot;&quot;&quot;</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;result1&quot;</span> <span class="o">+</span> <span class="n">query</span><span class="p">,</span> <span class="s2">&quot;result2&quot;</span> <span class="o">+</span> <span class="n">query</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">numpy_sum</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sum the elements of an array.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>


<span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>


<span class="k">def</span> <span class="nf">add_points</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>We delibrately cover both async and sync, examples of using variables and more complicated data structures as arguments.
We will demonstrate the structure and how to use each data model and component to call the above functions in different ways.</p>
<section id="functiontool">
<h3>1. FunctionTool<a class="headerlink" href="#functiontool" title="Link to this heading">¶</a></h3>
<p>First, let’s see how we help describe the function to LLM.</p>
<p>Use the above functions as examples, <code class="docutils literal notranslate"><span class="pre">FunctionTool</span></code> will generate the <code class="docutils literal notranslate"><span class="pre">FunctionDefinition</span></code> for each function automatically if the user did not pass it in.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.core.func_tool</span> <span class="kn">import</span> <span class="n">FunctionTool</span>

<span class="n">functions</span> <span class="o">=</span><span class="p">[</span><span class="n">multiply</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">divide</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="n">numpy_sum</span><span class="p">,</span> <span class="n">add_points</span><span class="p">]</span>
<span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">FunctionTool</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">)</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">functions</span>
<span class="p">]</span>
<span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>
</pre></div>
</div>
<p>The printout shows three attributes for each function: <code class="docutils literal notranslate"><span class="pre">fn</span></code>, <code class="docutils literal notranslate"><span class="pre">_is_async</span></code>, and <code class="docutils literal notranslate"><span class="pre">definition</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FunctionTool</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">multiply</span> <span class="n">at</span> <span class="mh">0x14d9d3f60</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">async</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="n">definition</span><span class="p">:</span> <span class="n">FunctionDefinition</span><span class="p">(</span><span class="n">func_name</span><span class="o">=</span><span class="s1">&#39;multiply&#39;</span><span class="p">,</span> <span class="n">func_desc</span><span class="o">=</span><span class="s1">&#39;multiply(a: int, b: int) -&gt; int</span><span class="se">\n</span><span class="s1">Multiply two numbers.&#39;</span><span class="p">,</span> <span class="n">func_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">},</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]}))</span>
<span class="n">FunctionTool</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">add</span> <span class="n">at</span> <span class="mh">0x14d9e4040</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">async</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="n">definition</span><span class="p">:</span> <span class="n">FunctionDefinition</span><span class="p">(</span><span class="n">func_name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">func_desc</span><span class="o">=</span><span class="s1">&#39;add(a: int, b: int) -&gt; int</span><span class="se">\n</span><span class="s1">Add two numbers.&#39;</span><span class="p">,</span> <span class="n">func_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">},</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]}))</span>
<span class="n">FunctionTool</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">divide</span> <span class="n">at</span> <span class="mh">0x14d9e40e0</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">async</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="n">definition</span><span class="p">:</span> <span class="n">FunctionDefinition</span><span class="p">(</span><span class="n">func_name</span><span class="o">=</span><span class="s1">&#39;divide&#39;</span><span class="p">,</span> <span class="n">func_desc</span><span class="o">=</span><span class="s1">&#39;divide(a: float, b: float) -&gt; float</span><span class="se">\n</span><span class="s1">Divide two numbers.&#39;</span><span class="p">,</span> <span class="n">func_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">},</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]}))</span>
<span class="n">FunctionTool</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">search</span> <span class="n">at</span> <span class="mh">0x14d9e4180</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">async</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="n">definition</span><span class="p">:</span> <span class="n">FunctionDefinition</span><span class="p">(</span><span class="n">func_name</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="n">func_desc</span><span class="o">=</span><span class="s1">&#39;search(query: str) -&gt; List[str]</span><span class="se">\n</span><span class="s1">Search for query and return a list of results.&#39;</span><span class="p">,</span> <span class="n">func_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span><span class="p">}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]}))</span>
<span class="n">FunctionTool</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">numpy_sum</span> <span class="n">at</span> <span class="mh">0x14d9e4220</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">async</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="n">definition</span><span class="p">:</span> <span class="n">FunctionDefinition</span><span class="p">(</span><span class="n">func_name</span><span class="o">=</span><span class="s1">&#39;numpy_sum&#39;</span><span class="p">,</span> <span class="n">func_desc</span><span class="o">=</span><span class="s1">&#39;numpy_sum(arr: numpy.ndarray) -&gt; float</span><span class="se">\n</span><span class="s1">Sum the elements of an array.&#39;</span><span class="p">,</span> <span class="n">func_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;arr&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;arr&#39;</span><span class="p">]}))</span>
<span class="n">FunctionTool</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">add_points</span> <span class="n">at</span> <span class="mh">0x14d9e4360</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">async</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="n">definition</span><span class="p">:</span> <span class="n">FunctionDefinition</span><span class="p">(</span><span class="n">func_name</span><span class="o">=</span><span class="s1">&#39;add_points&#39;</span><span class="p">,</span> <span class="n">func_desc</span><span class="o">=</span><span class="s1">&#39;add_points(p1: __main__.Point, p2: __main__.Point) -&gt; __main__.Point</span><span class="se">\n</span><span class="s1">None&#39;</span><span class="p">,</span> <span class="n">func_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;p1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">},</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]},</span> <span class="s1">&#39;p2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">},</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;p1&#39;</span><span class="p">,</span> <span class="s1">&#39;p2&#39;</span><span class="p">]}))</span>
</pre></div>
</div>
<p>View the definition for <code class="docutils literal notranslate"><span class="pre">add_point</span></code> and also the <code class="docutils literal notranslate"><span class="pre">get_current_weather</span></code> function in dict format:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">tools</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">definition</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</pre></div>
</div>
<p>The output will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;func_name&quot;</span><span class="p">:</span> <span class="s2">&quot;numpy_sum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;func_desc&quot;</span><span class="p">:</span> <span class="s2">&quot;numpy_sum(arr: numpy.ndarray) -&gt; float</span><span class="se">\n</span><span class="s2">Sum the elements of an array.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;func_parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;arr&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ndarray&quot;</span><span class="p">}},</span>
        <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;arr&quot;</span><span class="p">],</span>
        <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">to_json</span></code> and <code class="docutils literal notranslate"><span class="pre">to_yaml</span></code> will directly get us the string that can be fed into the prompt.
And we prefer to use <code class="docutils literal notranslate"><span class="pre">yaml</span></code> format here as it is more token efficient:</p>
<p>We choose to describe the function not only with the docstring which is <cite>Sum the elements of an array.</cite> but also with the function signature which is <cite>numpy_sum(arr: numpy.ndarray) -&gt; float</cite>.
This will give the LLM a view of the function at the code level and it helps with the function call.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Users should better use type hints and a good docstring to help LLM understand the function better.</p>
</div>
<p>In comparison, here is our definition for <code class="docutils literal notranslate"><span class="pre">get_current_weather</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;func_name&quot;</span><span class="p">:</span> <span class="s2">&quot;get_current_weather&quot;</span><span class="p">,</span>
    <span class="s2">&quot;func_desc&quot;</span><span class="p">:</span> <span class="s2">&quot;get_current_weather(location, unit=&#39;fahrenheit&#39;)</span><span class="se">\n</span><span class="s2">Get the current weather in a given location&quot;</span><span class="p">,</span>
    <span class="s2">&quot;func_parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Any&quot;</span><span class="p">},</span>
            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Any&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;fahrenheit&quot;</span><span class="p">},</span>
        <span class="p">},</span>
        <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">],</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To execute function using function names requres us to manage a function map. Instead of using the raw function, we use <code class="docutils literal notranslate"><span class="pre">FunctionTool</span></code> instead for this context map.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">context_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">tool</span><span class="o">.</span><span class="n">definition</span><span class="o">.</span><span class="n">func_name</span><span class="p">:</span> <span class="n">tool</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">}</span>
</pre></div>
</div>
<p>To execute a function, we can do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">function_name</span> <span class="o">=</span> <span class="s2">&quot;add&quot;</span>
<span class="n">function_to_call</span> <span class="o">=</span> <span class="n">context_map</span><span class="p">[</span><span class="n">function_name</span><span class="p">]</span>
<span class="n">function_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">function_response</span> <span class="o">=</span> <span class="n">function_to_call</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="o">**</span><span class="n">function_args</span><span class="p">)</span>
</pre></div>
</div>
<p>If we use async function, we can use <code class="docutils literal notranslate"><span class="pre">acall</span></code>.
<code class="docutils literal notranslate"><span class="pre">execute</span></code> is a wrapper that you can call a function in both sync and async way regardless of the function type.
Check out the API documentation for more details.</p>
</section>
<section id="toolmanager">
<h3>2. ToolManager<a class="headerlink" href="#toolmanager" title="Link to this heading">¶</a></h3>
<p>Using <code class="docutils literal notranslate"><span class="pre">ToolManager</span></code> on all the above function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.core.tool_manager</span> <span class="kn">import</span> <span class="n">ToolManager</span>

<span class="n">tool_manager</span> <span class="o">=</span> <span class="n">ToolManager</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">functions</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tool_manager</span><span class="p">)</span>
</pre></div>
</div>
<p>The tool manager can take both <code class="docutils literal notranslate"><span class="pre">FunctionTool</span></code>, function and async function.
The printout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ToolManager</span><span class="p">(</span><span class="n">Tools</span><span class="p">:</span> <span class="p">[</span><span class="n">FunctionTool</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">multiply</span> <span class="n">at</span> <span class="mh">0x105e3b920</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">async</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="n">definition</span><span class="p">:</span> <span class="n">FunctionDefinition</span><span class="p">(</span><span class="n">func_name</span><span class="o">=</span><span class="s1">&#39;multiply&#39;</span><span class="p">,</span> <span class="n">func_desc</span><span class="o">=</span><span class="s1">&#39;multiply(a: int, b: int) -&gt; int</span><span class="se">\n</span><span class="s1">Multiply two numbers.&#39;</span><span class="p">,</span> <span class="n">func_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">},</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]})),</span> <span class="n">FunctionTool</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">add</span> <span class="n">at</span> <span class="mh">0x105e3bc40</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">async</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="n">definition</span><span class="p">:</span> <span class="n">FunctionDefinition</span><span class="p">(</span><span class="n">func_name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">func_desc</span><span class="o">=</span><span class="s1">&#39;add(a: int, b: int) -&gt; int</span><span class="se">\n</span><span class="s1">Add two numbers.&#39;</span><span class="p">,</span> <span class="n">func_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">},</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]})),</span> <span class="n">FunctionTool</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">divide</span> <span class="n">at</span> <span class="mh">0x104970220</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">async</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="n">definition</span><span class="p">:</span> <span class="n">FunctionDefinition</span><span class="p">(</span><span class="n">func_name</span><span class="o">=</span><span class="s1">&#39;divide&#39;</span><span class="p">,</span> <span class="n">func_desc</span><span class="o">=</span><span class="s1">&#39;divide(a: float, b: float) -&gt; float</span><span class="se">\n</span><span class="s1">Divide two numbers.&#39;</span><span class="p">,</span> <span class="n">func_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">},</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]})),</span> <span class="n">FunctionTool</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">search</span> <span class="n">at</span> <span class="mh">0x104970400</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">async</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="n">definition</span><span class="p">:</span> <span class="n">FunctionDefinition</span><span class="p">(</span><span class="n">func_name</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="n">func_desc</span><span class="o">=</span><span class="s1">&#39;search(query: str) -&gt; List[str]</span><span class="se">\n</span><span class="s1">Search for query and return a list of results.&#39;</span><span class="p">,</span> <span class="n">func_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span><span class="p">}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]})),</span> <span class="n">FunctionTool</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">numpy_sum</span> <span class="n">at</span> <span class="mh">0x1062a2840</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">async</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="n">definition</span><span class="p">:</span> <span class="n">FunctionDefinition</span><span class="p">(</span><span class="n">func_name</span><span class="o">=</span><span class="s1">&#39;numpy_sum&#39;</span><span class="p">,</span> <span class="n">func_desc</span><span class="o">=</span><span class="s1">&#39;numpy_sum(arr: numpy.ndarray) -&gt; float</span><span class="se">\n</span><span class="s1">Sum the elements of an array.&#39;</span><span class="p">,</span> <span class="n">func_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;arr&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;arr&#39;</span><span class="p">]})),</span> <span class="n">FunctionTool</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">add_points</span> <span class="n">at</span> <span class="mh">0x106d691c0</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">async</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="n">definition</span><span class="p">:</span> <span class="n">FunctionDefinition</span><span class="p">(</span><span class="n">func_name</span><span class="o">=</span><span class="s1">&#39;add_points&#39;</span><span class="p">,</span> <span class="n">func_desc</span><span class="o">=</span><span class="s1">&#39;add_points(p1: __main__.Point, p2: __main__.Point) -&gt; __main__.Point</span><span class="se">\n</span><span class="s1">None&#39;</span><span class="p">,</span> <span class="n">func_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;p1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">},</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]},</span> <span class="s1">&#39;p2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">},</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]}},</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;p1&#39;</span><span class="p">,</span> <span class="s1">&#39;p2&#39;</span><span class="p">]}))],</span> <span class="n">Additional</span> <span class="n">Context</span><span class="p">:</span> <span class="p">{})</span>
</pre></div>
</div>
<p>We will show more how it can be used in the next section.</p>
</section>
<section id="function-call-end-to-end">
<h3>3. Function Call end-to-end<a class="headerlink" href="#function-call-end-to-end" title="Link to this heading">¶</a></h3>
<p>Now, let us add prompt and start to do function calls via LLMs.
We use the following prompt to do a single function call.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;&lt;START_OF_SYS_PROMPT&gt;You have these tools available:</span>
<span class="s2">{</span><span class="si">% i</span><span class="s2">f tools %}</span>
<span class="s2">&lt;TOOLS&gt;</span>
<span class="s2">{</span><span class="si">% f</span><span class="s2">or tool in tools %}</span>
<span class="s2">{{ loop.index }}.</span>
<span class="s2">{{tool}}</span>
<span class="s2">------------------------</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="s2">&lt;/TOOLS&gt;</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndif %}</span>
<span class="s2">&lt;OUTPUT_FORMAT&gt;</span>
<span class="s2">{{output_format_str}}</span>
<span class="s2">&lt;/OUTPUT_FORMAT&gt;</span>
<span class="s2">&lt;END_OF_SYS_PROMPT&gt;</span>
<span class="s2">&lt;START_OF_USER&gt;: {{input_str}}&lt;END_OF_USER&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p><strong>Pass tools in the prompt</strong></p>
<p>We use <cite>yaml</cite> format here and show an example with less tools.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.core.prompt_builder</span> <span class="kn">import</span> <span class="n">Prompt</span>

<span class="n">prompt</span> <span class="o">=</span> <span class="n">Prompt</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="n">template</span><span class="p">)</span>
<span class="n">small_tool_manager</span> <span class="o">=</span> <span class="n">ToolManager</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>

<span class="n">renered_prompt</span> <span class="o">=</span> <span class="n">prompt</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">small_tool_manager</span><span class="o">.</span><span class="n">yaml_definitions</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">renered_prompt</span><span class="p">)</span>
</pre></div>
</div>
<p>The output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">START_OF_SYS_PROMPT</span><span class="o">&gt;</span><span class="n">You</span> <span class="n">have</span> <span class="n">these</span> <span class="n">tools</span> <span class="n">available</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">TOOLS</span><span class="o">&gt;</span>
<span class="mf">1.</span>
<span class="n">func_name</span><span class="p">:</span> <span class="n">multiply</span>
<span class="n">func_desc</span><span class="p">:</span> <span class="s1">&#39;multiply(a: int, b: int) -&gt; int</span>

<span class="n">Belongs</span> <span class="n">to</span> <span class="n">class</span><span class="p">:</span> <span class="n">multiply</span>

<span class="n">Docstring</span><span class="p">:</span> <span class="n">Multiply</span> <span class="n">two</span> <span class="n">numbers</span><span class="o">.</span>

<span class="s1">&#39;</span>
<span class="n">func_parameters</span><span class="p">:</span>
<span class="nb">type</span><span class="p">:</span> <span class="nb">object</span>
<span class="n">properties</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">b</span><span class="p">:</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">required</span><span class="p">:</span>
<span class="o">-</span> <span class="n">a</span>
<span class="o">-</span> <span class="n">b</span>
<span class="o">------------------------</span>
<span class="mf">2.</span>
<span class="n">func_name</span><span class="p">:</span> <span class="n">add</span>
<span class="n">func_desc</span><span class="p">:</span> <span class="s1">&#39;add(a: int, b: int) -&gt; int</span>

<span class="n">Belongs</span> <span class="n">to</span> <span class="n">class</span><span class="p">:</span> <span class="n">add</span>

<span class="n">Docstring</span><span class="p">:</span> <span class="n">Add</span> <span class="n">two</span> <span class="n">numbers</span><span class="o">.</span>

<span class="s1">&#39;</span>
<span class="n">func_parameters</span><span class="p">:</span>
<span class="nb">type</span><span class="p">:</span> <span class="nb">object</span>
<span class="n">properties</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">b</span><span class="p">:</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">required</span><span class="p">:</span>
<span class="o">-</span> <span class="n">a</span>
<span class="o">-</span> <span class="n">b</span>
<span class="o">------------------------</span>
<span class="o">&lt;/</span><span class="n">TOOLS</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">OUTPUT_FORMAT</span><span class="o">&gt;</span>
<span class="kc">None</span>
<span class="o">&lt;/</span><span class="n">OUTPUT_FORMAT</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">END_OF_SYS_PROMPT</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">START_OF_USER</span><span class="o">&gt;</span><span class="p">:</span> <span class="kc">None</span><span class="o">&lt;</span><span class="n">END_OF_USER</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><strong>Pass the output format</strong></p>
<p>We have two ways to instruct LLM to call the function:</p>
<ol class="arabic simple">
<li><p>Using the function name and arguments, we will leverage <code class="docutils literal notranslate"><span class="pre">Function</span></code> as LLM’s output data type.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.core.types</span> <span class="kn">import</span> <span class="n">Function</span>

<span class="n">output_data_class</span> <span class="o">=</span> <span class="n">Function</span>
<span class="n">output_format_str</span> <span class="o">=</span> <span class="n">output_data_class</span><span class="o">.</span><span class="n">to_json_signature</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;thought&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">])</span>

<span class="n">renered_prompt</span><span class="o">=</span> <span class="n">prompt</span><span class="p">(</span><span class="n">output_format_str</span><span class="o">=</span><span class="n">output_format_str</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">renered_prompt</span><span class="p">)</span>
</pre></div>
</div>
<p>We execluded both the <code class="docutils literal notranslate"><span class="pre">thought</span></code> and <code class="docutils literal notranslate"><span class="pre">args</span></code> as it is easier to use <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> to represent the arguments.
The output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">START_OF_SYS_PROMPT</span><span class="o">&gt;</span><span class="n">You</span> <span class="n">have</span> <span class="n">these</span> <span class="n">tools</span> <span class="n">available</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">OUTPUT_FORMAT</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;The name of the function (str) (optional)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;kwargs&quot;</span><span class="p">:</span> <span class="s2">&quot;The keyword arguments of the function (Optional[Dict[str, object]]) (optional)&quot;</span>
<span class="p">}</span>
<span class="o">&lt;/</span><span class="n">OUTPUT_FORMAT</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">END_OF_SYS_PROMPT</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">START_OF_USER</span><span class="o">&gt;</span><span class="p">:</span> <span class="kc">None</span><span class="o">&lt;</span><span class="n">END_OF_USER</span><span class="o">&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Using the function call expression for which we will use <code class="docutils literal notranslate"><span class="pre">FunctionExpression</span></code>.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.core.types</span> <span class="kn">import</span> <span class="n">FunctionExpression</span>

<span class="n">output_data_class</span> <span class="o">=</span> <span class="n">FunctionExpression</span>
<span class="n">output_format_str</span> <span class="o">=</span> <span class="n">output_data_class</span><span class="o">.</span><span class="n">to_json_signature</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;thought&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="p">(</span><span class="n">output_format_str</span><span class="o">=</span><span class="n">output_format_str</span><span class="p">))</span>
</pre></div>
</div>
<p>The output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">START_OF_SYS_PROMPT</span><span class="o">&gt;</span><span class="n">You</span> <span class="n">have</span> <span class="n">these</span> <span class="n">tools</span> <span class="n">available</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">OUTPUT_FORMAT</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;FuncName(&lt;kwargs&gt;) Valid function call expression. Example: </span><span class="se">\&quot;</span><span class="s2">FuncName(a=1, b=2)</span><span class="se">\&quot;</span><span class="s2"> Follow the data type specified in the function parameters.e.g. for Type object with x,y properties, use </span><span class="se">\&quot;</span><span class="s2">ObjectType(x=1, y=2) (str) (required)&quot;</span>
<span class="p">}</span>
<span class="o">&lt;/</span><span class="n">OUTPUT_FORMAT</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">END_OF_SYS_PROMPT</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">START_OF_USER</span><span class="o">&gt;</span><span class="p">:</span> <span class="kc">None</span><span class="o">&lt;</span><span class="n">END_OF_USER</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>We will use <a class="reference internal" href="../apis/components/components.output_parsers.outputs.html#components.output_parsers.outputs.JsonOutputParser" title="components.output_parsers.outputs.JsonOutputParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">components.output_parsers.outputs.JsonOutputParser</span></code></a> to streamline the formatting of our output data type.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.components.output_parsers</span> <span class="kn">import</span> <span class="n">JsonOutputParser</span>

<span class="n">func_parser</span> <span class="o">=</span> <span class="n">JsonOutputParser</span><span class="p">(</span><span class="n">data_class</span><span class="o">=</span><span class="n">Function</span><span class="p">,</span> <span class="n">exclude_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;thought&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">])</span>
<span class="n">instructions</span> <span class="o">=</span> <span class="n">func_parser</span><span class="o">.</span><span class="n">format_instructions</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>
</pre></div>
</div>
<p>The output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Your output should be formatted as a standard JSON instance with the following schema:
```
{
    &quot;name&quot;: &quot;The name of the function (str) (optional)&quot;,
    &quot;kwargs&quot;: &quot;The keyword arguments of the function (Optional) (optional)&quot;
}
```
-Make sure to always enclose the JSON output in triple backticks (```). Please do not add anything other than valid JSON output!
-Use double quotes for the keys and string values.
-Follow the JSON formatting conventions.
</pre></div>
</div>
<section id="function-output-format">
<h4>Function Output Format<a class="headerlink" href="#function-output-format" title="Link to this heading">¶</a></h4>
<p>Now, let’s prepare our generator with the above prompt, <code class="docutils literal notranslate"><span class="pre">Function</span></code> data class, and <code class="docutils literal notranslate"><span class="pre">JsonOutputParser</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.core.generator</span> <span class="kn">import</span> <span class="n">Generator</span>
<span class="kn">from</span> <span class="nn">adalflow.core.types</span> <span class="kn">import</span> <span class="n">ModelClientType</span>

<span class="n">model_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">}</span>
<span class="n">prompt_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;tools&quot;</span><span class="p">:</span> <span class="n">tool_manager</span><span class="o">.</span><span class="n">yaml_definitions</span><span class="p">,</span>
    <span class="s2">&quot;output_format_str&quot;</span><span class="p">:</span> <span class="n">func_parser</span><span class="o">.</span><span class="n">format_instructions</span><span class="p">(),</span>
<span class="p">}</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span>
    <span class="n">model_client</span><span class="o">=</span><span class="n">ModelClientType</span><span class="o">.</span><span class="n">OPENAI</span><span class="p">(),</span>
    <span class="n">model_kwargs</span><span class="o">=</span><span class="n">model_kwargs</span><span class="p">,</span>
    <span class="n">template</span><span class="o">=</span><span class="n">template</span><span class="p">,</span>
    <span class="n">prompt_kwargs</span><span class="o">=</span><span class="n">prompt_kwargs</span><span class="p">,</span>
    <span class="n">output_processors</span><span class="o">=</span><span class="n">func_parser</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Run Queries</strong></p>
<p>We will use <code class="docutils literal notranslate"><span class="pre">Function.from_dict</span></code> to get the final output type from the json object. Here we use <a class="reference internal" href="../apis/core/core.tool_manager.html#core.tool_manager.ToolManager.execute_func" title="core.tool_manager.ToolManager.execute_func"><code class="xref py py-meth docutils literal notranslate"><span class="pre">core.tool_manager.ToolManager.execute_func()</span></code></a> to execute it directly.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">queries</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;add 2 and 3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;search for something&quot;</span><span class="p">,</span>
    <span class="s2">&quot;add points (1, 2) and (3, 4)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sum numpy array with arr = np.array([[1, 2], [3, 4]])&quot;</span><span class="p">,</span>
    <span class="s2">&quot;multiply 2 with local variable x&quot;</span><span class="p">,</span>
    <span class="s2">&quot;divide 2 by 3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Add 5 to variable y&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">query</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">queries</span><span class="p">):</span>
    <span class="n">prompt_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;input_str&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">}</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2"> Query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">generator</span><span class="p">(</span><span class="n">prompt_kwargs</span><span class="o">=</span><span class="n">prompt_kwargs</span><span class="p">)</span>
        <span class="c1"># print(f&quot;LLM raw output: {result.raw_response}&quot;)</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">Function</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Function: </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">func_output</span> <span class="o">=</span> <span class="n">tool_manager</span><span class="o">.</span><span class="n">execute_func</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Function output: </span><span class="si">{</span><span class="n">func_output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to execute the function for query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">, func: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s2">, error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>From the output shown below, we get valide <code class="docutils literal notranslate"><span class="pre">Function</span></code> parsed as output for all queries.
However, we see it failed three function execution:
(1)function <cite>add_points</cite> due to its argument type is a data class, and <cite>multiply</cite> and the last <cite>add</cite> due to it is difficult to represent the local variable <cite>x</cite> and <cite>y</cite> in the function call.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="n">Query</span><span class="p">:</span> <span class="n">add</span> <span class="mi">2</span> <span class="ow">and</span> <span class="mi">3</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function</span><span class="p">:</span> <span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="mi">1</span> <span class="n">Query</span><span class="p">:</span> <span class="n">search</span> <span class="k">for</span> <span class="n">something</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function</span><span class="p">:</span> <span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="s1">&#39;something&#39;</span><span class="p">})</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="s1">&#39;something&#39;</span><span class="p">}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;result1something&#39;</span><span class="p">,</span> <span class="s1">&#39;result2something&#39;</span><span class="p">],</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="mi">2</span> <span class="n">Query</span><span class="p">:</span> <span class="n">add</span> <span class="n">points</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function</span><span class="p">:</span> <span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;add_points&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;p1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="s1">&#39;p2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}})</span>
<span class="n">Error</span> <span class="n">at</span> <span class="n">calling</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">add_points</span> <span class="n">at</span> <span class="mh">0x117b98360</span><span class="o">&gt;</span><span class="p">:</span> <span class="s1">&#39;dict&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;x&#39;</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;add_points&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;add_points&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;p1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="s1">&#39;p2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s2">&quot;&#39;dict&#39; object has no attribute &#39;x&#39;&quot;</span><span class="p">)</span>

<span class="mi">3</span> <span class="n">Query</span><span class="p">:</span> <span class="nb">sum</span> <span class="n">numpy</span> <span class="n">array</span> <span class="k">with</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function</span><span class="p">:</span> <span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;numpy_sum&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;arr&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]})</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;numpy_sum&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;numpy_sum&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;arr&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="mi">4</span> <span class="n">Query</span><span class="p">:</span> <span class="n">multiply</span> <span class="mi">2</span> <span class="k">with</span> <span class="n">local</span> <span class="n">variable</span> <span class="n">x</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function</span><span class="p">:</span> <span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;multiply&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">})</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;multiply&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;multiply&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;xx&#39;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="mi">5</span> <span class="n">Query</span><span class="p">:</span> <span class="n">divide</span> <span class="mi">2</span> <span class="n">by</span> <span class="mi">3</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function</span><span class="p">:</span> <span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;divide&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">})</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;divide&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;divide&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="mf">0.6666666666666666</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="mi">6</span> <span class="n">Query</span><span class="p">:</span> <span class="n">Add</span> <span class="mi">5</span> <span class="n">to</span> <span class="n">variable</span> <span class="n">y</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function</span><span class="p">:</span> <span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;y&#39;</span><span class="p">})</span>
<span class="n">Error</span> <span class="n">at</span> <span class="n">calling</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">add</span> <span class="n">at</span> <span class="mh">0x11742eca0</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">unsupported</span> <span class="n">operand</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="o">+</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span> <span class="ow">and</span> <span class="s1">&#39;str&#39;</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;y&#39;</span><span class="p">}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s2">&quot;unsupported operand type(s) for +: &#39;int&#39; and &#39;str&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If users prefer to use Function, to incress the success rate, make sure your function arguments are dict based for class object. You can always convert it to a class from a dict.</p>
</div>
</section>
<section id="functionexpression-output-format">
<h4>FunctionExpression Output Format<a class="headerlink" href="#functionexpression-output-format" title="Link to this heading">¶</a></h4>
<p>We will adapt the above code easily using tool manager to use <code class="docutils literal notranslate"><span class="pre">FunctionExpression</span></code> as the output format.
We will use FunctionExpression this time in the parser. And we added the necessary context to handle the local variable <cite>x</cite>, <cite>y</cite>, and <cite>np.array</cite>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tool_manager</span> <span class="o">=</span> <span class="n">ToolManager</span><span class="p">(</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">functions</span><span class="p">,</span>
    <span class="n">additional_context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;np.array&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="s2">&quot;np&quot;</span><span class="p">:</span> <span class="n">np</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">func_parser</span> <span class="o">=</span> <span class="n">JsonOutputParser</span><span class="p">(</span><span class="n">data_class</span><span class="o">=</span><span class="n">FunctionExpression</span><span class="p">)</span>
</pre></div>
</div>
<p>Additionally, we can also pass the <code class="docutils literal notranslate"><span class="pre">additional_context</span></code> to LLM using the following prompt after the &lt;TOOLS&gt;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">context</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;&lt;CONTEXT&gt;</span>
<span class="s2">Your function expression also have access to these context:</span>
<span class="s2">{{context_str}}</span>
<span class="s2">&lt;/CONTEXT&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>This time, let us try to execute all function concurrently and treating them all as async functions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">run_async_function_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">tool_manager</span><span class="p">):</span>
    <span class="n">answers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">query</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">queries</span><span class="p">):</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_query</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">tool_manager</span><span class="p">))</span>

    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
    <span class="n">answers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total time taken: </span><span class="si">{</span><span class="n">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="w"> </span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">answers</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">process_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">tool_manager</span><span class="p">:</span> <span class="n">ToolManager</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2"> Query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">generator</span><span class="p">(</span><span class="n">prompt_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;input_str&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span>
        <span class="n">func_expr</span> <span class="o">=</span> <span class="n">FunctionExpression</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Function_expr: </span><span class="si">{</span><span class="n">func_expr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">tool_manager</span><span class="o">.</span><span class="n">parse_func_expr</span><span class="p">(</span><span class="n">func_expr</span><span class="p">)</span>
        <span class="n">func_output</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tool_manager</span><span class="o">.</span><span class="n">execute_func_async</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Function output: </span><span class="si">{</span><span class="n">func_output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func_output</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to execute the function for query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">, func: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s2">, error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
<p>In this case, we used <a class="reference internal" href="../apis/core/core.tool_manager.html#core.tool_manager.ToolManager.parse_func_expr" title="core.tool_manager.ToolManager.parse_func_expr"><code class="xref py py-meth docutils literal notranslate"><span class="pre">core.tool_manager.ToolManager.parse_func_expr()</span></code></a> and <a class="reference internal" href="../apis/core/core.tool_manager.html#core.tool_manager.ToolManager.execute_func" title="core.tool_manager.ToolManager.execute_func"><code class="xref py py-meth docutils literal notranslate"><span class="pre">core.tool_manager.ToolManager.execute_func()</span></code></a> to execute the function.
Or we can directly use <a class="reference internal" href="../apis/core/core.tool_manager.html#core.tool_manager.ToolManager.execute_func_expr" title="core.tool_manager.ToolManager.execute_func_expr"><code class="xref py py-meth docutils literal notranslate"><span class="pre">core.tool_manager.ToolManager.execute_func_expr()</span></code></a> to execute the function expression. Both are equivalent.</p>
<p>From the output shown below, this time we get all function calls executed successfully.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="n">Query</span><span class="p">:</span> <span class="n">add</span> <span class="mi">2</span> <span class="ow">and</span> <span class="mi">3</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function_expr</span><span class="p">:</span> <span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;add(a=2, b=3)&#39;</span><span class="p">)</span>

<span class="mi">1</span> <span class="n">Query</span><span class="p">:</span> <span class="n">search</span> <span class="k">for</span> <span class="n">something</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function_expr</span><span class="p">:</span> <span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;search(query=&quot;something&quot;)&#39;</span><span class="p">)</span>

<span class="mi">2</span> <span class="n">Query</span><span class="p">:</span> <span class="n">add</span> <span class="n">points</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function_expr</span><span class="p">:</span> <span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;add_points(p1=Point(x=1, y=2), p2=Point(x=3, y=4))&#39;</span><span class="p">)</span>

<span class="mi">3</span> <span class="n">Query</span><span class="p">:</span> <span class="nb">sum</span> <span class="n">numpy</span> <span class="n">array</span> <span class="k">with</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function_expr</span><span class="p">:</span> <span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;numpy_sum(arr=np.array([[1, 2], [3, 4]]))&#39;</span><span class="p">)</span>

<span class="mi">4</span> <span class="n">Query</span><span class="p">:</span> <span class="n">multiply</span> <span class="mi">2</span> <span class="k">with</span> <span class="n">local</span> <span class="n">variable</span> <span class="n">x</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function_expr</span><span class="p">:</span> <span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;multiply(a=2, b=2)&#39;</span><span class="p">)</span>

<span class="mi">5</span> <span class="n">Query</span><span class="p">:</span> <span class="n">divide</span> <span class="mi">2</span> <span class="n">by</span> <span class="mi">3</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function_expr</span><span class="p">:</span> <span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;divide(a=2.0, b=3.0)&#39;</span><span class="p">)</span>

<span class="mi">6</span> <span class="n">Query</span><span class="p">:</span> <span class="n">Add</span> <span class="mi">5</span> <span class="n">to</span> <span class="n">variable</span> <span class="n">y</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function_expr</span><span class="p">:</span> <span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;add(a=0, b=5)&#39;</span><span class="p">)</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;add_points&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;add_points&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;p1&#39;</span><span class="p">:</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p2&#39;</span><span class="p">:</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">4</span><span class="p">)}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;numpy_sum&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;numpy_sum&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;arr&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;multiply&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;multiply&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="s1">&#39;something&#39;</span><span class="p">}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;result1something&#39;</span><span class="p">,</span> <span class="s1">&#39;result2something&#39;</span><span class="p">],</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;divide&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;divide&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="mf">0.6666666666666666</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="parallel-function-calls">
<h2>Parallel Function Calls<a class="headerlink" href="#parallel-function-calls" title="Link to this heading">¶</a></h2>
<p>We will slightly adapt the output format instruction to get it output json array, which can still be parsed with a json parser.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">multple_function_call_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;&lt;SYS&gt;You have these tools available:</span>
<span class="s2">{</span><span class="si">% i</span><span class="s2">f tools %}</span>
<span class="s2">&lt;TOOLS&gt;</span>
<span class="s2">{</span><span class="si">% f</span><span class="s2">or tool in tools %}</span>
<span class="s2">{{ loop.index }}.</span>
<span class="s2">{{tool}}</span>
<span class="s2">------------------------</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="s2">&lt;/TOOLS&gt;</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndif %}</span>
<span class="s2">&lt;OUTPUT_FORMAT&gt;</span>
<span class="s2">Here is how you call one function.</span>
<span class="s2">{{output_format_str}}</span>
<span class="s2">-Always return a List using `[]` of the above JSON objects, even if its just one item.</span>
<span class="s2">&lt;/OUTPUT_FORMAT&gt;</span>
<span class="s2">&lt;SYS&gt;</span>
<span class="s2">{{input_str}}</span>
<span class="s2">You:</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>As LLM has problem calling <code class="docutils literal notranslate"><span class="pre">add_point</span></code>, we will add one example and we will generate it with <a class="reference internal" href="../apis/core/core.types.html#core.types.FunctionExpression.from_function" title="core.types.FunctionExpression.from_function"><code class="xref py py-meth docutils literal notranslate"><span class="pre">core.types.FunctionExpression.from_function()</span></code></a>.
We will update our outputparser to use the example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">example</span> <span class="o">=</span> <span class="n">FunctionExpression</span><span class="o">.</span><span class="n">from_function</span><span class="p">(</span>
        <span class="n">func</span><span class="o">=</span><span class="n">add_points</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">p2</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">func_parser</span> <span class="o">=</span> <span class="n">JsonOutputParser</span><span class="p">(</span>
        <span class="n">data_class</span><span class="o">=</span><span class="n">FunctionExpression</span><span class="p">,</span> <span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="n">example</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Here is the updated output format in the prompt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;OUTPUT_FORMAT&gt;
Here is how you call one function.
Your output should be formatted as a standard JSON instance with the following schema:
```
{
    &quot;action&quot;: &quot;FuncName(&lt;kwargs&gt;)                 Valid function call expression.                 Example: \&quot;FuncName(a=1, b=2)\&quot;                 Follow the data type specified in the function parameters.                e.g. for Type object with x,y properties, use \&quot;ObjectType(x=1, y=2) (str) (required)&quot;
}
```
Here is an example:
```
{
    &quot;action&quot;: &quot;add_points(p1=Point(x=1, y=2), p2=Point(x=3, y=4))&quot;
}
```
-Make sure to always enclose the JSON output in triple backticks (```). Please do not add anything other than valid JSON output!
-Use double quotes for the keys and string values.
-Follow the JSON formatting conventions.
Awlays return a List using `[]` of the above JSON objects. You can have length of 1 or more.
Do not call multiple functions in one action field.
&lt;/OUTPUT_FORMAT&gt;
</pre></div>
</div>
<p>This case, we will show the response from using <cite>execute_func_expr_via_sandbox</cite> to execute the function expression.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">queries</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot; and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">queries</span><span class="p">[</span><span class="n">idx</span> <span class="p">:</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">prompt_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;input_str&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">}</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2"> Query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">generator</span><span class="p">(</span><span class="n">prompt_kwargs</span><span class="o">=</span><span class="n">prompt_kwargs</span><span class="p">)</span>
        <span class="c1"># print(f&quot;LLM raw output: {result.raw_response}&quot;)</span>
        <span class="n">func_expr</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionExpression</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">FunctionExpression</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span>
        <span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Function_expr: </span><span class="si">{</span><span class="n">func_expr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">func_expr</span><span class="p">:</span>
            <span class="n">func_output</span> <span class="o">=</span> <span class="n">tool_manager</span><span class="o">.</span><span class="n">execute_func_expr_via_sandbox</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Function output: </span><span class="si">{</span><span class="n">func_output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to execute the function for query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">, func: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s2">, error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>By using an example to help with calling <code class="docutils literal notranslate"><span class="pre">add_point</span></code>, we can now successfully execute all function calls.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="n">Query</span><span class="p">:</span> <span class="n">add</span> <span class="mi">2</span> <span class="ow">and</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">search</span> <span class="k">for</span> <span class="n">something</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function_expr</span><span class="p">:</span> <span class="p">[</span><span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;add(a=2, b=3)&#39;</span><span class="p">),</span> <span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;search(query=&quot;something&quot;)&#39;</span><span class="p">)]</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;add(a=2, b=3)&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;add(a=2, b=3)&#39;</span><span class="p">),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;search(query=&quot;something&quot;)&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;search(query=&quot;something&quot;)&#39;</span><span class="p">),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="s1">&#39;something&#39;</span><span class="p">}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;result1something&#39;</span><span class="p">,</span> <span class="s1">&#39;result2something&#39;</span><span class="p">],</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="mi">2</span> <span class="n">Query</span><span class="p">:</span> <span class="n">add</span> <span class="n">points</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">sum</span> <span class="n">numpy</span> <span class="n">array</span> <span class="k">with</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function_expr</span><span class="p">:</span> <span class="p">[</span><span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;add_points(p1=Point(x=1, y=2), p2=Point(x=3, y=4))&#39;</span><span class="p">),</span> <span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;numpy_sum(arr=[[1, 2], [3, 4]])&#39;</span><span class="p">)]</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;add_points(p1=Point(x=1, y=2), p2=Point(x=3, y=4))&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;add_points(p1=Point(x=1, y=2), p2=Point(x=3, y=4))&#39;</span><span class="p">),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;add_points&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;add_points&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;p1&#39;</span><span class="p">:</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p2&#39;</span><span class="p">:</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">4</span><span class="p">)}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;numpy_sum(arr=[[1, 2], [3, 4]])&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;numpy_sum(arr=[[1, 2], [3, 4]])&#39;</span><span class="p">),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;numpy_sum&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;numpy_sum&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;arr&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="mi">4</span> <span class="n">Query</span><span class="p">:</span> <span class="n">multiply</span> <span class="mi">2</span> <span class="k">with</span> <span class="n">local</span> <span class="n">variable</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">divide</span> <span class="mi">2</span> <span class="n">by</span> <span class="mi">3</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function_expr</span><span class="p">:</span> <span class="p">[</span><span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;multiply(a=2, b=x)&#39;</span><span class="p">),</span> <span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;divide(a=2.0, b=3.0)&#39;</span><span class="p">)]</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;multiply(a=2, b=x)&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;multiply(a=2, b=x)&#39;</span><span class="p">),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;multiply&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;multiply&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;divide(a=2.0, b=3.0)&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;divide(a=2.0, b=3.0)&#39;</span><span class="p">),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;divide&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;divide&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="mf">0.6666666666666666</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="mi">6</span> <span class="n">Query</span><span class="p">:</span> <span class="n">Add</span> <span class="mi">5</span> <span class="n">to</span> <span class="n">variable</span> <span class="n">y</span>
<span class="o">--------------------------------------------------</span>
<span class="n">Function_expr</span><span class="p">:</span> <span class="p">[</span><span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;add(a=y, b=5)&#39;</span><span class="p">)]</span>
<span class="n">Function</span> <span class="n">output</span><span class="p">:</span> <span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;add(a=y, b=5)&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">FunctionExpression</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;add(a=y, b=5)&#39;</span><span class="p">),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">FunctionOutput</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}),</span> <span class="n">parsed_input</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="mcp-model-context-protocol-tools">
<h2>MCP (Model Context Protocol) Tools<a class="headerlink" href="#mcp-model-context-protocol-tools" title="Link to this heading">¶</a></h2>
<p>In addition to the above, AdalFlow also supports MCP tools <a class="footnote-reference brackets" href="#id5" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>, which enable interaction with LLM models and their environments through the MCP protocol.
Compared to the general function call defined above, MCP provides a unified interface between different tool providers and model vendors.
Importantly, you don’t need to rewrite every tools. Instead, you can directly re-use the tools from the marketplace like <a class="reference external" href="https://smithery.ai/">smithery.ai</a>.</p>
<p><strong>Configuring an MCP Client</strong>. To configure a standard input/output (stdio) MCP client with your own server. An example of python server implementation is at <cite>tutorials/mcp_agent/mcp_calculator_server.py</cite>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mcp</span> <span class="kn">import</span> <span class="n">MCPServerStdioParams</span>
<span class="n">server_params</span> <span class="o">=</span> <span class="n">MCPServerStdioParams</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mcp_calculator_server.py&quot;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>To configure a HTTP MCP client, you can use MCP server URLs from <a class="reference external" href="https://server.smithery.ai">https://server.smithery.ai</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">smithery_api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SMITHERY_API_KEY&quot;</span><span class="p">)</span>
<span class="n">smithery_server_id</span> <span class="o">=</span> <span class="s2">&quot;@nickclyde/duckduckgo-mcp-server&quot;</span>
<span class="n">server_params</span> <span class="o">=</span> <span class="n">MCPServerStreamableHttpParams</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://server.smithery.ai/</span><span class="si">{</span><span class="n">smithery_server_id</span><span class="si">}</span><span class="s2">/mcp?api_key=</span><span class="si">{</span><span class="n">smithery_api_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Executing MCP Tools</strong>. You can execute an MCP tool as an asynchronous function. The <cite>MCPFunctionTool</cite> can be used in the same way as a general <cite>FunctionTool</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">adalflow.core.mcp_tool</span> <span class="kn">import</span> <span class="n">MCPFunctionTool</span>
<span class="c1"># Get tools from the server</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">mcp_session_context</span><span class="p">(</span><span class="n">server_params</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">list_tools</span><span class="p">()</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">call_async_function</span><span class="p">():</span>
    <span class="n">tool</span> <span class="o">=</span> <span class="n">MCPFunctionTool</span><span class="p">(</span><span class="n">server_params</span><span class="p">,</span> <span class="n">tools</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">output</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tool</span><span class="o">.</span><span class="n">acall</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">call_async_function</span><span class="p">())</span>
</pre></div>
</div>
<p><strong>Using MCP Tools from Marketplace</strong>. You can reuse the tools from marketplace. Below is a step-by-step example.</p>
<ol class="arabic simple">
<li><p>Find a tool at smithery.ai. For example, <a class="reference external" href="https://smithery.ai/server/&#64;nickclyde/duckduckgo-mcp-server">https://smithery.ai/server/&#64;nickclyde/duckduckgo-mcp-server</a>.</p></li>
<li><p>Load the server. A MCP server provides multiple tools. With <cite>MCPToolManager</cite>, you can easily load them as <cite>MCPFunctionTool</cite> instances all at once. First, create a client manager:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.core.mcp_tool</span> <span class="kn">import</span> <span class="n">MCPToolManager</span>
<span class="n">mcp_client_manager</span> <span class="o">=</span> <span class="n">MCPToolManager</span><span class="p">(</span><span class="n">server_params</span><span class="p">)</span>
</pre></div>
</div>
<p>You can add servers to the manager in several ways. For example, we use the DuckDuckGo parameters (<a class="reference external" href="https://smithery.ai/server/&#64;nickclyde/duckduckgo-mcp-server">&#64;nickclyde/duckduckgo-mcp-server</a>), choose one of the following options:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ======= Example 1: Add via stdio command. =======</span>
<span class="n">manager</span><span class="o">.</span><span class="n">add_server</span><span class="p">(</span><span class="s2">&quot;duckduckgo-mcp-server&quot;</span><span class="p">,</span> <span class="n">MCPServerStdioParams</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="s2">&quot;npx&quot;</span><span class="p">,</span>  <span class="c1"># Command to run the server</span>
    <span class="n">args</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;-y&quot;</span><span class="p">,</span>
        <span class="s2">&quot;@smithery/cli@latest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;run&quot;</span><span class="p">,</span>
        <span class="s2">&quot;@nickclyde/duckduckgo-mcp-server&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--key&quot;</span><span class="p">,</span>
        <span class="s2">&quot;smithery-api-key&quot;</span>
    <span class="p">],</span>
<span class="p">))</span>

<span class="c1"># ======= Example 2: Load servers from a JSON file. =======</span>
<span class="n">json_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;mcp_servers.json&quot;</span><span class="p">)</span>
<span class="n">manager</span><span class="o">.</span><span class="n">add_servers_from_json_file</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span>

<span class="c1"># ======= Example 3: Load server from HTTP client. =======</span>
<span class="n">smithery_api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SMITHERY_API_KEY&quot;</span><span class="p">)</span>
<span class="n">smithery_server_id</span> <span class="o">=</span> <span class="s2">&quot;@nickclyde/duckduckgo-mcp-server&quot;</span>
<span class="n">mcp_server_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://server.smithery.ai/</span><span class="si">{</span><span class="n">smithery_server_id</span><span class="si">}</span><span class="s2">/mcp?api_key=</span><span class="si">{</span><span class="n">smithery_api_key</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">manager</span><span class="o">.</span><span class="n">add_server</span><span class="p">(</span><span class="s2">&quot;duckduckgo-mcp-server&quot;</span><span class="p">,</span> <span class="n">MCPServerStreamableHttpParams</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">mcp_server_url</span><span class="p">))</span>

<span class="c1"># ======= Example 4: Load server from SSE client. =======</span>
<span class="n">manager</span><span class="o">.</span><span class="n">add_server</span><span class="p">(</span><span class="s2">&quot;example-mcp&quot;</span><span class="p">,</span> <span class="n">MCPServerSseParams</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://example-server.modelcontextprotocol.io/sse&quot;</span><span class="p">,</span>
<span class="p">))</span>
</pre></div>
</div>
<p>An example <cite>mcp_servers.json</cite> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;duckduckgo-mcp-server&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;npx&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">&quot;-y&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;@smithery/cli@latest&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;run&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;@nickclyde/duckduckgo-mcp-server&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;--key&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;smithery-api-key&quot;</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>3. Use the manager to create <cite>MCPFunctionTool</cite> instances.
You can list all tools available on the server and use it with agent. A complete example of using MCP tools with agents can be found under the <cite>tutorials/mcp_agent</cite> folder.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">mcp_client_manager</span><span class="o">.</span><span class="n">get_all_tools</span><span class="p">()</span>  <span class="c1"># List[MCPFunctionTool]</span>
<span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">:</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">definition</span><span class="o">.</span><span class="n">func_desc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- Tool: </span><span class="si">{</span><span class="n">tool</span><span class="o">.</span><span class="n">definition</span><span class="o">.</span><span class="n">func_name</span><span class="si">}</span><span class="s2">, Signature: </span><span class="si">{</span><span class="n">sig</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example outputs when we list the tools from DuckDuckGo</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Listing</span> <span class="n">tools</span> <span class="k">for</span> <span class="n">server</span><span class="p">:</span> <span class="n">duckduckgo</span><span class="o">-</span><span class="n">mcp</span><span class="o">-</span><span class="n">server</span>
<span class="mi">2025</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">22</span> <span class="o">-</span> <span class="p">[</span><span class="n">mcp_tool</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="n">mcp_session_context</span><span class="p">]</span> <span class="o">-</span> <span class="err">📡</span> <span class="n">Initializing</span> <span class="n">connection</span><span class="o">...</span>
<span class="mi">2025</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">23</span> <span class="o">-</span> <span class="p">[</span><span class="n">mcp_tool</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="n">mcp_session_context</span><span class="p">]</span> <span class="o">-</span> <span class="err">✅</span> <span class="n">Connection</span> <span class="n">established</span><span class="err">!</span>

<span class="err">🗂️</span>  <span class="n">Available</span> <span class="n">Resources</span><span class="p">:</span>

<span class="err">🔧</span> <span class="n">Available</span> <span class="n">Tools</span><span class="p">:</span>
<span class="err">•</span> <span class="n">search</span><span class="p">:</span>
    <span class="n">Search</span> <span class="n">DuckDuckGo</span> <span class="ow">and</span> <span class="k">return</span> <span class="n">formatted</span> <span class="n">results</span><span class="o">.</span>

    <span class="n">Args</span><span class="p">:</span>
        <span class="n">query</span><span class="p">:</span> <span class="n">The</span> <span class="n">search</span> <span class="n">query</span> <span class="n">string</span>
        <span class="n">max_results</span><span class="p">:</span> <span class="n">Maximum</span> <span class="n">number</span> <span class="n">of</span> <span class="n">results</span> <span class="n">to</span> <span class="k">return</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">ctx</span><span class="p">:</span> <span class="n">MCP</span> <span class="n">context</span> <span class="k">for</span> <span class="n">logging</span>

<span class="err">•</span> <span class="n">fetch_content</span><span class="p">:</span>
    <span class="n">Fetch</span> <span class="ow">and</span> <span class="n">parse</span> <span class="n">content</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">webpage</span> <span class="n">URL</span><span class="o">.</span>

    <span class="n">Args</span><span class="p">:</span>
        <span class="n">url</span><span class="p">:</span> <span class="n">The</span> <span class="n">webpage</span> <span class="n">URL</span> <span class="n">to</span> <span class="n">fetch</span> <span class="n">content</span> <span class="kn">from</span>
        <span class="nn">ctx</span><span class="p">:</span> <span class="n">MCP</span> <span class="n">context</span> <span class="k">for</span> <span class="n">logging</span>
</pre></div>
</div>
<p>4. Use or optimize prompts or agents with the function as if you are using the FunctionTool.
With the tool, we can create an agent and ask it to search for news.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">agent</span> <span class="o">=</span> <span class="n">ReActAgent</span><span class="p">(</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">)</span>
<span class="n">agent</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;Use DuckDuckGo to search for the winner on European Championship in 2025.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The example output of a step execution is shown below.</p>
<p>Example: Using multiple MCP servers with MCPToolManager and one agent</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SMITHERY_API_KEY&quot;</span><span class="p">)</span>
<span class="n">manager</span> <span class="o">=</span> <span class="n">MCPToolManager</span><span class="p">()</span>
<span class="n">manager</span><span class="o">.</span><span class="n">add_server</span><span class="p">(</span><span class="s2">&quot;duckduckgo&quot;</span><span class="p">,</span> <span class="n">MCPServerStreamableHttpParams</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://server.smithery.ai/@nickclyde/duckduckgo-mcp-server/mcp?api_key=</span><span class="si">{</span><span class="n">api_key</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">))</span>
<span class="n">manager</span><span class="o">.</span><span class="n">add_server</span><span class="p">(</span><span class="s2">&quot;wikipedia&quot;</span><span class="p">,</span> <span class="n">MCPServerStreamableHttpParams</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://server.smithery.ai/@smithery/wikipedia-mcp-server/mcp?api_key=</span><span class="si">{</span><span class="n">api_key</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">))</span>

<span class="n">tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_all_tools</span><span class="p">()</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">ReActAgent</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">acall</span><span class="p">(</span><span class="s2">&quot;Search for the capital of France and summarize its Wikipedia page.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Example: Adding tool to multiple agents.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">agent2</span> <span class="o">=</span> <span class="n">ReActAgent</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">)</span>
<span class="n">result2</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent2</span><span class="o">.</span><span class="n">acall</span><span class="p">(</span><span class="s2">&quot;Search for the capital of Germany and summarize its Wikipedia page.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Agent 2 result:&quot;</span><span class="p">,</span> <span class="n">result2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mi">2025</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">03</span> <span class="mi">17</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">43</span> <span class="o">-</span> <span class="p">[</span><span class="n">react</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">468</span><span class="p">:</span><span class="n">_execute_action_eval_mode</span><span class="p">]</span> <span class="o">-</span> <span class="n">Step</span> <span class="mi">1</span><span class="p">:</span>
<span class="n">StepOutput</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="n">thought</span><span class="o">=</span><span class="s1">&#39;The search results indicate that the UEFA European Championship (Euros) was last held in 2024, with Spain winning. There are no results for a winner of the UEFA European Championship in 2025, which suggests it has not occurred yet. Therefore, I will conclude that there is no winner for the European Championship in 2025.&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;finish&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;answer&#39;</span><span class="p">:</span> <span class="s1">&#39;The UEFA European Championship in 2025 has not occurred yet, so there is no winner.&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}),</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">observation</span><span class="o">=</span><span class="s1">&#39;The UEFA European Championship in 2025 has not occurred yet, so there is no winner.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight admonition">
<p class="admonition-title">References</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id4" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>OpenAI tools API: <a class="reference external" href="https://beta.openai.com/docs/api-reference/tools">https://beta.openai.com/docs/api-reference/tools</a></p>
</aside>
<aside class="footnote brackets" id="id5" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id2">1</a>,<a role="doc-backlink" href="#id3">2</a>)</span>
<p>Anthropic MCP document: <a class="reference external" href="https://modelcontextprotocol.io/introduction">https://modelcontextprotocol.io/introduction</a></p>
</aside>
</aside>
</div>
<div class="highlight admonition">
<p class="admonition-title">API References</p>
<ul class="simple">
<li><p><a class="reference internal" href="../apis/core/core.types.html#core.types.FunctionDefinition" title="core.types.FunctionDefinition"><code class="xref py py-class docutils literal notranslate"><span class="pre">core.types.FunctionDefinition</span></code></a></p></li>
<li><p><a class="reference internal" href="../apis/core/core.types.html#core.types.Function" title="core.types.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">core.types.Function</span></code></a></p></li>
<li><p><a class="reference internal" href="../apis/core/core.types.html#core.types.FunctionExpression" title="core.types.FunctionExpression"><code class="xref py py-class docutils literal notranslate"><span class="pre">core.types.FunctionExpression</span></code></a></p></li>
<li><p><a class="reference internal" href="../apis/core/core.types.html#core.types.FunctionOutput" title="core.types.FunctionOutput"><code class="xref py py-class docutils literal notranslate"><span class="pre">core.types.FunctionOutput</span></code></a></p></li>
<li><p><a class="reference internal" href="../apis/core/core.func_tool.html#core.func_tool.FunctionTool" title="core.func_tool.FunctionTool"><code class="xref py py-class docutils literal notranslate"><span class="pre">core.func_tool.FunctionTool</span></code></a></p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">core.mcp_tool.MCPFunctionTool()</span></code></p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">core.mcp_tool.MCPToolManager()</span></code></p></li>
<li><p><a class="reference internal" href="../apis/core/core.tool_manager.html#core.tool_manager.ToolManager" title="core.tool_manager.ToolManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">core.tool_manager.ToolManager</span></code></a></p></li>
<li><p><a class="reference internal" href="../apis/core/core.functional.html#core.functional.get_fun_schema" title="core.functional.get_fun_schema"><code class="xref py py-func docutils literal notranslate"><span class="pre">core.functional.get_fun_schema()</span></code></a></p></li>
<li><p><a class="reference internal" href="../apis/core/core.functional.html#core.functional.parse_function_call_expr" title="core.functional.parse_function_call_expr"><code class="xref py py-func docutils literal notranslate"><span class="pre">core.functional.parse_function_call_expr()</span></code></a></p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">core.functional.sandbox_execute()</span></code></p></li>
<li><p><a class="reference internal" href="../apis/core/core.functional.html#core.functional.generate_function_call_expression_from_callable" title="core.functional.generate_function_call_expression_from_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">core.functional.generate_function_call_expression_from_callable()</span></code></a></p></li>
</ul>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="agent.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Agent</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="rag_with_memory.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">RAG with Memory</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, SylphAI, Inc
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Function calls</a><ul>
<li><a class="reference internal" href="#quick-walkthrough">Quick Walkthrough</a></li>
<li><a class="reference internal" href="#scope-and-design">Scope and Design</a></li>
<li><a class="reference internal" href="#function-call-in-action">Function Call in Action</a><ul>
<li><a class="reference internal" href="#functiontool">1. FunctionTool</a></li>
<li><a class="reference internal" href="#toolmanager">2. ToolManager</a></li>
<li><a class="reference internal" href="#function-call-end-to-end">3. Function Call end-to-end</a><ul>
<li><a class="reference internal" href="#function-output-format">Function Output Format</a></li>
<li><a class="reference internal" href="#functionexpression-output-format">FunctionExpression Output Format</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#parallel-function-calls">Parallel Function Calls</a></li>
<li><a class="reference internal" href="#mcp-model-context-protocol-tools">MCP (Model Context Protocol) Tools</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/js/rtd_search_config.js"></script>
    <script src="../_static/js/rtd_sphinx_search.min.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>