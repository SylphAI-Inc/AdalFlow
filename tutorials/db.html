<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="RAG Playbook" href="rag_playbook.html" /><link rel="prev" title="Text Splitter" href="text_splitter.html" />

    <link rel="shortcut icon" href="../_static/LightRAG-logo-circle.png"/><!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>Data (Database/Pipeline) - Build and Optimize LM Workflows</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=f0068426" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/rtd_sphinx_search.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #FF6F00;
  --color-brand-content: #1E2A38;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #FF8F00;
  --color-brand-content: #CFD8DC;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #FF8F00;
  --color-brand-content: #CFD8DC;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Build and Optimize LM Workflows</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/images/AdalFlow.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/images/AdalFlow_black_bg.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Build and Optimize LM Workflows</span>
  
</a><div class="sidebar-github-section">
    <a href="https://github.com/SylphAI-Inc/AdalFlow" class="sidebar-github-link">
        <i class="fa-brands fa-github"></i>
        <span class="github-text">GitHub</span>
    </a>
</div><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../new_tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/core_concepts.html">Core Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/prompt.html">Prompt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/parser.html">Parser and Structured Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/generator.html">Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/embedder.html">Embedder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new_tutorials/tool.html">Tool Use</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../integrations/index.html">Integrations</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Integrations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../integrations/integrations.html">All Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integrations/anthropic.html">Anthropic Integration</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../use_cases/index.html">Use Cases</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Use Cases</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/question_answering.html">Question Answering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/qa_computation_graph.html">Q&amp;A Computation Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/qa_text_grad_trace_graph.html">Q&amp;A Text Grad Trace Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/qa_demo_trace_graph.html">Q&amp;A Few Shot Demo Trace Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/classification.html">Classification Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/rag_opt.html">RAG optimization</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../contributor/index.html">Contributor Guide</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Contributor Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../contributor/contribution.html">Contributing Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributor/contribute_to_code.html">Development Essentials</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Developer Notes</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Developer Notes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="lightrag_design_philosophy.html">Design Philosophy</a></li>
<li class="toctree-l2"><a class="reference internal" href="class_hierarchy.html">Class Hierarchy</a></li>
<li class="toctree-l2"><a class="reference internal" href="trace_graph.html">AdalFlow Trace Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="component.html">Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="base_data_class.html">DataClass</a></li>
<li class="toctree-l2"><a class="reference internal" href="prompt.html">Prompt</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_client.html">ModelClient</a></li>
<li class="toctree-l2"><a class="reference internal" href="generator.html">Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="generator.html#basic-generator-tutorial">Basic Generator Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="output_parsers.html">Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="embedder.html">Embedder</a></li>
<li class="toctree-l2"><a class="reference internal" href="retriever.html">Retriever</a></li>
<li class="toctree-l2"><a class="reference internal" href="text_splitter.html">Text Splitter</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Data (Database/Pipeline)</a></li>
<li class="toctree-l2"><a class="reference internal" href="rag_playbook.html">RAG Playbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="rag_with_memory.html">RAG with Memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="tool_helper.html">Function calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="agent.html">Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="evaluation.html">LLM Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="datasets.html">Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logger Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html#design">Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html#use-logger-in-projects">Use Logger in Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging_tracing.html">Tracing</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../design/index.html">Blog</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Blog</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../design/ComponentTool.html">Use Class method as a better function tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/FunctionTool.html">Designing of AdalFlow FunctionTool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/agent-streaming.html">Agent Streaming Architecture in OpenAI Agents SDK</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../apis/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/core/index.html">Core</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Core</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.base_data_class.html">base_data_class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.component.html">component</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.container.html">container</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.default_prompt_template.html">default_prompt_template</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.embedder.html">embedder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.generator.html">generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.model_client.html">model_client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.prompt_builder.html">prompt_builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.retriever.html">retriever</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.string_parser.html">string_parser</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.func_tool.html">func_tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.tool_manager.html">tool_manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.types.html">types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.db.html">db</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.functional.html">functional</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/core/core.tokenizer.html">tokenizer</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/components/index.html">Components</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Components</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.model_client.html">model_client</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of model_client</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.anthropic_client.html">anthropic_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.azureai_client.html">azureai_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.bedrock_client.html">bedrock_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.cohere_client.html">cohere_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.deepseek_client.html">deepseek_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.fireworks_client.html">fireworks_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.google_client.html">google_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.groq_client.html">groq_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.mistral_client.html">mistral_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.ollama_client.html">ollama_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.openai_client.html">openai_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.sambanova_client.html">sambanova_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.together_client.html">together_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.transformers_client.html">transformers_client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.utils.html">utils</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.model_client.xai_client.html">xai_client</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.retriever.html">retriever</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of retriever</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.bm25_retriever.html">bm25_retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.faiss_retriever.html">faiss_retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.lancedb_retriver.html">lancedb_retriver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.llm_retriever.html">llm_retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.postgres_retriever.html">postgres_retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.qdrant_retriever.html">qdrant_retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.retriever.reranker_retriever.html">reranker_retriever</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.output_parsers.html">output_parsers</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of output_parsers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.output_parsers.dataclass_parser.html">dataclass_parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.output_parsers.outputs.html">outputs</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.agent.html">agent</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of agent</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.agent.react.html">react</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.data_process.html">data_process</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of data_process</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.data_process.data_components.html">data_components</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.data_process.text_splitter.html">text_splitter</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/components/components.memory.html">memory</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of memory</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/components/components.memory.memory.html">memory</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/datasets/index.html">Datasets</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Datasets</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/datasets/datasets.big_bench_hard.html">big_bench_hard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/datasets/datasets.trec.html">trec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/datasets/datasets.hotpot_qa.html">hotpot_qa</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/datasets/datasets.types.html">types</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/eval/index.html">Evaluation</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of Evaluation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/eval/eval.base.html">base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/eval/eval.answer_match_acc.html">answer_match_acc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/eval/eval.retriever_recall.html">retriever_recall</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/eval/eval.llm_as_judge.html">llm_as_judge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/eval/eval.g_eval.html">g_eval</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/optim/index.html">Optimization</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Optimization</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/optim/optim.parameter.html">parameter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/optim/optim.optimizer.html">optimizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/optim/optim.grad_component.html">grad_component</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/optim/optim.loss_component.html">loss_component</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/optim/optim.types.html">types</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/optim/optim.few_shot.html">few_shot</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of few_shot</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.few_shot.bootstrap_optimizer.html">bootstrap_optimizer</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/optim/optim.text_grad.html">text_grad</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of text_grad</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.text_grad.backend_engine_prompt.html">backend_engine_prompt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.text_grad.llm_text_loss.html">llm_text_loss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.text_grad.ops.html">ops</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.text_grad.text_loss_with_eval_fn.html">text_loss_with_eval_fn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.text_grad.tgd_optimizer.html">tgd_optimizer</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../apis/optim/optim.trainer.html">trainer</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of trainer</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.trainer.adal.html">adal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apis/optim/optim.trainer.trainer.html">trainer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/tracing/index.html">Tracing</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of Tracing</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/tracing/tracing.decorators.html">decorators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/tracing/tracing.generator_state_logger.html">generator_state_logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/tracing/tracing.generator_call_logger.html">generator_call_logger</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apis/utils/index.html">Utils</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of Utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.data.html">data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.setup_env.html">setup_env</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.logger.html">logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.file_io.html">file_io</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.config.html">config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.lazy_import.html">lazy_import</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.registry.html">registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.serialization.html">serialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../apis/utils/utils.cache.html">cache</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="data-database-pipeline">
<h1>Data (Database/Pipeline)<a class="headerlink" href="#data-database-pipeline" title="Link to this heading">¶</a></h1>
<p>The purpose of this note is to provide an overview on data, data modeling, and data storage in LLM applications along with how AdalFlow works with data.
We will conver:</p>
<ul class="simple">
<li><p>Data models on how to represent important data.</p></li>
<li><p>Data pipeline to process data in LLM applications.</p></li>
<li><p>Local database providing in-memory data management and storage.</p></li>
<li><p>Examples on working with Cloud database using <cite>fsspec</cite> and <cite>SQLAlchemy</cite>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This note focus more on dealing with data needed to perform the LLM task.
Datasets, including the input and ground truth output loading and dataset will be covered in the optimizing section.</p>
</div>
<p>So far, we have seen how our core components like <code class="docutils literal notranslate"><span class="pre">Generator</span></code>, <code class="docutils literal notranslate"><span class="pre">Embedder</span></code>, and <code class="docutils literal notranslate"><span class="pre">Retriever</span></code> work without any data cache/database and enforced data format to read data from and to write data to.
However, in real-world LLM applications, we can not avoid dealing with data storage.</p>
<ol class="arabic simple">
<li><p>Our documents to retrieve context from can be large and be stored in a file system or in a database in forms of tables or graphs.</p></li>
<li><p>We often need to pre-process a large amount of data (like text splitting and embedding and idf in BM25) in a datapipline into a cloud database.</p></li>
<li><p>We need to write records, logs to files or databases for monitoring and debugging, such as the failed llm calls.</p></li>
<li><p>When it comes to applications where states matter, like games and chatbots, we need to store the states and conversational history.</p></li>
</ol>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../_images/database.png"><img alt="Data model and database" src="../_images/database.png" style="width: 620px;" />
</a>
<figcaption>
<p><span class="caption-text">Data model and database</span><a class="headerlink" href="#id2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<section id="data-models">
<h2>Data Models<a class="headerlink" href="#data-models" title="Link to this heading">¶</a></h2>
<p>Besides of having a unified <cite>GeneratorOutput</cite>, <cite>EmbedderOutput</cite>, and <cite>RetrieverOutput</cite> data format,
we provide mainly <a class="reference internal" href="../apis/core/core.types.html#core.types.Document" title="core.types.Document"><code class="xref py py-class docutils literal notranslate"><span class="pre">core.types.Document</span></code></a> and <a class="reference internal" href="../apis/core/core.types.html#core.types.DialogTurn" title="core.types.DialogTurn"><code class="xref py py-class docutils literal notranslate"><span class="pre">core.types.DialogTurn</span></code></a> to help with text document and conversational histor processing and data storage.</p>
<p>We will explain the design of Document and DialogTurn. In this note, we will continue use these simple documents we used in the previous notes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">org_documents</span> <span class="o">=</span><span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;The Impact of Renewable Energy on the Economy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Renewable energy technologies not only help in reducing greenhouse gas emissions but also contribute significantly to the economy by creating jobs in the manufacturing and installation sectors. The growth in renewable energy usage boosts local economies through increased investment in technology and infrastructure.&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Understanding Solar Panels&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Solar panels convert sunlight into electricity by allowing photons, or light particles, to knock electrons free from atoms, generating a flow of electricity. Solar panels are a type of renewable energy technology that has been found to have a significant positive effect on the environment by reducing the reliance on fossil fuels.&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Pros and Cons of Solar Energy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;While solar energy offers substantial environmental benefits, such as reducing carbon footprints and pollution, it also has downsides. The production of solar panels can lead to hazardous waste, and large solar farms require significant land, which can disrupt local ecosystems.&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span>  <span class="s2">&quot;Renewable Energy and Its Effects&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Renewable energy sources like wind, solar, and hydro power play a crucial role in combating climate change. They do not produce greenhouse gases during operation, making them essential for sustainable development. However, the initial setup and material sourcing for these technologies can still have environmental impacts.&quot;</span>
    <span class="p">}</span>
<span class="p">]</span>

<span class="n">turns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;What are the benefits of renewable energy?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;system&quot;</span><span class="p">:</span> <span class="s2">&quot;I can see you are interested in renewable energy. Renewable energy technologies not only help in reducing greenhouse gas emissions but also contribute significantly to the economy by creating jobs in the manufacturing and installation sectors. The growth in renewable energy usage boosts local economies through increased investment in technology and infrastructure.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;user_time&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-09-01T12:00:00Z&quot;</span><span class="p">,</span>
        <span class="s2">&quot;system_time&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-09-01T12:00:01Z&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;How do solar panels impact the environment?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;system&quot;</span><span class="p">:</span> <span class="s2">&quot;Solar panels convert sunlight into electricity by allowing photons, or light particles, to knock electrons free from atoms, generating a flow of electricity. Solar panels are a type of renewable energy technology that has been found to have a significant positive effect on the environment by reducing the reliance on fossil fuels.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;user_time&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-09-01T12:00:02Z&quot;</span><span class="p">,</span>
        <span class="s2">&quot;system_time&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-09-01T12:00:03Z&quot;</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<section id="document">
<h3>Document<a class="headerlink" href="#document" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="../apis/core/core.types.html#core.types.Document" title="core.types.Document"><code class="xref py py-class docutils literal notranslate"><span class="pre">core.types.Document</span></code></a> is used as Document data structure and to assist text processing in LLM applications.</p>
<ol class="arabic simple">
<li><p>A general document/text container with fields <code class="docutils literal notranslate"><span class="pre">text</span></code>, <code class="docutils literal notranslate"><span class="pre">meta_data</span></code>, and <code class="docutils literal notranslate"><span class="pre">id</span></code>.</p></li>
<li><p>Assist text splitting with fields <code class="docutils literal notranslate"><span class="pre">parent_doc_id</span></code> and <code class="docutils literal notranslate"><span class="pre">order</span></code>.</p></li>
<li><p>Assist embedding with fields <code class="docutils literal notranslate"><span class="pre">vector</span></code>.</p></li>
<li><p>Assist using it as a prompt for LLM with fields <code class="docutils literal notranslate"><span class="pre">estimated_num_tokens</span></code>.</p></li>
</ol>
<p>This is why data processing components like <code class="docutils literal notranslate"><span class="pre">TextSplitter</span></code> and <code class="docutils literal notranslate"><span class="pre">ToEmbeddings</span></code>  requires <code class="docutils literal notranslate"><span class="pre">Document</span></code> as input of each data item.</p>
<p><strong>Create a Document</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.core.types</span> <span class="kn">import</span> <span class="n">Document</span>

<span class="n">documents</span>  <span class="o">=</span> <span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">],</span> <span class="n">meta_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]})</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">org_documents</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
</pre></div>
</div>
<p>The printout will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">73</span><span class="n">c12be3</span><span class="o">-</span><span class="mi">7844</span><span class="o">-</span><span class="mi">435</span><span class="n">b</span><span class="o">-</span><span class="mi">8678</span><span class="o">-</span><span class="mf">2e8</span><span class="n">e63041698</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Renewable energy technologies not only help in reducing greenhouse gas emissions but also contribute...&#39;</span><span class="p">,</span> <span class="n">meta_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;The Impact of Renewable Energy on the Economy&#39;</span><span class="p">},</span> <span class="n">vector</span><span class="o">=</span><span class="p">[],</span> <span class="n">parent_doc_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">Document</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">7</span><span class="n">a17ed45</span><span class="o">-</span><span class="mi">569</span><span class="n">a</span><span class="o">-</span><span class="mi">4206</span><span class="o">-</span><span class="mi">9670</span><span class="o">-</span><span class="mi">5316</span><span class="n">efd58d58</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Solar panels convert sunlight into electricity by allowing photons, or light particles, to knock ele...&#39;</span><span class="p">,</span> <span class="n">meta_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Understanding Solar Panels&#39;</span><span class="p">},</span> <span class="n">vector</span><span class="o">=</span><span class="p">[],</span> <span class="n">parent_doc_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">Document</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">bcbc6ff9</span><span class="o">-</span><span class="mi">518</span><span class="n">a</span><span class="o">-</span><span class="mi">405</span><span class="n">a</span><span class="o">-</span><span class="mi">8</span><span class="n">b0d</span><span class="o">-</span><span class="mi">840021</span><span class="n">aa1953</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;While solar energy offers substantial environmental benefits, such as reducing carbon footprints and...&#39;</span><span class="p">,</span> <span class="n">meta_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Pros and Cons of Solar Energy&#39;</span><span class="p">},</span> <span class="n">vector</span><span class="o">=</span><span class="p">[],</span> <span class="n">parent_doc_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">Document</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">ec910402</span><span class="o">-</span><span class="n">f98f</span><span class="o">-</span><span class="mi">4077</span><span class="o">-</span><span class="n">a958</span><span class="o">-</span><span class="mf">7335e34</span><span class="n">ee0c6</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Renewable energy sources like wind, solar, and hydro power play a crucial role in combating climate ...&#39;</span><span class="p">,</span> <span class="n">meta_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Renewable Energy and Its Effects&#39;</span><span class="p">},</span> <span class="n">vector</span><span class="o">=</span><span class="p">[],</span> <span class="n">parent_doc_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
</pre></div>
</div>
</section>
<section id="dialogturn">
<h3>DialogTurn<a class="headerlink" href="#dialogturn" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="../apis/core/core.types.html#core.types.DialogTurn" title="core.types.DialogTurn"><code class="xref py py-class docutils literal notranslate"><span class="pre">core.types.DialogTurn</span></code></a> is only used as a data structure to a user-assistant conversation turn in LLM applications.
<strong>If we need to apply a text processing pipeline to a conversational history, we will use our text container``Document`` to store the text we need to use.</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For both <code class="docutils literal notranslate"><span class="pre">Document</span></code> and <code class="docutils literal notranslate"><span class="pre">DialogTurn</span></code>, we have an equivalent class in <span class="xref std std-doc">database.sqlalchemy.model`(:class:`database.sqlalchemy.modoel.Document</span>) to handle the persitence of data in a SQL database.</p>
</div>
<p>Here is how to get a list of <code class="docutils literal notranslate"><span class="pre">DialogTurn</span></code> from the <code class="docutils literal notranslate"><span class="pre">turns</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.core.types</span> <span class="kn">import</span> <span class="n">DialogTurn</span><span class="p">,</span> <span class="n">UserQuery</span><span class="p">,</span> <span class="n">AssistantResponse</span>

<span class="n">dialog_turns</span> <span class="o">=</span> <span class="p">[</span>
<span class="n">DialogTurn</span><span class="p">(</span>
        <span class="n">user_query</span><span class="o">=</span><span class="n">UserQuery</span><span class="p">(</span><span class="n">query_str</span><span class="o">=</span><span class="n">turn</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]),</span>
        <span class="n">assistant_response</span><span class="o">=</span><span class="n">AssistantResponse</span><span class="p">(</span><span class="n">response_str</span><span class="o">=</span><span class="n">turn</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">]),</span>
        <span class="n">user_query_timestamp</span><span class="o">=</span><span class="n">turn</span><span class="p">[</span><span class="s2">&quot;user_time&quot;</span><span class="p">],</span>
        <span class="n">assistant_response_timestamp</span><span class="o">=</span><span class="n">turn</span><span class="p">[</span><span class="s2">&quot;system_time&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">turn</span> <span class="ow">in</span> <span class="n">turns</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dialog_turns</span><span class="p">)</span>
</pre></div>
</div>
<p>The printout will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">DialogTurn</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;f2eddc77-4667-43f5-87e0-fd11f12958b3&#39;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_query</span><span class="o">=</span><span class="n">UserQuery</span><span class="p">(</span><span class="n">query_str</span><span class="o">=</span><span class="s1">&#39;What are the benefits of renewable energy?&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">assistant_response</span><span class="o">=</span><span class="n">AssistantResponse</span><span class="p">(</span><span class="n">response_str</span><span class="o">=</span><span class="s1">&#39;I can see you are interested in renewable energy. Renewable energy technologies not only help in reducing greenhouse gas emissions but also contribute significantly to the economy by creating jobs in the manufacturing and installation sectors. The growth in renewable energy usage boosts local economies through increased investment in technology and infrastructure.&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">user_query_timestamp</span><span class="o">=</span><span class="s1">&#39;2021-09-01T12:00:00Z&#39;</span><span class="p">,</span> <span class="n">assistant_response_timestamp</span><span class="o">=</span><span class="s1">&#39;2021-09-01T12:00:01Z&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vector</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">DialogTurn</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;b2dbdf2f-f513-493d-aaa8-c77c98ac260f&#39;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_query</span><span class="o">=</span><span class="n">UserQuery</span><span class="p">(</span><span class="n">query_str</span><span class="o">=</span><span class="s1">&#39;How do solar panels impact the environment?&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">assistant_response</span><span class="o">=</span><span class="n">AssistantResponse</span><span class="p">(</span><span class="n">response_str</span><span class="o">=</span><span class="s1">&#39;Solar panels convert sunlight into electricity by allowing photons, or light particles, to knock electrons free from atoms, generating a flow of electricity. Solar panels are a type of renewable energy technology that has been found to have a significant positive effect on the environment by reducing the reliance on fossil fuels.&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">user_query_timestamp</span><span class="o">=</span><span class="s1">&#39;2021-09-01T12:00:02Z&#39;</span><span class="p">,</span> <span class="n">assistant_response_timestamp</span><span class="o">=</span><span class="s1">&#39;2021-09-01T12:00:03Z&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vector</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
</pre></div>
</div>
</section>
</section>
<section id="data-pipeline">
<h2>Data Pipeline<a class="headerlink" href="#data-pipeline" title="Link to this heading">¶</a></h2>
<p>Let’s see how to can write a data pipeline that can process any form of text data by using intermediate data model-<code class="docutils literal notranslate"><span class="pre">Document</span></code>.
Currently, we have two data processing components: <code class="docutils literal notranslate"><span class="pre">TextSplitter</span></code> and <code class="docutils literal notranslate"><span class="pre">ToEmbeddings</span></code> in the <code class="docutils literal notranslate"><span class="pre">components.data_process</span></code> module.</p>
<p>We will use <code class="docutils literal notranslate"><span class="pre">ord_documents</span></code> and a list of <code class="docutils literal notranslate"><span class="pre">DialogTurn</span></code> as examples. As our data pipelines are designed to work with <code class="docutils literal notranslate"><span class="pre">Document</span></code> structure,
we simplify just need to add a mapping function to convert the original data to <code class="docutils literal notranslate"><span class="pre">Document</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mapping function for org_documents</span>
<span class="k">def</span> <span class="nf">map_to_document</span><span class="p">(</span><span class="n">doc</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">],</span> <span class="n">meta_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]})</span>

<span class="k">def</span> <span class="nf">map_dialogturn_to_document</span><span class="p">(</span><span class="n">turn</span><span class="p">:</span> <span class="n">DialogTurn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
    <span class="c1"># it can be important to keep the original data&#39;s id</span>
    <span class="k">return</span> <span class="n">Document</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">turn</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">turn</span><span class="o">.</span><span class="n">user_query</span><span class="o">.</span><span class="n">query_str</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">turn</span><span class="o">.</span><span class="n">assistant_response</span><span class="o">.</span><span class="n">response_str</span><span class="p">)</span>
</pre></div>
</div>
<p>You can refer to <a class="reference internal" href="text_splitter.html"><span class="doc">Text Splitter</span></a> for more details on how to use <code class="docutils literal notranslate"><span class="pre">TextSplitter</span></code>.
<code class="docutils literal notranslate"><span class="pre">ToEmbeddings</span></code> is an orchestrator on <code class="docutils literal notranslate"><span class="pre">BatchEmbedder</span></code> and it will generate embeddings for a list of <code class="docutils literal notranslate"><span class="pre">Document</span></code> and store the embeddings as <code class="docutils literal notranslate"><span class="pre">List[Float]</span></code> in the <code class="docutils literal notranslate"><span class="pre">vector</span></code> field of each <code class="docutils literal notranslate"><span class="pre">Document</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">Sequential</span></code> can be easily used to chain multiple data processing components together.
Here is the code to form a data pipeline:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.core.embedder</span> <span class="kn">import</span> <span class="n">Embedder</span>
<span class="kn">from</span> <span class="nn">adalflow.core.types</span> <span class="kn">import</span> <span class="n">ModelClientType</span>
<span class="kn">from</span> <span class="nn">adalflow.components.data_process</span> <span class="kn">import</span> <span class="n">TextSplitter</span><span class="p">,</span> <span class="n">ToEmbeddings</span>
<span class="kn">from</span> <span class="nn">adalflow.core.component</span> <span class="kn">import</span> <span class="n">Sequential</span>


<span class="n">model_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;text-embedding-3-small&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
    <span class="s2">&quot;encoding_format&quot;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">splitter_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;split_by&quot;</span><span class="p">:</span> <span class="s2">&quot;word&quot;</span><span class="p">,</span>
    <span class="s2">&quot;split_length&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="s2">&quot;split_overlap&quot;</span><span class="p">:</span> <span class="mi">10</span>
<span class="p">}</span>

<span class="n">splitter</span> <span class="o">=</span> <span class="n">TextSplitter</span><span class="p">(</span><span class="o">**</span><span class="n">splitter_config</span><span class="p">)</span>
<span class="n">embedder</span> <span class="o">=</span> <span class="n">Embedder</span><span class="p">(</span><span class="n">model_client</span> <span class="o">=</span><span class="n">ModelClientType</span><span class="o">.</span><span class="n">OPENAI</span><span class="p">(),</span> <span class="n">model_kwargs</span><span class="o">=</span><span class="n">model_kwargs</span><span class="p">)</span>
<span class="n">embedder_transformer</span> <span class="o">=</span> <span class="n">ToEmbeddings</span><span class="p">(</span><span class="n">embedder</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">data_transformer</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">(</span><span class="n">splitter</span><span class="p">,</span> <span class="n">embedder_transformer</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_transformer</span><span class="p">)</span>
</pre></div>
</div>
<p>The printout will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Sequential</span><span class="p">(</span>
<span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">TextSplitter</span><span class="p">(</span><span class="n">split_by</span><span class="o">=</span><span class="n">word</span><span class="p">,</span> <span class="n">split_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">split_overlap</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">ToEmbeddings</span><span class="p">(</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">(</span><span class="n">embedder</span><span class="p">):</span> <span class="n">Embedder</span><span class="p">(</span>
    <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;text-embedding-3-small&#39;</span><span class="p">,</span> <span class="s1">&#39;dimensions&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span> <span class="s1">&#39;encoding_format&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">},</span>
    <span class="p">(</span><span class="n">model_client</span><span class="p">):</span> <span class="n">OpenAIClient</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="n">batch_embedder</span><span class="p">):</span> <span class="n">BatchEmbedder</span><span class="p">(</span>
    <span class="p">(</span><span class="n">embedder</span><span class="p">):</span> <span class="n">Embedder</span><span class="p">(</span>
        <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;text-embedding-3-small&#39;</span><span class="p">,</span> <span class="s1">&#39;dimensions&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span> <span class="s1">&#39;encoding_format&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">},</span>
        <span class="p">(</span><span class="n">model_client</span><span class="p">):</span> <span class="n">OpenAIClient</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now, apply the data pipeline to the <code class="docutils literal notranslate"><span class="pre">dialog_turns</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dialog_turns_as_documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">map_dialogturn_to_document</span><span class="p">(</span><span class="n">turn</span><span class="p">)</span> <span class="k">for</span> <span class="n">turn</span> <span class="ow">in</span> <span class="n">dialog_turns</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dialog_turns_as_documents</span><span class="p">)</span>

<span class="c1"># apply data transformation to the documents</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">data_transformer</span><span class="p">(</span><span class="n">dialog_turns_as_documents</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>The printout will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[Document(id=e3b48bcc-df68-43a4-aa81-93922b619293, text=&#39;What are the benefits of renewable energy? I can see you are interested in renewable energy. Renewab...&#39;, meta_data=None, vector=[], parent_doc_id=None, order=None, score=None), Document(id=21f0385d-d19a-442f-ae99-910e984cdb65, text=&#39;How do solar panels impact the environment? Solar panels convert sunlight into electricity by allowi...&#39;, meta_data=None, vector=[], parent_doc_id=None, order=None, score=None)]
Splitting documents: 100%|██████████| 2/2 [00:00&lt;00:00, 609.37it/s]
Batch embedding documents: 100%|██████████| 2/2 [00:00&lt;00:00,  3.79it/s]
Adding embeddings to documents from batch: 2it [00:00, 10205.12it/s]
[Document(id=e636facc-8bc3-483b-afbd-37e1d8ff0526, text=&#39;What are the benefits of renewable energy? I can see you are interested in renewable energy. Renewab...&#39;, meta_data=None, vector=&#39;len: 256&#39;, parent_doc_id=e3b48bcc-df68-43a4-aa81-93922b619293, order=0, score=None), Document(id=06ea7cea-c4e4-4f5f-b3e9-2e6f4452827b, text=&#39;and installation sectors. The growth in renewable energy usage boosts local economies through increa...&#39;, meta_data=None, vector=&#39;len: 256&#39;, parent_doc_id=e3b48bcc-df68-43a4-aa81-93922b619293, order=1, score=None), Document(id=0018af12-c8fc-49ff-ab64-a2acf8ba4c27, text=&#39;How do solar panels impact the environment? Solar panels convert sunlight into electricity by allowi...&#39;, meta_data=None, vector=&#39;len: 256&#39;, parent_doc_id=21f0385d-d19a-442f-ae99-910e984cdb65, order=0, score=None), Document(id=c5431397-2a78-4870-abce-353b738c1b71, text=&#39;has been found to have a significant positive effect on the environment by reducing the reliance on ...&#39;, meta_data=None, vector=&#39;len: 256&#39;, parent_doc_id=21f0385d-d19a-442f-ae99-910e984cdb65, order=1, score=None)]
</pre></div>
</div>
</section>
<section id="local-database">
<h2>Local database<a class="headerlink" href="#local-database" title="Link to this heading">¶</a></h2>
<p><strong>LocalDB class</strong></p>
<p><a class="reference internal" href="../apis/core/core.db.html#core.db.LocalDB" title="core.db.LocalDB"><code class="xref py py-class docutils literal notranslate"><span class="pre">core.db.LocalDB</span></code></a> is a powerful data management class:</p>
<ol class="arabic simple">
<li><p>It manages a sequence of data items of any data type with CRUD operations.</p></li>
<li><p>Keep track and apply data transfomation/processing pipelines to its items.</p></li>
<li><p>Save and load the state of the items to/from a file, including all data and data transformer records.</p></li>
</ol>
<p>This table lists its attributes and important methods:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Attribute/Method</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Attributes</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">name</span></code></p></td>
<td><p>The name of the database.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">items</span></code></p></td>
<td><p>A list of items in the database.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">transformed_items</span></code></p></td>
<td><p>A dictionary to store the transformed items.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">transformer_setups</span></code></p></td>
<td><p>A dictionary to store the transformer setups.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mapper_setups</span></code></p></td>
<td><p>A dictionary to store the mapping functions used together with transformer.</p></td>
</tr>
<tr class="row-odd"><td><p>Data CRUD Operations</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">load(items:</span> <span class="pre">List[Any])</span></code></p></td>
<td><p>Load a list of items to the database <code class="docutils literal notranslate"><span class="pre">items</span></code>.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">extend(items,</span> <span class="pre">List[Any],</span> <span class="pre">apply_transformer:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True)</span></code></p></td>
<td><p>Add items to the end of <code class="docutils literal notranslate"><span class="pre">items</span></code>. Optionally apply transformer from <code class="docutils literal notranslate"><span class="pre">transformer_setups</span></code>.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">add(item:</span> <span class="pre">Any,</span> <span class="pre">index:</span> <span class="pre">Optional[int]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">apply_transformer:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True)</span></code></p></td>
<td><p>Add a single item by index or append to the end. Optionally apply the transformer.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">delete(index:</span> <span class="pre">Optional[int]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">remove_transformed:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True)</span></code></p></td>
<td><p>Remove items by index or pop the last item. Optionally remove the transformed data as well. Assume the transformed item has the same index as the original item. Might not always be the case.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">reset()</span></code></p></td>
<td><p>Reset all attributes to the initial state.</p></td>
</tr>
<tr class="row-even"><td><p>Data Processing</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">register_transformer(transformer:</span> <span class="pre">Component,</span> <span class="pre">key:</span> <span class="pre">Optional[str],</span> <span class="pre">map_fn:</span> <span class="pre">Optional[Callable])</span></code></p></td>
<td><p>Register a data transformation to the database to be used later.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">transform(key:</span> <span class="pre">str)</span></code></p></td>
<td><p>Apply a transformer by key to the data.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">transform(transformer:</span> <span class="pre">Component,</span> <span class="pre">map_fn:</span> <span class="pre">Callable,</span> <span class="pre">key:</span> <span class="pre">str)</span></code></p></td>
<td><p>Register and apply a transformer to the data.</p></td>
</tr>
<tr class="row-odd"><td><p>Data Persistence</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">save_state(filepath:</span> <span class="pre">str)</span></code></p></td>
<td><p>Save the state of the database to a pickle file.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">load_state(filepath:</span> <span class="pre">str)</span></code></p></td>
<td><p>A class method to load the state of the database from a pickle file.</p></td>
</tr>
</tbody>
</table>
</div>
<p>Now, finally, we have a good way to organize important data along its pipeline like <code class="docutils literal notranslate"><span class="pre">Document</span></code> and <code class="docutils literal notranslate"><span class="pre">DialogTurn</span></code> in a database.</p>
<p><strong>Data Loading and CRUD Operations</strong></p>
<p>Let’s create a <code class="docutils literal notranslate"><span class="pre">LocalDB</span></code> to manage the <code class="docutils literal notranslate"><span class="pre">dialog_turns</span></code> and its data processing pipeline:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.core.db</span> <span class="kn">import</span> <span class="n">LocalDB</span>

<span class="n">dialog_turn_db</span> <span class="o">=</span> <span class="n">LocalDB</span><span class="p">(</span><span class="s1">&#39;dialog_turns&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dialog_turn_db</span><span class="p">)</span>

<span class="n">dialog_turn_db</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">dialog_turns</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dialog_turn_db</span><span class="p">)</span>
</pre></div>
</div>
<p>The printout will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LocalDB</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;dialog_turns&#39;</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">transformed_items</span><span class="o">=</span><span class="p">{},</span> <span class="n">transformer_setups</span><span class="o">=</span><span class="p">{},</span> <span class="n">mapper_setups</span><span class="o">=</span><span class="p">{})</span>
<span class="n">LocalDB</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;dialog_turns&#39;</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="n">DialogTurn</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;f2eddc77-4667-43f5-87e0-fd11f12958b3&#39;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_query</span><span class="o">=</span><span class="n">UserQuery</span><span class="p">(</span><span class="n">query_str</span><span class="o">=</span><span class="s1">&#39;What are the benefits of renewable energy?&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">assistant_response</span><span class="o">=</span><span class="n">AssistantResponse</span><span class="p">(</span><span class="n">response_str</span><span class="o">=</span><span class="s1">&#39;I can see you are interested in renewable energy. Renewable energy technologies not only help in reducing greenhouse gas emissions but also contribute significantly to the economy by creating jobs in the manufacturing and installation sectors. The growth in renewable energy usage boosts local economies through increased investment in technology and infrastructure.&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">user_query_timestamp</span><span class="o">=</span><span class="s1">&#39;2021-09-01T12:00:00Z&#39;</span><span class="p">,</span> <span class="n">assistant_response_timestamp</span><span class="o">=</span><span class="s1">&#39;2021-09-01T12:00:01Z&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vector</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">DialogTurn</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;b2dbdf2f-f513-493d-aaa8-c77c98ac260f&#39;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_query</span><span class="o">=</span><span class="n">UserQuery</span><span class="p">(</span><span class="n">query_str</span><span class="o">=</span><span class="s1">&#39;How do solar panels impact the environment?&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">assistant_response</span><span class="o">=</span><span class="n">AssistantResponse</span><span class="p">(</span><span class="n">response_str</span><span class="o">=</span><span class="s1">&#39;Solar panels convert sunlight into electricity by allowing photons, or light particles, to knock electrons free from atoms, generating a flow of electricity. Solar panels are a type of renewable energy technology that has been found to have a significant positive effect on the environment by reducing the reliance on fossil fuels.&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">user_query_timestamp</span><span class="o">=</span><span class="s1">&#39;2021-09-01T12:00:02Z&#39;</span><span class="p">,</span> <span class="n">assistant_response_timestamp</span><span class="o">=</span><span class="s1">&#39;2021-09-01T12:00:03Z&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vector</span><span class="o">=</span><span class="kc">None</span><span class="p">)],</span> <span class="n">transformed_items</span><span class="o">=</span><span class="p">{},</span> <span class="n">transformer_setups</span><span class="o">=</span><span class="p">{},</span> <span class="n">mapper_setups</span><span class="o">=</span><span class="p">{})</span>
</pre></div>
</div>
<p><strong>Data Processing/Transformation Pipeline(such as TextSplitter and Embedder)</strong></p>
<p>We register and apply the transformer from the last section to the data stored in the <code class="docutils literal notranslate"><span class="pre">dialog_turn_db</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;split_and_embed&quot;</span>
<span class="n">dialog_turn_db</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data_transformer</span><span class="p">,</span> <span class="n">map_fn</span><span class="o">=</span><span class="n">map_dialogturn_to_document</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">dialog_turn_db</span><span class="o">.</span><span class="n">transformed_items</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dialog_turn_db</span><span class="o">.</span><span class="n">transformer_setups</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dialog_turn_db</span><span class="o">.</span><span class="n">mapper_setups</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</pre></div>
</div>
<p>The printout will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Splitting documents: 100%|██████████| 2/2 [00:00&lt;00:00, 2167.04it/s]
Batch embedding documents: 100%|██████████| 2/2 [00:00&lt;00:00,  5.46it/s]
Adding embeddings to documents from batch: 2it [00:00, 63072.24it/s]
[Document(id=64987b2b-b6c6-4eb4-9122-02448e3fd394, text=&#39;What are the benefits of renewable energy? I can see you are interested in renewable energy. Renewab...&#39;, meta_data=None, vector=&#39;len: 256&#39;, parent_doc_id=f2eddc77-4667-43f5-87e0-fd11f12958b3, order=0, score=None), Document(id=9a424d4c-4bd0-48ce-aba9-7a4f86892556, text=&#39;and installation sectors. The growth in renewable energy usage boosts local economies through increa...&#39;, meta_data=None, vector=&#39;len: 256&#39;, parent_doc_id=f2eddc77-4667-43f5-87e0-fd11f12958b3, order=1, score=None), Document(id=45efa517-8e52-4780-bdbd-2329ffa8d4b6, text=&#39;How do solar panels impact the environment? Solar panels convert sunlight into electricity by allowi...&#39;, meta_data=None, vector=&#39;len: 256&#39;, parent_doc_id=b2dbdf2f-f513-493d-aaa8-c77c98ac260f, order=0, score=None), Document(id=bc0ff7f6-27cc-4e24-8c3e-9435ed755e20, text=&#39;has been found to have a significant positive effect on the environment by reducing the reliance on ...&#39;, meta_data=None, vector=&#39;len: 256&#39;, parent_doc_id=b2dbdf2f-f513-493d-aaa8-c77c98ac260f, order=1, score=None)]
Sequential(
(0): TextSplitter(split_by=word, split_length=50, split_overlap=10)
(1): ToEmbeddings(
    batch_size=2
    (embedder): Embedder(
    model_kwargs={&#39;model&#39;: &#39;text-embedding-3-small&#39;, &#39;dimensions&#39;: 256, &#39;encoding_format&#39;: &#39;float&#39;},
    (model_client): OpenAIClient()
    )
    (batch_embedder): BatchEmbedder(
    (embedder): Embedder(
        model_kwargs={&#39;model&#39;: &#39;text-embedding-3-small&#39;, &#39;dimensions&#39;: 256, &#39;encoding_format&#39;: &#39;float&#39;},
        (model_client): OpenAIClient()
    )
  )
 )
)
&lt;function map_dialogturn_to_document at 0x10fb26f20&gt;
</pre></div>
</div>
<p><strong>Save/Reload Data</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dialog_turn_db</span><span class="o">.</span><span class="n">save_state</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;.storage/dialog_turns.pkl&#39;</span><span class="p">)</span>
<span class="n">reloaded_dialog_turn_db</span> <span class="o">=</span> <span class="n">LocalDB</span><span class="o">.</span><span class="n">load_state</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;.storage/dialog_turns.pkl&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dialog_turn_db</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">restored_dialog_turn_db</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">))</span>
</pre></div>
</div>
<p>This will print <code class="docutils literal notranslate"><span class="pre">True</span></code> if the two databases are the same. We can use the reloaded db class to continue to work with the data.
This data class can be really helpful for researchers and developers to run and track local experiments to optimize the data processing pipelines</p>
<p><strong>CRUD Operations using with Generator for a conversation</strong></p>
<p>We will have a chatbot and add new conversation turns to the database. When the conversation is too long to fit into token limit of your LLM model, you can easily
use a retriever to control the conversation history length.</p>
<p>First, let us prepare the generator. We will use <code class="docutils literal notranslate"><span class="pre">input_str</span></code> and <code class="docutils literal notranslate"><span class="pre">chat_history_str</span></code> from our default prompt.
This will also leverage <code class="docutils literal notranslate"><span class="pre">DialogTurn</span></code> ‘s inheritant ability from <code class="docutils literal notranslate"><span class="pre">DataClass</span></code> to quickly form the <code class="docutils literal notranslate"><span class="pre">chat_history_str</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.core</span> <span class="kn">import</span> <span class="n">Generator</span>

<span class="n">llm_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt-3.5-turbo&quot;</span>
<span class="p">}</span>

<span class="n">generator</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">model_client</span> <span class="o">=</span> <span class="n">ModelClientType</span><span class="o">.</span><span class="n">OPENAI</span><span class="p">(),</span> <span class="n">model_kwargs</span><span class="o">=</span><span class="n">llm_kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is the code to form the prompt and we will use <code class="docutils literal notranslate"><span class="pre">generator.print_prompt()</span></code> to check how the prompt will look like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="n">input_str</span> <span class="o">=</span> <span class="s2">&quot;What are the benefits of renewable energy? Did I ask this before?&quot;</span>

<span class="k">def</span> <span class="nf">format_chat_history_str</span><span class="p">(</span><span class="n">turns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DialogTurn</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">chat_history_str</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">turn</span> <span class="ow">in</span> <span class="n">turns</span><span class="p">:</span>
        <span class="n">chat_history_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">turn</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">(</span>
                        <span class="n">exclude</span><span class="o">=</span><span class="p">[</span>
                            <span class="s2">&quot;id&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;session_id&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;user_query_timestamp&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;assistant_response_timestamp&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;order&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;metadata&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;vector&quot;</span><span class="p">,</span>
                        <span class="p">],</span>
                    <span class="p">)</span>
                <span class="p">)</span>
    <span class="n">chat_history_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">_________</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chat_history_str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">chat_history_str</span>

<span class="n">chat_history_str</span> <span class="o">=</span> <span class="n">format_chat_history_str</span><span class="p">(</span><span class="n">dialog_turn_db</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">print_prompt</span><span class="p">(</span><span class="n">input_str</span><span class="o">=</span><span class="n">input_str</span><span class="p">,</span> <span class="n">chat_history_str</span><span class="o">=</span><span class="n">chat_history_str</span><span class="p">))</span>
</pre></div>
</div>
<p>The printout will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Prompt:

&lt;SYS&gt;
&lt;CHAT_HISTORY&gt;
user_query:
metadata: null
query_str: What are the benefits of renewable energy?
assistant_response:
metadata: null
response_str: I can see you are interested in renewable energy. Renewable energy technologies
    not only help in reducing greenhouse gas emissions but also contribute significantly
    to the economy by creating jobs in the manufacturing and installation sectors. The
    growth in renewable energy usage boosts local economies through increased investment
    in technology and infrastructure
&lt;/CHAT_HISTORY&gt;
&lt;/SYS&gt;
&lt;User&gt;
What are the benefits of renewable energy? Did I ask this before?
&lt;/User&gt;
You:
</pre></div>
</div>
<p>Now, let us chat with the generator and add the conversation turns to the database:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">generator</span><span class="p">(</span><span class="n">prompt_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;input_str&quot;</span><span class="p">:</span> <span class="n">input_str</span><span class="p">,</span> <span class="s2">&quot;chat_history_str&quot;</span><span class="p">:</span> <span class="n">chat_history_str</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

<span class="c1"># add the turn and apply the transformer</span>
<span class="n">new_turn</span> <span class="o">=</span> <span class="n">DialogTurn</span><span class="p">(</span>
    <span class="n">user_query</span><span class="o">=</span><span class="n">UserQuery</span><span class="p">(</span><span class="n">query_str</span><span class="o">=</span><span class="n">input_str</span><span class="p">),</span>
    <span class="n">assistant_response</span><span class="o">=</span><span class="n">AssistantResponse</span><span class="p">(</span><span class="n">response_str</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">dialog_turn_db</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_turn</span><span class="p">,</span> <span class="n">apply_transformer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">dialog_turn_db</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dialog_turn_db</span><span class="o">.</span><span class="n">transformed_items</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>

<span class="c1"># 3 6</span>
</pre></div>
</div>
<p><strong>Use With Retriever</strong></p>
<p>Assume our history is getting too long to fit into the token limit.
We will use a semantic retriever to fetch relevant chunked documents from the database.
Then, instead of directly using the documents, we will find its relevant dialog turns by comparing the <code class="docutils literal notranslate"><span class="pre">parent_doc_id</span></code> with the <code class="docutils literal notranslate"><span class="pre">id</span></code> of the document.
Here is the code to prepare the relevant dialog turns.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">adalflow.components.retriever.faiss_retriever</span> <span class="kn">import</span> <span class="n">FAISSRetriever</span>

<span class="n">retriever</span> <span class="o">=</span> <span class="n">FAISSRetriever</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">embedder</span><span class="o">=</span><span class="n">embedder</span><span class="p">)</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">vector</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dialog_turn_db</span><span class="o">.</span><span class="n">transformed_items</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
<span class="n">retriever</span><span class="o">.</span><span class="n">build_index_from_documents</span><span class="p">(</span><span class="n">documents</span><span class="o">=</span><span class="n">embeddings</span><span class="p">)</span>

<span class="c1"># get the relevant documents</span>
<span class="n">top_k_documents</span> <span class="o">=</span> <span class="n">retriever</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">input_str</span><span class="p">)</span>

<span class="c1"># get the relevant dialog turns</span>
<span class="n">parent_doc_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">dialog_turn_db</span><span class="o">.</span><span class="n">transformed_items</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">doc_index</span><span class="p">]</span><span class="o">.</span><span class="n">parent_doc_id</span>
        <span class="k">for</span> <span class="n">doc_index</span> <span class="ow">in</span> <span class="n">top_k_documents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">doc_indices</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">condition_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">parent_doc_ids</span>
<span class="n">fetched_dialog_turns</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dialog_turn_db</span><span class="o">.</span><span class="n">items</span> <span class="k">if</span> <span class="n">condition_fn</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span>
</pre></div>
</div>
<p>Now, we can use the <code class="docutils literal notranslate"><span class="pre">fetched_dialog_turns</span></code> to continue the conversation with the generator.</p>
</section>
<section id="cloud-database">
<h2>Cloud database<a class="headerlink" href="#cloud-database" title="Link to this heading">¶</a></h2>
<p>Please check out the <a class="reference internal" href="retriever.html#tutorials-retriever"><span class="std std-ref">Retriever</span></a> for using Cloud database as a storage and a retriever.</p>
</section>
<section id="file-reading">
<h2>File Reading<a class="headerlink" href="#file-reading" title="Link to this heading">¶</a></h2>
<p>We dont provide integration currently, but using file reading packages like <a class="reference external" href="https://filesystem-spec.readthedocs.io/en/latest/">fsspec</a> should be fairly easy to use with our data processing pipeline.</p>
<div class="highlight admonition">
<p class="admonition-title">API References</p>
<ul class="simple">
<li><p><a class="reference internal" href="../apis/core/core.types.html#core.types.Document" title="core.types.Document"><code class="xref py py-class docutils literal notranslate"><span class="pre">core.types.Document</span></code></a></p></li>
<li><p><a class="reference internal" href="../apis/core/core.types.html#core.types.DialogTurn" title="core.types.DialogTurn"><code class="xref py py-class docutils literal notranslate"><span class="pre">core.types.DialogTurn</span></code></a></p></li>
<li><p><a class="reference internal" href="../apis/core/core.db.html#core.db.LocalDB" title="core.db.LocalDB"><code class="xref py py-class docutils literal notranslate"><span class="pre">core.db.LocalDB</span></code></a></p></li>
<li><p><a class="reference internal" href="../apis/components/components.data_process.text_splitter.html#components.data_process.text_splitter.TextSplitter" title="components.data_process.text_splitter.TextSplitter"><code class="xref py py-class docutils literal notranslate"><span class="pre">components.data_process.text_splitter.TextSplitter</span></code></a></p></li>
<li><p><a class="reference internal" href="../apis/components/components.data_process.html#components.data_process.ToEmbeddings" title="components.data_process.ToEmbeddings"><code class="xref py py-class docutils literal notranslate"><span class="pre">components.data_process.ToEmbeddings</span></code></a></p></li>
</ul>
</div>
<div class="admonition-additional-resources admonition">
<p class="admonition-title">Additional Resources</p>
<ul class="simple">
<li><p><a class="reference external" href="https://filesystem-spec.readthedocs.io/en/latest/">fsspec</a></p></li>
</ul>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="rag_playbook.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">RAG Playbook</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="text_splitter.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Text Splitter</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, SylphAI, Inc
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Data (Database/Pipeline)</a><ul>
<li><a class="reference internal" href="#data-models">Data Models</a><ul>
<li><a class="reference internal" href="#document">Document</a></li>
<li><a class="reference internal" href="#dialogturn">DialogTurn</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-pipeline">Data Pipeline</a></li>
<li><a class="reference internal" href="#local-database">Local database</a></li>
<li><a class="reference internal" href="#cloud-database">Cloud database</a></li>
<li><a class="reference internal" href="#file-reading">File Reading</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/js/rtd_search_config.js"></script>
    <script src="../_static/js/rtd_sphinx_search.min.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>